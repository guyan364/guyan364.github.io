<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="给出简要思路和代码">
<meta property="og:type" content="article">
<meta property="og:title" content="[联合省选 2020] 简要题解">
<meta property="og:url" content="http://yoursite.com/2020/06/28/Solutions/%E8%81%94%E5%90%88%E7%9C%81%E9%80%89-2020-%E7%AE%80%E8%A6%81%E9%A2%98%E8%A7%A3/index.html">
<meta property="og:site_name" content="Guyan&#39;s blog">
<meta property="og:description" content="给出简要思路和代码">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-06-28T01:12:58.000Z">
<meta property="article:modified_time" content="2020-06-29T08:40:14.707Z">
<meta property="article:author" content="Guyan">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/06/28/Solutions/%E8%81%94%E5%90%88%E7%9C%81%E9%80%89-2020-%E7%AE%80%E8%A6%81%E9%A2%98%E8%A7%A3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>[联合省选 2020] 简要题解 | Guyan's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Guyan's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/28/Solutions/%E8%81%94%E5%90%88%E7%9C%81%E9%80%89-2020-%E7%AE%80%E8%A6%81%E9%A2%98%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guyan">
      <meta itemprop="description" content="水平低啊">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guyan's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [联合省选 2020] 简要题解
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-28 09:12:58" itemprop="dateCreated datePublished" datetime="2020-06-28T09:12:58+08:00">2020-06-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-29 16:40:14" itemprop="dateModified" datetime="2020-06-29T16:40:14+08:00">2020-06-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">题解</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>给出简要思路和代码</p>
<a id="more"></a>
<h5 id="联合省选-2020-a-b-冰火战士"><a href="https://loj.ac/problem/3299" target="_blank" rel="noopener">[联合省选 2020 A | B] 冰火战士</a></h5>
<p>直接线段树二分 , 问题是要求恰好二分到冰系战士的温度 , 可以用线段树求出前驱后缀计算答案. 减少常数可以在树状数组上二分.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> IN_LEN = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> buf[IN_LEN] , *s , *t;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Getchar</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="keyword">return</span> s == t &amp;&amp; ( t = ( s = buf ) + fread( buf , <span class="number">1</span> , IN_LEN , <span class="built_in">stdin</span> ) ) , s == t ? <span class="number">-1</span> : *s++; &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>( <span class="title">T</span> &amp; <span class="title">x</span> ) &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c , f; c = Getchar() , x = f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span> ) &#123; <span class="keyword">if</span>( c == <span class="string">'-'</span> ) f = <span class="number">1</span>; c = Getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span>( c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span> ) x = x * <span class="number">10</span> + c - <span class="number">48</span> , c = Getchar();</span><br><span class="line">    x = f ? -x : x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">4e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> LIM , LG , discre[N] , discre_tot;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BIT</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> tr[N];</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">( <span class="keyword">int</span> i , <span class="keyword">int</span> v )</span> </span>&#123; <span class="keyword">while</span>( i &lt;= LIM ) tr[i] += v , i += (i&amp;(-i)); &#125;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">( <span class="keyword">int</span> i )</span> </span>&#123; <span class="keyword">int</span> res = <span class="number">0</span>; <span class="keyword">while</span>( i ) res += tr[i] , i -= (i&amp;(-i)); <span class="keyword">return</span> res; &#125;</span><br><span class="line">&#125; bt1 , bt2 , bt3;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">OPT</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> type , t , x , y;</span><br><span class="line">&#125; dat[N];</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">( <span class="keyword">int</span> id )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> t = dat[id].t , x = dat[id].x , y = dat[id].y;</span><br><span class="line">  <span class="keyword">if</span>( t == <span class="number">1</span> ) bt3.add( x , <span class="number">-1</span> ) , bt1.add( x , -y );</span><br><span class="line">  <span class="keyword">else</span> bt2.add( x , -y );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">( <span class="keyword">int</span> id )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> t = dat[id].t , x = dat[id].x , y = dat[id].y;</span><br><span class="line">  <span class="keyword">if</span>( t == <span class="number">1</span> ) bt3.add( x , <span class="number">1</span> ) , bt1.add( x , y );</span><br><span class="line">  <span class="keyword">else</span> bt2.add( x , y );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">kth</span><span class="params">( <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> res = <span class="number">0</span> , t;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = LG ; ~i ; --i ) &#123;</span><br><span class="line">    t = bt3.tr[res + ( <span class="number">1</span> &lt;&lt; i )];</span><br><span class="line">    <span class="keyword">if</span>( t &lt; k ) k -= t , res += ( <span class="number">1</span> &lt;&lt; i );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rnk</span><span class="params">( <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> bt3.sum( k - <span class="number">1</span> ) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans1 , ans2;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( !x ) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">int</span> A = bt1.sum( LIM ) - bt1.sum( x - <span class="number">1</span> );</span><br><span class="line">  <span class="keyword">int</span> B = bt2.sum( x );</span><br><span class="line">  <span class="keyword">if</span>( min( A , B ) &gt;= ans2 ) ans2 = min( A , B ) , ans1 = discre[x];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Query</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> S0 , S1 , u = <span class="number">0</span>;</span><br><span class="line">  S1 = bt1.tr[LIM] , S0 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = LG , ns1 , ns0 ; ~i ; --i ) &#123;</span><br><span class="line">    ns1 = S1 - bt1.tr[(<span class="number">1</span> &lt;&lt; i) + u];</span><br><span class="line">    ns0 = S0 + bt2.tr[(<span class="number">1</span> &lt;&lt; i) + u];</span><br><span class="line">    <span class="keyword">if</span>( ns1 &gt;= ns0 ) u += ( <span class="number">1</span> &lt;&lt; i ) , S0 = ns0 , S1 = ns1;</span><br><span class="line">  &#125;</span><br><span class="line">  ans2 = <span class="number">0</span>;</span><br><span class="line">  query( kth( rnk( u ) - <span class="number">1</span> ) );</span><br><span class="line">  query( kth( rnk( u ) ) );</span><br><span class="line">  query( kth( rnk( u + <span class="number">1</span> ) ) );</span><br><span class="line">  <span class="keyword">if</span>( !ans2 ) <span class="built_in">puts</span>(<span class="string">"Peace"</span>);</span><br><span class="line">  <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>,ans1,ans2*<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  read( n );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    read( dat[i].type );</span><br><span class="line">    <span class="keyword">if</span>( dat[i].type == <span class="number">1</span> ) &#123;</span><br><span class="line">      read( dat[i].t ) , read( dat[i].x ) , read( dat[i].y );</span><br><span class="line">      discre[++discre_tot] = dat[i].x;</span><br><span class="line">    &#125; <span class="keyword">else</span> read( dat[i].x );</span><br><span class="line">  &#125;</span><br><span class="line">  sort( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot );</span><br><span class="line">  discre_tot = unique( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot ) - discre - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( dat[i].type == <span class="number">1</span> )</span><br><span class="line">      dat[i].x = lower_bound( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot , dat[i].x ) - discre;</span><br><span class="line">  LIM = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span>( LIM &lt; discre_tot ) LIM &lt;&lt;= <span class="number">1</span> , ++LG;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( dat[i].type == <span class="number">2</span> ) </span><br><span class="line">      erase( dat[i].x );</span><br><span class="line">    <span class="keyword">else</span> insert( i );</span><br><span class="line">    Query();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="联合省选-2020-a-组合数问题"><a href="https://loj.ac/problem/3300" target="_blank" rel="noopener">[联合省选 2020 A] 组合数问题</a></h5>
<p>推式子 <span class="math display">\[
\begin{aligned}
&amp; \ \ \ \ \ \sum_{i=0}^n f(i) \cdot x^i \cdot \binom{n}{i} \\
&amp;=\sum_{i=0}^n\left(\sum_{j=0}^ma_ji^j\right)\cdot x^i\cdot \binom{n}{i} \\
&amp;=\sum_{j=0}^ma_j\sum_{i=0}^ni^j\cdot x^i \cdot \binom{n}{i} 
\end{aligned}
\]</span> 令 <span class="math inline">\(g(y,n) = \sum_{i=0}^ni^y\cdot x^i \cdot \binom{n}{i}\)</span> . <span class="math display">\[
\begin{aligned}
g(y,n) &amp;= \sum_{i=0}^ni^y\cdot x^i \cdot \binom{n}{i} \\
&amp;= n\sum_{i=1}^{n} i^{y-1}\cdot x^i \binom{n-1}{i - 1} \\
g(y-1,n) &amp;= \sum_{i=0}^n i^{y-1}\cdot x^i \cdot \binom{n}{i} \\
g(y-1,n-1) &amp;= \sum_{i=0}^{n-1} i^{y-1} \cdot x^i\cdot \binom{n-1}{i} \\
g(y,n) &amp;= n \left( g(y-1,n) - g(y-1,n-1)\right)
\end{aligned}
\]</span> 于是 <span class="math inline">\(O(m^2)\)</span> .</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> _w , mod;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">pls</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; a += b - mod; <span class="keyword">return</span> a + ( a &gt;&gt; <span class="number">31</span> &amp; mod ); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">mns</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; a -= b; <span class="keyword">return</span> a + ( a &gt;&gt; <span class="number">31</span> &amp; mod ); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">inc</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; a += b - mod; a += a &gt;&gt; <span class="number">31</span> &amp; mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dec</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; a -= b; a += a &gt;&gt; <span class="number">31</span> &amp; mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">fpow</span><span class="params">( <span class="keyword">int</span> b , <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> res = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span>( k ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( k &amp; <span class="number">1</span> ) res = <span class="number">1L</span>L * res * b % mod;</span><br><span class="line">    b = <span class="number">1L</span>L * b * b % mod; k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m , x , f[N] , g[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>,&amp;n,&amp;x,&amp;mod,&amp;m);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= m ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,f+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= m ; ++i )</span><br><span class="line">    g[<span class="number">0</span>][i] = fpow( pls( <span class="number">1</span> , x ) , n - i );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) </span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= m - i ; ++j )</span><br><span class="line">      g[i][j] = <span class="number">1L</span>L * mns( g[i - <span class="number">1</span>][j] , g[i - <span class="number">1</span>][j + <span class="number">1</span>] ) * ( n - j ) % mod;</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= m ; ++i )</span><br><span class="line">    inc( ans , <span class="number">1L</span>L * g[i][<span class="number">0</span>] * f[i] % mod );</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d"</span>,ans);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="联合省选-2020-a-魔法商店"><a href="https://loj.ac/problem/3301" target="_blank" rel="noopener">[联合省选 2020 A] 魔法商店</a></h5>
<p>保序回归问题.</p>
<p>对于一个不在 <span class="math inline">\(A\)</span> 集合中的一个物品 , 如果可以替代 <span class="math inline">\(A\)</span> 集合中某个物品 , 则其取值要大于等于这个物品. 对于不在 <span class="math inline">\(B\)</span> 集合中的同理 , 只是要小于等于这个物品.</p>
<p>这样就得到了偏序关系. 接下来就是 <span class="math inline">\(L_2\)</span> 问题. 保序回归问题可以看 <span class="math inline">\(2018\)</span> 年的集训队论文.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> LG = <span class="number">64</span>;</span><br><span class="line"><span class="keyword">const</span> lol INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>LL;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Network_flows &#123;</span><br><span class="line">  <span class="keyword">int</span> head[N] , eidx , dep[N] , que[N] , he , ta , st , ed , cur[N];</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt , to; lol flow , cap; &#125; edge[M];</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; st = N - <span class="number">1</span> , ed = N - <span class="number">2</span> , <span class="built_in">memset</span>( head , <span class="number">-1</span> , <span class="keyword">sizeof</span> head ); eidx = <span class="number">-1</span>; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v , lol cap )</span> </span>&#123;</span><br><span class="line">    edge[++eidx] = (Edge) &#123; head[u] , v , <span class="number">0</span> , cap &#125;; head[u] = eidx;</span><br><span class="line">    edge[++eidx] = (Edge) &#123; head[v] , u , <span class="number">0</span> , <span class="number">0</span> &#125;; head[v] = eidx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>( dep , <span class="number">0</span> , <span class="keyword">sizeof</span> dep );</span><br><span class="line">    dep[que[he = ta = <span class="number">1</span>] = st] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>( he &lt;= ta ) &#123;</span><br><span class="line">      <span class="keyword">int</span> u = que[he++];</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] ; ~i ; i = edge[i].nxt )</span><br><span class="line">        <span class="keyword">if</span>( edge[i].cap &gt; edge[i].flow &amp;&amp; !dep[edge[i].to] )</span><br><span class="line">          dep[que[++ta] = edge[i].to] = dep[u] + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dep[ed] != <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">lol <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u , lol fl )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( u == ed || !fl ) <span class="keyword">return</span> fl;</span><br><span class="line">    lol g = <span class="number">0</span> , d;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> &amp; i = cur[u] ; ~i ; i = edge[i].nxt )</span><br><span class="line">      <span class="keyword">if</span>( dep[edge[i].to] == dep[u] + <span class="number">1</span> &amp;&amp; ( d = dfs( edge[i].to , min( edge[i].cap - edge[i].flow , fl - g ) ) ) ) &#123;</span><br><span class="line">        edge[i].flow += d , edge[i ^ <span class="number">1</span>].flow -= d;</span><br><span class="line">        <span class="keyword">if</span>( ( g += d ) &gt;= fl ) <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">return</span> g;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">dinic</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>( bfs() ) &#123;</span><br><span class="line">      <span class="built_in">memcpy</span>( cur , head , <span class="keyword">sizeof</span> head );</span><br><span class="line">      dfs( st , INF );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m , v[N] , id[N] , A[N] , B[N] , tmp[N];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[N]; lol res; <span class="keyword">bool</span> mark[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> lol <span class="title">sqr</span><span class="params">( lol x )</span> </span>&#123; <span class="keyword">return</span> x * x; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">( <span class="keyword">int</span> L , <span class="keyword">int</span> R , <span class="keyword">int</span> l , <span class="keyword">int</span> r )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( l &gt; r ) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span>( L == R ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = l , u ; i &lt;= r ; ++i ) &#123;</span><br><span class="line">      u = id[i];</span><br><span class="line">      res += sqr( v[u] - L );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = ( L + R ) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  Network_flows::init();</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = l ; i &lt;= r ; ++i ) mark[id[i]] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = l , u ; i &lt;= r ; ++i ) &#123;</span><br><span class="line">    u = id[i];</span><br><span class="line">    <span class="keyword">if</span>( v[u] &gt; mid ) Network_flows::addedge( u , N - <span class="number">2</span> , sqr( v[u] - mid ) - sqr( v[u] - mid - <span class="number">1</span> ) );</span><br><span class="line">    <span class="keyword">else</span> Network_flows::addedge( N - <span class="number">1</span> , u , sqr( mid + <span class="number">1</span> - v[u] ) - sqr( mid - v[u] ) );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : G[u] )</span><br><span class="line">      Network_flows::addedge( u , v , INF );</span><br><span class="line">  &#125;</span><br><span class="line">  Network_flows::dinic();</span><br><span class="line">  <span class="keyword">int</span> p = l , q = r;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = l ; i &lt;= r ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( Network_flows::dep[id[i]] )</span><br><span class="line">      tmp[p++] = id[i];</span><br><span class="line">    <span class="keyword">else</span> tmp[q--] = id[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = l ; i &lt;= r ; ++i ) id[i] = tmp[i];</span><br><span class="line">  solve( L , mid , l , p - <span class="number">1</span> );</span><br><span class="line">  solve( mid + <span class="number">1</span> , R , p , r );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ull bs[N] , dat[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">( ull x )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = LG - <span class="number">1</span> ; ~i ; --i ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( ( x &gt;&gt; i ) &amp; <span class="number">1</span> ) &#123; </span><br><span class="line">      <span class="keyword">if</span>( !bs[i] ) &#123;</span><br><span class="line">        bs[i] = x;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      x ^= bs[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">tryins</span><span class="params">( ull x )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = LG - <span class="number">1</span> ; ~i ; --i ) </span><br><span class="line">    <span class="keyword">if</span>( ( x &gt;&gt; i ) &amp; <span class="number">1</span> ) &#123;</span><br><span class="line">      x ^= bs[i];</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> x != <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%llu"</span>,dat+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,v+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,A+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,B+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    <span class="built_in">memset</span>( bs , <span class="number">0</span> , <span class="keyword">sizeof</span> bs );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++j )</span><br><span class="line">      <span class="keyword">if</span>( j ^ i ) ins( dat[A[j]] );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++j )</span><br><span class="line">      <span class="keyword">if</span>( j ^ A[i] ) &#123;</span><br><span class="line">        <span class="keyword">if</span>( tryins( dat[j] ) )</span><br><span class="line">          G[j].push_back( A[i] );</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    <span class="built_in">memset</span>( bs , <span class="number">0</span> , <span class="keyword">sizeof</span> bs );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++j )</span><br><span class="line">      <span class="keyword">if</span>( j ^ i ) ins( dat[B[j]] );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++j )</span><br><span class="line">      <span class="keyword">if</span>( j ^ B[i] ) &#123;</span><br><span class="line">        <span class="keyword">if</span>( tryins( dat[j] ) )</span><br><span class="line">          G[B[i]].push_back( j );</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) id[i] = i;</span><br><span class="line">  solve( <span class="number">0</span> , <span class="number">1e6</span> , <span class="number">1</span> , n );</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; res;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="联合省选-2020-a-b-信号传递"><a href="https://loj.ac/problem/3302" target="_blank" rel="noopener">[联合省选 2020 A | B] 信号传递</a></h5>
<p>问题在于如何知道对于一个集合加入一个元素的贡献. 自己想一想就好了吧.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">23</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1</span> &lt;&lt; N;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">chkmin</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; <span class="keyword">if</span>( a &gt; b ) a = b; &#125;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m , U , k , G[N][N] , bf[N][N] , af[N][N] , stk[N + <span class="number">1</span>][N] , bcnt[M] , f[M] , a , b , bin[M];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>,&amp;n,&amp;m,&amp;k,&amp;a); --a;</span><br><span class="line">  <span class="keyword">while</span>( --n ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;b);</span><br><span class="line">    ++G[a][--b];</span><br><span class="line">    a = b;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; m ; ++i ) G[i][i] = <span class="number">0</span> , bin[<span class="number">1</span>&lt;&lt;i] = i;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; m ; ++i )</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; m ; ++j ) &#123;</span><br><span class="line">      bf[i][j] = G[i][j] + k * G[j][i];</span><br><span class="line">      af[i][j] = -G[j][i] + k * G[i][j];</span><br><span class="line">      stk[<span class="number">0</span>][j] += af[i][j];</span><br><span class="line">    &#125;</span><br><span class="line">  U = ( <span class="number">1</span> &lt;&lt; m ); <span class="built_in">memset</span>( f , <span class="number">0x3f</span> , <span class="keyword">sizeof</span> f ); f[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; U ; ++i ) &#123;</span><br><span class="line">    b = bcnt[i] = bcnt[i &gt;&gt; <span class="number">1</span>] + ( i &amp; <span class="number">1</span> );</span><br><span class="line">    <span class="keyword">if</span>( b ) &#123;</span><br><span class="line">      a = bin[i&amp;(-i)];</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; m ; ++j ) </span><br><span class="line">        stk[b][j] = stk[b - <span class="number">1</span>][j] + bf[a][j] - af[a][j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = ( U - <span class="number">1</span> ) ^ i ; j ; j -= (j&amp;(-j)) ) &#123;</span><br><span class="line">      a = bin[j&amp;(-j)];</span><br><span class="line">      chkmin( f[i | ( <span class="number">1</span> &lt;&lt; a )] , f[i] + stk[b][a] * ( b + <span class="number">1</span> ) );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; f[U - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="联合省选-2020-a-树"><a href="https://loj.ac/problem/3303" target="_blank" rel="noopener">[联合省选 2020 A] 树</a></h5>
<p>考虑每个数每一位对祖先的贡献. 发现形成有规律的段. 就是隔 <span class="math inline">\(2^k\)</span> 异或上一个 <span class="math inline">\(2^k\)</span> , 可以倍增差分解决.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">6e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> LG = <span class="number">21</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> val[N] , fa[N][LG] , n , g[N][LG] , bin[<span class="number">1</span> &lt;&lt; LG];</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> ans;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; LG ; ++i )</span><br><span class="line">    fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> , p = u , tmp = <span class="number">0</span> , d = <span class="number">0</span> ; i &lt; LG ; ++i ) &#123;</span><br><span class="line">    tmp = ( <span class="number">1</span> &lt;&lt; i ) - ( val[u] &amp; ( ( <span class="number">1</span> &lt;&lt; i ) - <span class="number">1</span> ) );</span><br><span class="line">    p = u;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++j )</span><br><span class="line">      <span class="keyword">if</span>( ( tmp &gt;&gt; j ) &amp; <span class="number">1</span> ) </span><br><span class="line">        p = fa[p][j];</span><br><span class="line">    g[p][i] ^= ( <span class="number">1</span> &lt;&lt; i );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : G[u] ) &#123;</span><br><span class="line">    dfs( v );</span><br><span class="line">    val[u] ^= val[v];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; LG ; ++i ) &#123;</span><br><span class="line">    val[u] ^= g[u][i];</span><br><span class="line">    g[fa[u][i]][i] ^= g[u][i];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; LG ; ++i ) bin[<span class="number">1</span> &lt;&lt; i] = i;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,val+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> , p ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;p);</span><br><span class="line">    fa[i][<span class="number">0</span>] = p;</span><br><span class="line">    G[p].push_back( i );</span><br><span class="line">  &#125;</span><br><span class="line">  dfs( <span class="number">1</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) ans += val[i];</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; ans;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="联合省选-2020-a-作业题"><a href="https://loj.ac/problem/3304" target="_blank" rel="noopener">[联合省选 2020 A] 作业题</a></h5>
<p>反演加矩阵树定理. 用矩阵树求生成树权值和可以在 <a href="/2020/04/06/Solutions/%E5%8C%97%E4%BA%AC%E7%9C%81%E9%80%89%E9%9B%86%E8%AE%AD2019-%E7%94%9F%E6%88%90%E6%A0%91%E8%AE%A1%E6%95%B0/" title="[北京省选集训2019] 生成树计数">[北京省选集训2019] 生成树计数</a> 看到.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">35</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = N * N;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">pls</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; a += b - mod; <span class="keyword">return</span> a + ( a &gt;&gt; <span class="number">31</span> &amp; mod ); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">mns</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; a -= b; <span class="keyword">return</span> a + ( a &gt;&gt; <span class="number">31</span> &amp; mod ); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">inc</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; a += b - mod; a += a &gt;&gt; <span class="number">31</span> &amp; mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dec</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; a -= b; a += a &gt;&gt; <span class="number">31</span> &amp; mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">fpow</span><span class="params">( <span class="keyword">int</span> b , <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> res = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span>( k ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( k &amp; <span class="number">1</span> ) res = <span class="number">1L</span>L * res * b % mod;</span><br><span class="line">    b = <span class="number">1L</span>L * b * b % mod; k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> _w; <span class="keyword">int</span> discre[M * M] , discre_tot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m , f[M * M] , bac[M * M];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> </span><br><span class="line">  <span class="keyword">int</span> u , v , w;</span><br><span class="line">&#125; dat[M];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Poly</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> a , b;</span><br><span class="line">  Poly( <span class="keyword">int</span> a = <span class="number">0</span> , <span class="keyword">int</span> b = <span class="number">0</span> ):a( a ) , b( b ) &#123;&#125;</span><br><span class="line">  Poly <span class="keyword">operator</span> * ( <span class="keyword">const</span> Poly &amp; rhs ) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Poly( <span class="number">1L</span>L * a * rhs.a % mod , ( <span class="number">1L</span>L * a * rhs.b + <span class="number">1L</span>L * b * rhs.a ) % mod );</span><br><span class="line">  &#125;</span><br><span class="line">  Poly <span class="keyword">operator</span> ~ ( <span class="keyword">void</span> ) &#123; </span><br><span class="line">    <span class="keyword">return</span> Poly( fpow( a , mod - <span class="number">2</span> ) , mns( <span class="number">0</span> , <span class="number">1L</span>L * b * fpow( <span class="number">1L</span>L * a * a % mod , mod - <span class="number">2</span> ) % mod ) );</span><br><span class="line">  &#125;</span><br><span class="line">  Poly <span class="keyword">operator</span> + ( <span class="keyword">const</span> Poly &amp; rhs ) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Poly( pls( a , rhs.a ) , pls( b , rhs.b ) );</span><br><span class="line">  &#125;</span><br><span class="line">  Poly <span class="keyword">operator</span> - ( <span class="keyword">const</span> Poly &amp; rhs ) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Poly( mns( a , rhs.a ) , mns( b , rhs.b ) );</span><br><span class="line">  &#125;</span><br><span class="line">&#125; mat[N][N] , res;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">det</span><span class="params">( <span class="keyword">int</span> n )</span> </span>&#123;</span><br><span class="line">  res = Poly( <span class="number">1</span> , <span class="number">0</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , t = <span class="number">0</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    t = i;</span><br><span class="line">    <span class="keyword">while</span>( t &lt;= n &amp;&amp; mat[t][i].a == <span class="number">0</span> ) ++t;</span><br><span class="line">    <span class="keyword">if</span>( t &gt; n ) &#123;</span><br><span class="line">      res = Poly( <span class="number">0</span> , <span class="number">0</span> );</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>( t ^ i ) &#123;</span><br><span class="line">      swap( mat[t] , mat[i] );</span><br><span class="line">      res = Poly( <span class="number">0</span> , <span class="number">0</span> ) - res;</span><br><span class="line">    &#125;</span><br><span class="line">    res = res * mat[i][i];</span><br><span class="line">    Poly tmp = ~mat[i][i];</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = i ; j &lt;= n ; ++j )</span><br><span class="line">      mat[i][j] = mat[i][j] * tmp;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= n ; ++j ) &#123;</span><br><span class="line">      tmp = mat[j][i];</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> k = i ; k &lt;= n ; ++k ) </span><br><span class="line">        mat[j][k] = mat[j][k] - tmp * mat[i][k];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;dat[i].u,&amp;dat[i].v,&amp;dat[i].w);</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= dat[i].w / j ; ++j )</span><br><span class="line">      <span class="keyword">if</span>( dat[i].w % j == <span class="number">0</span> ) &#123;</span><br><span class="line">        discre[++discre_tot] = j;</span><br><span class="line">        <span class="keyword">if</span>( j * j != dat[i].w )</span><br><span class="line">          discre[++discre_tot] = dat[i].w / j;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sort( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot );</span><br><span class="line">  discre_tot = unique( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot ) - discre - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i )</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> , t ; j &lt;= dat[i].w / j ; ++j )</span><br><span class="line">      <span class="keyword">if</span>( dat[i].w % j == <span class="number">0</span> ) &#123;</span><br><span class="line">        t = lower_bound( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot , j ) - discre;</span><br><span class="line">        ++bac[t];</span><br><span class="line">        <span class="keyword">if</span>( j * j != dat[i].w ) &#123;</span><br><span class="line">          t = lower_bound( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot , dat[i].w / j ) - discre;</span><br><span class="line">          ++bac[t];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  <span class="keyword">int</span> _tot = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= discre_tot ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( bac[i] &gt;= n - <span class="number">1</span> )</span><br><span class="line">      discre[++_tot] = discre[i];</span><br><span class="line">  discre_tot = _tot;</span><br><span class="line">  <span class="keyword">if</span>( !discre_tot ) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"0"</span>),<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> k = <span class="number">1</span> ; k &lt;= discre_tot ; ++k ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++j )</span><br><span class="line">        mat[i][j] = Poly( <span class="number">0</span> , <span class="number">0</span> );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , v ; i &lt;= m ; ++i )</span><br><span class="line">      <span class="keyword">if</span>( dat[i].w % discre[k] == <span class="number">0</span> ) &#123;</span><br><span class="line">        u = dat[i].u , v = dat[i].v;</span><br><span class="line">        mat[u][v] = mat[u][v] - Poly( <span class="number">1</span> , dat[i].w );</span><br><span class="line">        mat[v][u] = mat[v][u] - Poly( <span class="number">1</span> , dat[i].w );</span><br><span class="line">        mat[u][u] = mat[u][u] + Poly( <span class="number">1</span> , dat[i].w );</span><br><span class="line">        mat[v][v] = mat[v][v] + Poly( <span class="number">1</span> , dat[i].w );</span><br><span class="line">      &#125;</span><br><span class="line">    det( n - <span class="number">1</span> );</span><br><span class="line">    f[k] = res.b;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = discre_tot ; i ; --i )</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= discre_tot ; ++j )</span><br><span class="line">      <span class="keyword">if</span>( discre[j] % discre[i] == <span class="number">0</span> )</span><br><span class="line">        dec( f[i] , f[j] );</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= discre_tot ; ++i )</span><br><span class="line">    inc( ans , <span class="number">1L</span>L * f[i] * discre[i] % mod );</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d"</span>,ans);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="联合省选-2020-b-卡牌游戏"><a href="https://loj.ac/problem/3305" target="_blank" rel="noopener">[联合省选 2020 B] 卡牌游戏</a></h5>
<p>贪心取前缀.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line">lol ans , S;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , x ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">    S += x;</span><br><span class="line">    <span class="keyword">if</span>( i &gt; <span class="number">1</span> &amp;&amp; S &gt; <span class="number">0</span> ) ans += S;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; ans;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="联合省选-2020-b-消息传递"><a href="https://loj.ac/problem/3306" target="_blank" rel="noopener">[联合省选 2020 B] 消息传递</a></h5>
<p>动态点分治.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> LG = <span class="number">20</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">chkmax</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; <span class="keyword">if</span>( a &lt; b ) a = b; &#125;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> head[N] , eidx , fl[N] , siz[N] , Rt , Mx , dis[LG][N] , _bac[N * LG * <span class="number">2</span>] , *bac[<span class="number">2</span>][N] , n , m , * __bac = _bac , mxdep[N] , fa[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt , to; &#125; edge[N &lt;&lt; <span class="number">1</span>]; <span class="keyword">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123;</span><br><span class="line">  edge[++eidx] = (Edge) &#123; head[u] , v &#125;; head[u] = eidx;</span><br><span class="line">  edge[++eidx] = (Edge) &#123; head[v] , u &#125;; head[v] = eidx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getrt</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> fa , <span class="keyword">int</span> SIZ )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> mx = <span class="number">0</span>; siz[u] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] , v ; i ; i = edge[i].nxt )</span><br><span class="line">    <span class="keyword">if</span>( !vis[v = edge[i].to] &amp;&amp; v != fa ) &#123;</span><br><span class="line">      getrt( v , u , SIZ );</span><br><span class="line">      chkmax( mx , siz[v] );</span><br><span class="line">      siz[u] += siz[v];</span><br><span class="line">    &#125;</span><br><span class="line">  chkmax( mx , SIZ - siz[u] );</span><br><span class="line">  <span class="keyword">if</span>( mx &lt; Mx ) Mx = mx , Rt = u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getdis</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> fa , <span class="keyword">int</span> * dis )</span> </span>&#123;</span><br><span class="line">  mxdep[u] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] , v ; i ; i = edge[i].nxt )</span><br><span class="line">    <span class="keyword">if</span>( !vis[v = edge[i].to] &amp;&amp; v != fa ) &#123;</span><br><span class="line">      dis[v] = dis[u] + <span class="number">1</span>;</span><br><span class="line">      getdis( v , u , dis );</span><br><span class="line">      chkmax( mxdep[u] , mxdep[v] + <span class="number">1</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> fa , <span class="keyword">int</span> * A , <span class="keyword">int</span> * B , <span class="keyword">int</span> * D1 , <span class="keyword">int</span> *D2 )</span> </span>&#123;</span><br><span class="line">  ++A[D1[u]] , ++B[D2[u]];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] , v ; i ; i = edge[i].nxt )</span><br><span class="line">    <span class="keyword">if</span>( !vis[v = edge[i].to] &amp;&amp; v != fa )</span><br><span class="line">      dfs( v , u , A , B , D1 , D2 );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> Fa , <span class="keyword">int</span> SIZ )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( SIZ == <span class="number">1</span> ) &#123;</span><br><span class="line">    fa[u] = Fa;</span><br><span class="line">    fl[u] = fl[Fa] + <span class="number">1</span>;</span><br><span class="line">    mxdep[u] = <span class="number">1</span>;</span><br><span class="line">    bac[<span class="number">0</span>][u] = __bac;</span><br><span class="line">    ++__bac;</span><br><span class="line">    bac[<span class="number">1</span>][u] = __bac;</span><br><span class="line">    __bac += mxdep[Fa];</span><br><span class="line">    ++bac[<span class="number">0</span>][u][<span class="number">0</span>];</span><br><span class="line">    ++bac[<span class="number">1</span>][u][dis[fl[u] - <span class="number">1</span>][u]];</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Mx = N;</span><br><span class="line">  getrt( u , u , SIZ );</span><br><span class="line">  <span class="keyword">int</span> x = Rt; getrt( x , x , SIZ );</span><br><span class="line">  fa[x] = Fa; fl[x] = fl[Fa] + <span class="number">1</span>;</span><br><span class="line">  vis[x] = <span class="number">1</span>; dis[fl[x]][x] = <span class="number">0</span>;</span><br><span class="line">  getdis( x , x , dis[fl[x]] );</span><br><span class="line">  bac[<span class="number">0</span>][x] = __bac;</span><br><span class="line">  __bac += mxdep[x];</span><br><span class="line">  bac[<span class="number">1</span>][x] = __bac;</span><br><span class="line">  __bac += mxdep[Fa];</span><br><span class="line">  dfs( x , x , bac[<span class="number">0</span>][x] , bac[<span class="number">1</span>][x] , dis[fl[x]] , dis[fl[x] - <span class="number">1</span>] );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = head[x] ; i ; i = edge[i].nxt )</span><br><span class="line">    <span class="keyword">if</span>( !vis[edge[i].to] )</span><br><span class="line">      build( edge[i].to , x , siz[edge[i].to] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qry</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> res = mxdep[u] - <span class="number">1</span> &gt;= k ? bac[<span class="number">0</span>][u][k] : <span class="number">0</span> , tmp , fl = ::fl[u] - <span class="number">1</span> , x = u;</span><br><span class="line">  <span class="keyword">while</span>( fa[x] ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( dis[fl][u] &lt;= k ) &#123;</span><br><span class="line">      tmp = k - dis[fl][u];</span><br><span class="line">      <span class="keyword">if</span>( tmp &lt;= mxdep[fa[x]] - <span class="number">1</span> ) &#123;</span><br><span class="line">        res -= bac[<span class="number">1</span>][x][tmp];</span><br><span class="line">        res += bac[<span class="number">0</span>][fa[x]][tmp];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    x = fa[x] , --fl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line">  <span class="keyword">while</span>( __bac != _bac ) &#123;</span><br><span class="line">    *__bac = <span class="number">0</span>;</span><br><span class="line">    --__bac;</span><br><span class="line">  &#125; *__bac = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>( vis + <span class="number">1</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">bool</span> ) * n );</span><br><span class="line">  <span class="built_in">memset</span>( head + <span class="number">1</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * n ) , eidx = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>( fa + <span class="number">1</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * n );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , v ; i &lt; n ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;v);</span><br><span class="line">    addedge( u , v );</span><br><span class="line">  &#125;</span><br><span class="line">  build( <span class="number">1</span> , <span class="number">0</span> , n );</span><br><span class="line">  <span class="keyword">int</span> u , k;</span><br><span class="line">  <span class="keyword">while</span>( m-- ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;k);</span><br><span class="line">    qry( u , k );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> T; mxdep[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</span><br><span class="line">  <span class="keyword">while</span>( T-- ) solve();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="联合省选-2020-b-幸运数字"><a href="https://loj.ac/problem/3308" target="_blank" rel="noopener">[联合省选 2020 B] 幸运数字</a></h5>
<p>三个操作可以写为满足在一定区间就异或一个数. 于是扫描所有分界点即可.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ent</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> t , x;</span><br><span class="line">  Ent( <span class="keyword">int</span> t = <span class="number">0</span> , <span class="keyword">int</span> x = <span class="number">0</span> ):t( t ) , x( x ) &#123;&#125;</span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; ( <span class="keyword">const</span> Ent &amp; rhs ) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> t &lt; rhs.t;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; dat[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans1 , ans2 , n , m , now;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , opt , L , R , w ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;opt);</span><br><span class="line">    <span class="keyword">if</span>( opt == <span class="number">1</span> ) &#123;</span><br><span class="line">      _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;L,&amp;R,&amp;w);</span><br><span class="line">      dat[++m] = Ent( L , w );</span><br><span class="line">      dat[++m] = Ent( R + <span class="number">1</span> , w );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;L,&amp;w);</span><br><span class="line">      dat[++m] = Ent( L , w );</span><br><span class="line">      dat[++m] = Ent( L + <span class="number">1</span> , w );</span><br><span class="line">      <span class="keyword">if</span>( opt == <span class="number">3</span> ) now ^= w;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sort( dat + <span class="number">1</span> , dat + <span class="number">1</span> + m );</span><br><span class="line">  ans1 = now;</span><br><span class="line">  <span class="keyword">if</span>( dat[<span class="number">1</span>].t &gt; <span class="number">0</span> || dat[m].t &lt; <span class="number">0</span> ) ans2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">else</span> ans2 = dat[<span class="number">1</span>].t - <span class="number">1</span>;</span><br><span class="line">  dat[m + <span class="number">1</span>] = Ent( <span class="keyword">int</span>( <span class="number">1e9</span> ) + <span class="number">2</span> , <span class="number">0</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , r , tmp ; i &lt;= m ; i = r + <span class="number">1</span> ) &#123;</span><br><span class="line">    r = i; </span><br><span class="line">    <span class="keyword">while</span>( r &lt; m &amp;&amp; dat[r + <span class="number">1</span>].t == dat[i].t ) now ^= dat[++r].x;</span><br><span class="line">    now ^= dat[i].x;</span><br><span class="line">    <span class="keyword">if</span>( dat[i].t &lt;= <span class="number">0</span> &amp;&amp; dat[r + <span class="number">1</span>].t &gt; <span class="number">0</span> ) tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>( <span class="built_in">abs</span>( dat[i].t ) &lt; <span class="built_in">abs</span>( dat[r + <span class="number">1</span>].t - <span class="number">1</span> ) )</span><br><span class="line">        tmp = dat[i].t;</span><br><span class="line">      <span class="keyword">else</span> tmp = dat[r + <span class="number">1</span>].t - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>( now &gt; ans1 || ( now == ans1 &amp;&amp; ( <span class="built_in">abs</span>( ans2 ) &gt;= <span class="built_in">abs</span>( tmp ) ) ) ) &#123;</span><br><span class="line">      ans1 = now , ans2 = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>,ans1,ans2);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="联合省选-2020-b-丁香之路"><a href="https://loj.ac/problem/3310" target="_blank" rel="noopener">[联合省选 2020 B] 丁香之路</a></h5>
<p>存在欧拉回路的要求是每个点的度数都为偶数且连通. 于是用并查集维护即可.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; pii;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">3e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> f[N] , d[N] , _f[N] , _d[N] , n , m , s , mark[N];</span><br><span class="line">lol sum , ans;</span><br><span class="line"><span class="built_in">vector</span>&lt;pii&gt; E;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123; <span class="keyword">return</span> f[x] &lt; <span class="number">0</span> ? x : f[x] = find( f[x] ); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123;</span><br><span class="line">  u = find( u ) , v = find( v );</span><br><span class="line">  <span class="keyword">if</span>( u == v ) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span>( f[u] &lt; f[v] ) swap( u , v );</span><br><span class="line">  f[u] = v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">lol <span class="title">solve</span><span class="params">( <span class="keyword">int</span> s , <span class="keyword">int</span> t )</span> </span>&#123;</span><br><span class="line">  <span class="built_in">memcpy</span>( f + <span class="number">1</span> , _f + <span class="number">1</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * n );</span><br><span class="line">  <span class="built_in">memcpy</span>( d + <span class="number">1</span> , _d + <span class="number">1</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * n );</span><br><span class="line">  ans = sum , E.clear();</span><br><span class="line">  ++mark[t];</span><br><span class="line">  <span class="keyword">if</span>( s ^ t ) &#123;</span><br><span class="line">    d[s] ^= <span class="number">1</span>;</span><br><span class="line">    d[t] ^= <span class="number">1</span>;</span><br><span class="line">    merge( s , t );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , las = <span class="number">0</span> ; i &lt;= n ; ++i ) </span><br><span class="line">    <span class="keyword">if</span>( d[i] ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( las ) &#123;</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">int</span> j = las ; j &lt; i ; ++j )</span><br><span class="line">          merge( j , j + <span class="number">1</span> );</span><br><span class="line">        ans += i - las;</span><br><span class="line">        las = <span class="number">0</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> las = i;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , las = <span class="number">0</span> ; i &lt;= n ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( mark[i] ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( las ) E.push_back( pii( las , i ) );</span><br><span class="line">      las = i;</span><br><span class="line">    &#125;</span><br><span class="line">  sort( E.begin() , E.end() , []( pii a , pii b ) &#123; <span class="keyword">return</span> a.se - a.fi &lt; b.se - b.fi; &#125; );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">const</span> pii &amp; e : E ) &#123;</span><br><span class="line">    <span class="keyword">int</span> u = find( e.fi ) , v = find( e.se );</span><br><span class="line">    <span class="keyword">if</span>( u ^ v ) &#123;</span><br><span class="line">      merge( e.fi , e.se );</span><br><span class="line">      ans += <span class="number">2</span> * ( e.se - e.fi );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  --mark[t];</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;n,&amp;m,&amp;s); mark[s] = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">memset</span>( f , <span class="number">-1</span> , <span class="keyword">sizeof</span> f );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , v ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;v);</span><br><span class="line">    sum += <span class="built_in">abs</span>( u - v );</span><br><span class="line">    _d[u] ^= <span class="number">1</span> , _d[v] ^= <span class="number">1</span>;</span><br><span class="line">    merge( u , v );</span><br><span class="line">    mark[u] = mark[v] = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">memcpy</span>( _f + <span class="number">1</span> , f + <span class="number">1</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * n );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld "</span>,solve( s , i ));</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/06/16/Solutions/PKUSC2018-%E7%AE%80%E8%A6%81%E9%A2%98%E8%A7%A3/" rel="prev" title="[PKUSC2018] 简要题解">
      <i class="fa fa-chevron-left"></i> [PKUSC2018] 简要题解
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/06/29/Solutions/NOI%E7%B3%BB%E5%88%97-%E9%80%89%E5%81%9A/" rel="next" title="[NOI系列] 选做">
      [NOI系列] 选做 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-5"><a class="nav-link" href="#联合省选-2020-a-b-冰火战士"><span class="nav-number">1.</span> <span class="nav-text">[联合省选 2020 A | B] 冰火战士</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#联合省选-2020-a-组合数问题"><span class="nav-number">2.</span> <span class="nav-text">[联合省选 2020 A] 组合数问题</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#联合省选-2020-a-魔法商店"><span class="nav-number">3.</span> <span class="nav-text">[联合省选 2020 A] 魔法商店</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#联合省选-2020-a-b-信号传递"><span class="nav-number">4.</span> <span class="nav-text">[联合省选 2020 A | B] 信号传递</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#联合省选-2020-a-树"><span class="nav-number">5.</span> <span class="nav-text">[联合省选 2020 A] 树</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#联合省选-2020-a-作业题"><span class="nav-number">6.</span> <span class="nav-text">[联合省选 2020 A] 作业题</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#联合省选-2020-b-卡牌游戏"><span class="nav-number">7.</span> <span class="nav-text">[联合省选 2020 B] 卡牌游戏</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#联合省选-2020-b-消息传递"><span class="nav-number">8.</span> <span class="nav-text">[联合省选 2020 B] 消息传递</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#联合省选-2020-b-幸运数字"><span class="nav-number">9.</span> <span class="nav-text">[联合省选 2020 B] 幸运数字</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#联合省选-2020-b-丁香之路"><span class="nav-number">10.</span> <span class="nav-text">[联合省选 2020 B] 丁香之路</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Guyan</p>
  <div class="site-description" itemprop="description">水平低啊</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">126</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Guyan</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
