<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="其实只是水博客">
<meta property="og:type" content="article">
<meta property="og:title" content="[实验舱] 省选模拟">
<meta property="og:url" content="http://yoursite.com/2020/06/08/Solutions/%E5%AE%9E%E9%AA%8C%E8%88%B1%E7%9C%81%E9%80%89%E6%A8%A1%E6%8B%9F/index.html">
<meta property="og:site_name" content="Guyan&#39;s blog">
<meta property="og:description" content="其实只是水博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-06-08T08:15:08.000Z">
<meta property="article:modified_time" content="2020-06-17T11:03:03.737Z">
<meta property="article:author" content="Guyan">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/06/08/Solutions/%E5%AE%9E%E9%AA%8C%E8%88%B1%E7%9C%81%E9%80%89%E6%A8%A1%E6%8B%9F/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>[实验舱] 省选模拟 | Guyan's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Guyan's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/08/Solutions/%E5%AE%9E%E9%AA%8C%E8%88%B1%E7%9C%81%E9%80%89%E6%A8%A1%E6%8B%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guyan">
      <meta itemprop="description" content="水平低啊">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guyan's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [实验舱] 省选模拟
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-08 16:15:08" itemprop="dateCreated datePublished" datetime="2020-06-08T16:15:08+08:00">2020-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-17 19:03:03" itemprop="dateModified" datetime="2020-06-17T19:03:03+08:00">2020-06-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">题解</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>其实只是水博客</p>
<a id="more"></a>
<h5 id="sam"><a href="http://noi.ac/contest/343/problem/1760" target="_blank" rel="noopener">SAM</a></h5>
<p>令 <span class="math inline">\(f_i\)</span> 表示前 <span class="math inline">\(i\)</span> 个字符的答案. 对于 <span class="math inline">\(f_{i+1}\)</span> , 其值最多只会是 <span class="math inline">\(f_{i}+1\)</span> , 因为其子串也一定出现 , 于是每次插入字符 , 记录 <span class="math inline">\(\rm SAM\)</span> 上每个节点 <span class="math inline">\(\rm endpos\)</span> 的集合中的最小值. 每次不合法暴力跳就可以了 , 最多只会跳 <span class="math inline">\(n\)</span> 次 , 复杂度 <span class="math inline">\(O(n)\)</span> .</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> trs[N][<span class="number">2</span>] , lnk[N] , las = <span class="number">1</span> , len[N] , nidx = <span class="number">1</span> , fir[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ext</span><span class="params">( <span class="keyword">const</span> <span class="keyword">int</span> &amp; c , <span class="keyword">int</span> id )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> np , p , nq , q;</span><br><span class="line">  len[np = ++nidx] = len[p = las] + <span class="number">1</span>; fir[las = np] = id;</span><br><span class="line">  <span class="keyword">while</span>( p &amp;&amp; !trs[p][c] ) trs[p][c] = np , p = lnk[p];</span><br><span class="line">  <span class="keyword">if</span>( !p ) <span class="keyword">return</span> lnk[np] = <span class="number">1</span> , <span class="keyword">void</span>();</span><br><span class="line">  <span class="keyword">if</span>( len[q = trs[p][c]] == len[p] + <span class="number">1</span> ) <span class="keyword">return</span> lnk[np] = q , <span class="keyword">void</span>();</span><br><span class="line">  len[nq = ++nidx] = len[p] + <span class="number">1</span>; trs[nq][<span class="number">0</span>] = trs[q][<span class="number">0</span>] , trs[nq][<span class="number">1</span>] = trs[q][<span class="number">1</span>] , lnk[nq] = lnk[q] , fir[nq] = fir[q];</span><br><span class="line">  <span class="keyword">while</span>( p &amp;&amp; trs[p][c] == q ) trs[p][c] = nq , p = lnk[p];</span><br><span class="line">  lnk[np] = lnk[q] = nq;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"><span class="keyword">int</span> ans[N] , n;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%s"</span>,str+<span class="number">1</span>);</span><br><span class="line">  n = <span class="built_in">strlen</span>( str + <span class="number">1</span> );</span><br><span class="line">  ans[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u = <span class="number">1</span> , c ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    c = str[i] - <span class="string">'0'</span>;</span><br><span class="line">    ext( c , i );</span><br><span class="line">    u = trs[u][c];</span><br><span class="line">    <span class="keyword">while</span>( u != <span class="number">1</span> &amp;&amp; len[lnk[u]] + <span class="number">1</span> + fir[u] &gt; i ) u = lnk[u];</span><br><span class="line">    ans[i] = min( len[u] , i - fir[u] );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="t1"><a href="http://noi.ac/contest/343/problem/1764" target="_blank" rel="noopener">T1</a></h5>
<p>建出回文自动机 , 求出每个回文出现的次数 , 以及是否满足条件.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> U = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> len[N] , lnk[N] , val[N] , siz[N] , nidx = <span class="number">1</span> , n , las = <span class="number">0</span> , trs[N][<span class="number">10</span>] , Pow[N];</span><br><span class="line"><span class="keyword">bool</span> mark[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">( <span class="keyword">int</span> c , <span class="keyword">int</span> i )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> p , u , v;</span><br><span class="line">  p = las;</span><br><span class="line">  <span class="keyword">while</span>( str[i - len[p] - <span class="number">1</span>] != str[i] ) p = lnk[p];</span><br><span class="line">  <span class="keyword">if</span>( !trs[p][c] ) &#123;</span><br><span class="line">    u = ++nidx;</span><br><span class="line">    len[u] = len[p] + <span class="number">2</span>;</span><br><span class="line">    val[u] = len[u] &gt; <span class="number">1</span> ? ( val[p] + c + c * Pow[len[u] - <span class="number">1</span>] ) % <span class="number">3</span> : c % <span class="number">3</span>;</span><br><span class="line">    mark[u] = c &gt; <span class="number">0</span>;</span><br><span class="line">    v = lnk[p];</span><br><span class="line">    <span class="keyword">while</span>( str[i - len[v] - <span class="number">1</span>] != str[i] ) v = lnk[v];</span><br><span class="line">    lnk[u] = trs[v][c] , trs[p][c] = u;</span><br><span class="line">  &#125;</span><br><span class="line">  ++siz[las = trs[p][c]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> ans;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%s"</span>,str+<span class="number">1</span>);</span><br><span class="line">  len[<span class="number">1</span>] = <span class="number">-1</span> , lnk[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  n = <span class="built_in">strlen</span>( str + <span class="number">1</span> );</span><br><span class="line">  Pow[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) Pow[i] = <span class="number">10</span> * Pow[i - <span class="number">1</span>] % <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) ins( str[i] - <span class="string">'0'</span> , i );</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> c[N] , arr[N];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= nidx ; ++i ) ++c[len[i]];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) c[i] += c[i - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = nidx ; i &gt; <span class="number">1</span> ; --i ) arr[c[len[i]]--] = i;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = nidx - <span class="number">1</span> , u ; i ; --i ) &#123;</span><br><span class="line">    u = arr[i];</span><br><span class="line">    siz[lnk[u]] += siz[u];</span><br><span class="line">    <span class="keyword">if</span>( !val[u] &amp;&amp; mark[u] )</span><br><span class="line">      ans += siz[u];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( str[i] == <span class="string">'0'</span> )</span><br><span class="line">      ++ans;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%lld"</span>,ans);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="海盗"><a href="http://noi.ac/contest/343/problem/1994" target="_blank" rel="noopener">海盗</a></h5>
<p>如果已经知道第 <span class="math inline">\(i-1\)</span> 个人的策略. 对于第 <span class="math inline">\(i\)</span> 个人 , 最优先获得 <span class="math inline">\(v_i\)</span> 个人的支持. 于是选出上一个人的决策中得钱最少的 <span class="math inline">\(v_i-1\)</span> 个人 , 令本轮他们的所得加一 , 如果超出 <span class="math inline">\(k\)</span> , 说明一定会扔进海里.</p>
<p>需要考虑最后一段 <span class="math inline">\(-1\)</span> , 这些人一定会支持.</p>
<p>于是用 <span class="math inline">\(\rm splay\)</span> 维护即可.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> IN_LEN = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> buf[IN_LEN] , *s , *t;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Getchar</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="keyword">return</span> s == t &amp;&amp; ( t = ( s = buf ) + fread( buf , <span class="number">1</span> , IN_LEN , <span class="built_in">stdin</span> ) ) , s == t ? <span class="number">-1</span> : *s++; &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>( <span class="title">T</span> &amp; <span class="title">x</span> ) &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c , f; c = Getchar() , x = f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span> ) &#123; <span class="keyword">if</span>( c == <span class="string">'-'</span> ) f = <span class="number">1</span>; c = Getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span>( c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span> ) x = x * <span class="number">10</span> + c - <span class="number">48</span> , c = Getchar(); </span><br><span class="line">    x = f ? -x : x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> lol INF = <span class="number">1e18</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> p[N] , son[N][<span class="number">2</span>] , nidx , rt , addtag[N] , settag[N] , siz[N];</span><br><span class="line">lol val[N] , sum[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">which</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123; <span class="keyword">return</span> p[x] ? x == son[p[x]][<span class="number">1</span>] : <span class="number">0</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">up</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123; sum[u] = min( val[u] + sum[son[u][<span class="number">0</span>]] + sum[son[u][<span class="number">1</span>]] , INF ) , siz[u] = <span class="number">1</span> + siz[son[u][<span class="number">0</span>]] + siz[son[u][<span class="number">1</span>]]; &#125;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span> _settag( <span class="keyword">int</span> u ) &#123; settag[u] = <span class="number">1</span> , sum[u] = val[u] = <span class="number">0</span> , addtag[u] = <span class="number">0</span>; &#125;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span> _addtag( <span class="keyword">int</span> u , <span class="keyword">int</span> v ) &#123;</span><br><span class="line">  sum[u] += <span class="number">1L</span>L * siz[u] * v;</span><br><span class="line">  val[u] += v;</span><br><span class="line">  addtag[u] += v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dn</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( settag[u] ) &#123;</span><br><span class="line">    settag[u] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>( son[u][<span class="number">0</span>] ) _settag( son[u][<span class="number">0</span>] );</span><br><span class="line">    <span class="keyword">if</span>( son[u][<span class="number">1</span>] ) _settag( son[u][<span class="number">1</span>] );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>( addtag[u] ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( son[u][<span class="number">0</span>] ) _addtag( son[u][<span class="number">0</span>] , addtag[u] );</span><br><span class="line">    <span class="keyword">if</span>( son[u][<span class="number">1</span>] ) _addtag( son[u][<span class="number">1</span>] , addtag[u] );</span><br><span class="line">    addtag[u] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">connect</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v , <span class="keyword">int</span> w )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( u ) p[u] = v;</span><br><span class="line">  <span class="keyword">if</span>( v ) son[v][w] = u;</span><br><span class="line">  <span class="keyword">else</span> rt = u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> w , f; f = p[u] , w = which( u );</span><br><span class="line">  connect( u , p[f] , which( f ) );</span><br><span class="line">  connect( son[u][w ^ <span class="number">1</span>] , f , w );</span><br><span class="line">  connect( f , u , w ^ <span class="number">1</span> ),up( f );</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> f , S[N] , tp; v = p[v];</span><br><span class="line">  S[tp = <span class="number">1</span>] = f = u;</span><br><span class="line">  <span class="keyword">while</span>( p[f] != v ) S[++tp] = f = p[f];</span><br><span class="line">  <span class="keyword">while</span>( tp ) dn( S[tp--] );</span><br><span class="line">  <span class="keyword">while</span>( ( f = p[u] ) != v ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( p[f] != v ) rotate( which( u ) ^ which( f ) ? u : f );</span><br><span class="line">    rotate( u );</span><br><span class="line">  &#125; up( u );</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">ins</span><span class="params">( lol v )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( !rt ) &#123;</span><br><span class="line">    rt = ++nidx;</span><br><span class="line">    val[rt] = sum[rt] = v;</span><br><span class="line">    siz[rt] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> u = ++nidx , x = rt , w;</span><br><span class="line">  val[u] = sum[u] = v , siz[u] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span>( x ) &#123;</span><br><span class="line">    dn( x );</span><br><span class="line">    w = ( val[x] &lt;= v );</span><br><span class="line">    <span class="keyword">if</span>( !son[x][w] ) &#123;</span><br><span class="line">      p[son[x][w] = u] = x;</span><br><span class="line">      splay( x , rt );</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    x = son[x][w];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find_siz</span><span class="params">( <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> x = rt , t;</span><br><span class="line">  <span class="keyword">while</span>( x ) &#123;</span><br><span class="line">    t = <span class="number">1</span> , dn( x );</span><br><span class="line">    <span class="keyword">if</span>( son[x][<span class="number">0</span>] ) t += siz[son[x][<span class="number">0</span>]];</span><br><span class="line">    <span class="keyword">if</span>( k == t ) <span class="keyword">return</span> splay( x , rt );</span><br><span class="line">    <span class="keyword">if</span>( k &lt; t ) x = son[x][<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">else</span> k -= t , x = son[x][<span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">abort</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">lol <span class="title">qry</span><span class="params">( <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( k &lt;= <span class="number">0</span> ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  dn( rt );</span><br><span class="line">  <span class="keyword">if</span>( k == siz[rt] ) <span class="keyword">return</span> sum[rt];</span><br><span class="line">  find_siz( k + <span class="number">1</span> );</span><br><span class="line">  dn( rt );</span><br><span class="line">  <span class="keyword">return</span> sum[son[rt][<span class="number">0</span>]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">work</span><span class="params">( <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( k &lt;= <span class="number">0</span> ) <span class="keyword">return</span> _settag( rt ) , <span class="keyword">void</span>();</span><br><span class="line">  <span class="keyword">if</span>( k == siz[rt] ) &#123;</span><br><span class="line">    _addtag( rt , <span class="number">1</span> );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; </span><br><span class="line">  find_siz( k + <span class="number">1</span> ); dn( rt );</span><br><span class="line">  _addtag( son[rt][<span class="number">0</span>] , <span class="number">1</span> );</span><br><span class="line">  swap( son[rt][<span class="number">0</span>] , son[rt][<span class="number">1</span>] );</span><br><span class="line">  val[rt] = <span class="number">0</span>;</span><br><span class="line">  _settag( son[rt][<span class="number">0</span>] );</span><br><span class="line">  up( rt );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lol ans[N] , k;</span><br><span class="line"><span class="keyword">int</span> n , dat[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  dn( u );</span><br><span class="line">  <span class="keyword">if</span>( son[u][<span class="number">0</span>] ) dfs( son[u][<span class="number">0</span>] );</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%lld "</span>,val[u]);</span><br><span class="line">  <span class="keyword">if</span>( son[u][<span class="number">1</span>] ) dfs( son[u][<span class="number">1</span>] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  read( n ) , read( k );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) read( dat[i] ) , --dat[i];</span><br><span class="line">  ans[<span class="number">1</span>] = k;</span><br><span class="line">  ins( k );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> , _ = <span class="number">0</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    lol tmp = max( qry( dat[i] - _ ) + dat[i] - _ , <span class="number">0L</span>L );</span><br><span class="line">    <span class="keyword">if</span>( tmp &gt; k ) ++_ , ans[i] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      ans[i] = k - tmp;</span><br><span class="line">      work( dat[i] - _ );</span><br><span class="line">      <span class="keyword">while</span>( _-- ) ins( <span class="number">0</span> );</span><br><span class="line">      _ = <span class="number">0</span>;</span><br><span class="line">      ins( ans[i] );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans[i]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="sam2"><a href="http://noi.ac/contest/344/problem/1761" target="_blank" rel="noopener">SAM2</a></h5>
<p>注意到是个 <span class="math inline">\(\rm DAG\)</span> , 于是状态数最少是 <span class="math inline">\(n+1\)</span> 个. 用类似 <span class="math inline">\(\rm SAM\)</span> 的构建方法 , 每次连转移 , 由于 <span class="math inline">\(\rm SAM\)</span> 的转移数不超过 <span class="math inline">\(3n - 4\)</span> , 构造出的自动机其转移数不会超过 <span class="math inline">\(2n\)</span> .</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> U = <span class="number">26</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> nidx = <span class="number">1</span> , las = <span class="number">1</span> , len[N] , trs[N][U] , lnk[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ext</span><span class="params">( <span class="keyword">const</span> <span class="keyword">int</span> &amp; c )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> np , p , nq , q;</span><br><span class="line">  len[np = ++nidx] = len[p = las] + <span class="number">1</span>; las = np;</span><br><span class="line">  <span class="keyword">while</span>( p &amp;&amp; !trs[p][c] ) trs[p][c] = np , p = lnk[p];</span><br><span class="line">  <span class="keyword">if</span>( !p ) lnk[np] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">else</span> lnk[np] = trs[p][c];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m;</span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%s"</span>,str+<span class="number">1</span>);</span><br><span class="line">  n = <span class="built_in">strlen</span>( str + <span class="number">1</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) ext( str[i] - <span class="string">'a'</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= nidx ; ++i )</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; U ; ++j )</span><br><span class="line">      <span class="keyword">if</span>( trs[i][j] ) ++m;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>,nidx,m);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= nidx ; ++i )</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; U ; ++j )</span><br><span class="line">      <span class="keyword">if</span>( trs[i][j] )</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d %d %c\n"</span>,i,trs[i][j],j+<span class="string">'a'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="zyb的赈灾计划"><a href="http://noi.ac/contest/344/problem/1763" target="_blank" rel="noopener">ZYB的赈灾计划</a></h5>
<p>对于前 <span class="math inline">\(i\)</span> 个数 , 令其最大值为 <span class="math inline">\(\text{mx}_i\)</span> , 则一定有一个子序列是以 <span class="math inline">\(\text{mx}_i\)</span> 为最大值 , 可以发现继续加数只需知道另一个子序列的最大值 , 于是令 <span class="math inline">\(f_{i,j}\)</span> 表示前 <span class="math inline">\(i\)</span> 个数 , 除 <span class="math inline">\(\text{mx}_i\)</span> 外的子序列的最大值为 <span class="math inline">\(j\)</span> 的最小花费. 有转移 <span class="math display">\[
\begin{aligned}
&amp;a_i &gt; \text{mx}_{i-1}:  \\
&amp; &amp;f_{i,mx} = f_{i-1,0} \\
&amp;a_i &lt; \text{mx}_{i-1}: \\
&amp; &amp; \begin{cases}
f_{i,j} &amp;= f_{i-1,j} + j - a_i , &amp;a_i&lt;j&lt;\text{mx}_i \\
f_{i,j} &amp;= f_{i-1,j} + \text{mx}_i - a_i , &amp; j &lt; a_i \\
f_{i,a_i} &amp;= \min_{k &lt; a_i} f_{i-1,k} 
\end{cases}
\end{aligned}
\]</span> 可以发现是前缀求最小值 , 区间加 , 区间加一次函数的形式.</p>
<p>考虑分块维护 , 在块内维护凸包 , 每次加直接在凸包上走 , 分散块直接修改 , 重构凸包.</p>
<p>不过数据不强 , 直接分块暴力找最小值也可以.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>,lol&gt; pil;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> BLOC = <span class="number">3e2</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> _BLOC = <span class="number">3e2</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> DS &#123;</span><br><span class="line">  <span class="keyword">int</span> bloc;</span><br><span class="line">  lol mn[BLOC];</span><br><span class="line">  <span class="keyword">int</span> Bid[N] , Bl[BLOC] , Br[BLOC] , bidx;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">Array</span> &#123;</span></span><br><span class="line">    pil dat[N];</span><br><span class="line">    <span class="keyword">int</span> cur , tot , _cur;</span><br><span class="line">    lol K , B , mn;</span><br><span class="line">    Array() &#123; tot = cur = <span class="number">0</span> , mn = <span class="number">1e18</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">( <span class="keyword">int</span> idx , lol v )</span> </span>&#123;</span><br><span class="line">      <span class="keyword">bool</span> flag = mn &gt; v;</span><br><span class="line">      mn = min( mn , v );</span><br><span class="line">      v -= K * idx + B;</span><br><span class="line">      dat[++tot] = pil( idx , v );</span><br><span class="line">      _cur = tot;</span><br><span class="line">      <span class="keyword">while</span>( _cur &gt; <span class="number">1</span> &amp;&amp; dat[_cur - <span class="number">1</span>].fi &gt; dat[_cur].fi ) &#123;</span><br><span class="line">        swap( dat[_cur - <span class="number">1</span>] , dat[_cur] );</span><br><span class="line">        --_cur;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>( _cur &lt;= cur ) ++cur;</span><br><span class="line">      <span class="keyword">if</span>( flag ) cur = _cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">lol <span class="title">qry</span><span class="params">( <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">      lol res = <span class="number">1e18</span>;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= tot ; ++i )</span><br><span class="line">        <span class="keyword">if</span>( dat[i].fi &gt; k ) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">else</span> res = min( res , dat[i].se + dat[i].fi * K + B );</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">( lol k , lol b )</span> </span>&#123;</span><br><span class="line">      mn += b , B += b;</span><br><span class="line">      mn += dat[cur].fi * k;</span><br><span class="line">      <span class="keyword">if</span>( !k ) <span class="keyword">return</span>;</span><br><span class="line">      K += k;</span><br><span class="line">      <span class="keyword">if</span>( cur &gt; <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">int</span> i = cur - <span class="number">1</span> ; i ; --i )</span><br><span class="line">          <span class="keyword">if</span>( dat[i].se + dat[i].fi * K + B &lt;= mn )</span><br><span class="line">            mn = dat[i].se + dat[i].fi * K + B , cur = i;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rebuild</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">      mn = <span class="number">1e18</span> , cur = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= tot ; ++i )</span><br><span class="line">        <span class="keyword">if</span>( dat[i].se + dat[i].fi * K + B &lt; mn )</span><br><span class="line">          mn = dat[i].se + dat[i].fi * K + B , cur = i;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; b[BLOC];</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">( <span class="keyword">int</span> n )</span> </span>&#123;</span><br><span class="line">    bloc = <span class="built_in">ceil</span>( <span class="built_in">sqrt</span>( n ) );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> , r ; i &lt;= n ; i = r + <span class="number">1</span> ) &#123;</span><br><span class="line">      r = min( n , i + bloc - <span class="number">1</span> );</span><br><span class="line">      Bl[++bidx] = i; Br[bidx] = r;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> j = i ; j &lt;= r ; ++j )</span><br><span class="line">        Bid[j] = bidx;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">lol <span class="title">qry</span><span class="params">( <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> bid = Bid[k];</span><br><span class="line">    lol res = <span class="number">1e18</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = bid - <span class="number">1</span> ; i ; --i )</span><br><span class="line">      res = min( res , b[i].mn );</span><br><span class="line">    res = min( res , b[bid].qry( k ) );</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">( <span class="keyword">int</span> L , <span class="keyword">int</span> R , lol _k , lol _b )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> bidl = Bid[L] , bidr = Bid[R];</span><br><span class="line">    <span class="keyword">if</span>( bidl == bidr ) &#123;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= b[bidl].tot ; ++i )</span><br><span class="line">        <span class="keyword">if</span>( L &lt;= b[bidl].dat[i].fi &amp;&amp; b[bidl].dat[i].fi &lt;= R )</span><br><span class="line">          b[bidl].dat[i].se += b[bidl].dat[i].fi * _k + _b;</span><br><span class="line">      b[bidl].rebuild();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = bidl + <span class="number">1</span> ; i &lt; bidr ; ++i )</span><br><span class="line">      b[i].add( _k , _b );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= b[bidr].tot ; ++i )</span><br><span class="line">      <span class="keyword">if</span>( b[bidr].dat[i].fi &gt; R ) <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">else</span> b[bidr].dat[i].se += b[bidr].dat[i].fi * _k + _b;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = b[bidl].tot ; i ; --i )</span><br><span class="line">      <span class="keyword">if</span>( b[bidl].dat[i].fi &lt; L ) <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">else</span> b[bidl].dat[i].se += b[bidl].dat[i].fi * _k + _b;</span><br><span class="line">    b[bidl].rebuild();</span><br><span class="line">    b[bidr].rebuild();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">( <span class="keyword">int</span> x , lol v )</span> </span>&#123;</span><br><span class="line">    b[Bid[x]].ins( x , v );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> f[N] , dat[N] , n;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,dat+i);</span><br><span class="line">  <span class="keyword">if</span>( n &lt;= <span class="number">5000</span> ) &#123;</span><br><span class="line">    <span class="built_in">memset</span>( f , <span class="number">0x3f</span> , <span class="keyword">sizeof</span> f );</span><br><span class="line">    f[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , mx = <span class="number">0</span> , mn ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( dat[i] &gt; mx ) &#123;</span><br><span class="line">        f[mx] = f[<span class="number">0</span>];</span><br><span class="line">        mx = dat[i];</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        mn = <span class="number">1e9</span>; </span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; dat[i] ; ++j ) &#123;</span><br><span class="line">          mn = min( mn , f[j] );</span><br><span class="line">          f[j] += mx - dat[i];</span><br><span class="line">        &#125;</span><br><span class="line">        f[dat[i]] = mn;</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">int</span> j = dat[i] + <span class="number">1</span> ; j &lt; mx ; ++j )</span><br><span class="line">          f[j] += j - dat[i];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= n ; ++i )</span><br><span class="line">      res = min( res , f[i] );</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    DS::init( n );</span><br><span class="line">    DS::ins( <span class="number">0</span> , <span class="number">0</span> );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , mx = <span class="number">0</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( dat[i] &gt; mx ) &#123;</span><br><span class="line">        f[mx] = DS::qry( <span class="number">0</span> );</span><br><span class="line">        <span class="keyword">if</span>( mx ) DS::ins( mx , f[mx] );</span><br><span class="line">        mx = dat[i];</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        lol tmp = DS::qry( dat[i] );</span><br><span class="line">        DS::ins( dat[i] , tmp );</span><br><span class="line">        DS::add( <span class="number">0</span> , dat[i] - <span class="number">1</span> , <span class="number">0</span> , mx - dat[i] );</span><br><span class="line">        <span class="keyword">if</span>( dat[i] + <span class="number">1</span> &lt; mx ) DS::add( dat[i] + <span class="number">1</span> , mx - <span class="number">1</span> , <span class="number">1</span> , -dat[i] );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,DS::qry( n ) );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="重复"><a href="http://noi.ac/problem/1995" target="_blank" rel="noopener">重复</a></h5>
<p>考虑 <span class="math inline">\(f_i^2\)</span> 的组合意义 , 就是相同子序列对数. 于是令 <span class="math inline">\(f_{i,j}\)</span> 表示第一个子序列在 <span class="math inline">\(1\sim i\)</span> , 第二个子序列在 <span class="math inline">\(1 \sim j\)</span> 的子序列对数. 如果 <span class="math inline">\(s_i \neq s_j\)</span> , 则以 <span class="math inline">\(s_i,s_j\)</span> 结尾的子序列不同. 否则以 <span class="math inline">\(s_i,s_j\)</span> 结尾的相同子序列对数为 <span class="math inline">\(f_{i-1,j-1}\)</span>. 转移就是二维前缀和的形式.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> mod;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">pls</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; a += b - mod; <span class="keyword">return</span> a + ( a &gt;&gt; <span class="number">31</span> &amp; mod ); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">mns</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; a -= b; <span class="keyword">return</span> a + ( a &gt;&gt; <span class="number">31</span> &amp; mod ); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">inc</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; a += b - mod; a += a &gt;&gt; <span class="number">31</span> &amp; mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dec</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; a -= b; a += a &gt;&gt; <span class="number">31</span> &amp; mod; &#125;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> f[N][N] , n;</span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%s"</span>,str+<span class="number">1</span>);</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;mod);</span><br><span class="line">  n = <span class="built_in">strlen</span>( str + <span class="number">1</span> );</span><br><span class="line">  f[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= n ; ++i ) f[<span class="number">0</span>][i] = f[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++j ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( str[i] == str[j] )</span><br><span class="line">        f[i][j] = pls( f[i - <span class="number">1</span>][j] , f[i][j - <span class="number">1</span>] );</span><br><span class="line">      <span class="keyword">else</span> f[i][j] = mns( pls( f[i - <span class="number">1</span>][j] , f[i][j - <span class="number">1</span>] ) , f[i - <span class="number">1</span>][j - <span class="number">1</span>] );</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d"</span>,f[n][n]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ball"><a href="http://noi.ac/contest/345/problem/1771" target="_blank" rel="noopener">ball</a></h5>
<p>将每一段视作点 , 将走的路径连起来 , 是 <span class="math inline">\(n\)</span> 条链 , 删去一个交换就是交换一下后两段. 于是直接 <span class="math inline">\(\rm LCT\)</span> 维护.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> IN_LEN = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> buf[IN_LEN] , *s , *t;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Getchar</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="keyword">return</span> s == t &amp;&amp; ( t = ( s = buf ) + fread( buf , <span class="number">1</span> , IN_LEN , <span class="built_in">stdin</span> ) ) , s == t ? <span class="number">-1</span> : *s++; &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>( <span class="title">T</span> &amp; <span class="title">x</span> ) &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c , f; c = Getchar() , x = f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span> ) &#123; <span class="keyword">if</span>( c == <span class="string">'-'</span> ) f = <span class="number">1</span>; c = Getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span>( c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span> ) x = x * <span class="number">10</span> + c - <span class="number">48</span> , c = Getchar();</span><br><span class="line">    x = f ? -x : x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> son[N][<span class="number">2</span>] , p[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">which</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123; <span class="keyword">return</span> p[x] ? x == son[p[x]][<span class="number">1</span>] : <span class="number">0</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">noroot</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123; <span class="keyword">return</span> p[x] ? x == son[p[x]][<span class="number">0</span>] || x == son[p[x]][<span class="number">1</span>] : <span class="number">0</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> f , w; w = which( u ) , f = p[u];</span><br><span class="line">  p[u] = p[f]; <span class="keyword">if</span>( noroot( f ) ) son[p[f]][which( f )] = u;</span><br><span class="line">  <span class="keyword">if</span>( ( son[f][w] = son[u][w ^ <span class="number">1</span>] ) ) p[son[u][w ^ <span class="number">1</span>]] = f;</span><br><span class="line">  son[p[f] = u][w ^ <span class="number">1</span>] = f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> f; <span class="keyword">while</span>( noroot( u ) ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( noroot( f = p[u] ) ) rotate( which( u ) ^ which( f ) ? u : f );</span><br><span class="line">    rotate( u );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">access</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123; <span class="keyword">for</span>( <span class="keyword">int</span> t = <span class="number">0</span> ; u ; t = u , u = p[u] ) splay( u ) , son[u][<span class="number">1</span>] = t; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">findrt</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123; access( u ); splay( u ); <span class="keyword">while</span>( son[u][<span class="number">0</span>] ) u = son[u][<span class="number">0</span>]; <span class="keyword">return</span> u; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m , q , nidx , rt[N] , rmp[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ID</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> u[<span class="number">2</span>] , v[<span class="number">2</span>];</span><br><span class="line">&#125; dat[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  read( n ) , read( m ) , nidx = n;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) rt[i] = i;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , v ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    read( u ); v = u + <span class="number">1</span>;</span><br><span class="line">    dat[i].v[<span class="number">0</span>] = rt[u];</span><br><span class="line">    dat[i].v[<span class="number">1</span>] = rt[v];</span><br><span class="line">    dat[i].u[<span class="number">0</span>] = rt[u] = ++nidx;</span><br><span class="line">    dat[i].u[<span class="number">1</span>] = rt[v] = ++nidx;</span><br><span class="line">    p[dat[i].v[<span class="number">0</span>]] = dat[i].u[<span class="number">1</span>];</span><br><span class="line">    p[dat[i].v[<span class="number">1</span>]] = dat[i].u[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    rmp[rt[i]] = i;</span><br><span class="line">  read( q );</span><br><span class="line">  <span class="keyword">int</span> opt , x;</span><br><span class="line">  <span class="keyword">while</span>( q-- ) &#123;</span><br><span class="line">    read( opt ) , read( x );</span><br><span class="line">    <span class="keyword">if</span>( opt == <span class="number">2</span> ) </span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,rmp[findrt(x)]);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">int</span> v0 = dat[x].v[<span class="number">0</span>] , v1 = dat[x].v[<span class="number">1</span>];</span><br><span class="line">      access( v0 ) , splay( v0 );</span><br><span class="line">      access( v1 ) , splay( v1 );</span><br><span class="line">      swap( son[v1][<span class="number">0</span>] , son[v0][<span class="number">0</span>] );</span><br><span class="line">      swap( p[son[v1][<span class="number">0</span>]] , p[son[v0][<span class="number">0</span>]] );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="c"><a href="http://noi.ac/contest/345/problem/1778" target="_blank" rel="noopener">C</a></h5>
<p>先考虑所有点的度数都是偶数的情况 , 求出欧拉回路后 ,隔一条边删一条边. 如果有度数为奇数的点 , 新建一个虚点 , 让所有度数为奇数的点向其连边.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> IN_LEN = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> buf[IN_LEN] , *s , *t;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Getchar</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="keyword">return</span> s == t &amp;&amp; ( t = ( s = buf ) + fread( buf , <span class="number">1</span> , IN_LEN , <span class="built_in">stdin</span> ) ) , s == t ? <span class="number">-1</span> : *s++; &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>( <span class="title">T</span> &amp; <span class="title">x</span> ) &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c , f; c = Getchar() , x = f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span> ) &#123; <span class="keyword">if</span>( c == <span class="string">'-'</span> ) f = <span class="number">1</span>; c = Getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span>( c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span> ) x = x * <span class="number">10</span> + c - <span class="number">48</span> , c = Getchar();</span><br><span class="line">    x = f ? -x : x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> head[N] , eidx = <span class="number">1</span> , d[N] , n , m , ans[N] , cur[N];</span><br><span class="line"><span class="keyword">bool</span> mark[N];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; path , p;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt , to; &#125; edge[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123;</span><br><span class="line">  edge[++eidx] = (Edge) &#123; head[u] , v &#125;; head[u] = eidx;</span><br><span class="line">  edge[++eidx] = (Edge) &#123; head[v] , u &#125;; head[v] = eidx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> &amp; i = cur[u] ; i ; i = edge[i].nxt )</span><br><span class="line">    <span class="keyword">if</span>( !mark[i &gt;&gt; <span class="number">1</span>] ) &#123;</span><br><span class="line">      mark[i &gt;&gt; <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">int</span> tmp = i;</span><br><span class="line">      dfs( edge[i].to );</span><br><span class="line">      path.push_back( tmp &gt;&gt; <span class="number">1</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  read( n ) , read( m );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , v ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    read( u ) , read( v );</span><br><span class="line">    addedge( u , v );</span><br><span class="line">    ++d[u] , ++d[v];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( d[i] &amp; <span class="number">1</span> )</span><br><span class="line">      addedge( <span class="number">0</span> , i );</span><br><span class="line">    d[i] = ( d[i] + <span class="number">1</span> ) / <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">memcpy</span>( cur , head , <span class="keyword">sizeof</span> head );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    path.clear();</span><br><span class="line">    dfs( i );</span><br><span class="line">    <span class="keyword">if</span>( i ) <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> , t = path.size() ; i &lt; t ; i += <span class="number">2</span> ) ans[path[i]] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">bool</span> flag = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> , t = path.size() ; i &lt; t ; i += <span class="number">2</span> )</span><br><span class="line">        <span class="keyword">if</span>( path[i] &gt; m ) flag = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = flag , t = path.size() ; i &lt; t ; i += <span class="number">2</span> )</span><br><span class="line">        ans[path[i]] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( ans[i] ) --d[edge[i&lt;&lt;<span class="number">1</span>].to] , --d[edge[i&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].to];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> u = <span class="number">1</span> ; u &lt;= n ; ++u )</span><br><span class="line">    <span class="keyword">if</span>( d[u] &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] ; i ; i = edge[i].nxt )</span><br><span class="line">        <span class="keyword">if</span>( ( i &gt;&gt; <span class="number">1</span> ) &lt;= m &amp;&amp; !ans[i &gt;&gt; <span class="number">1</span>] ) &#123;</span><br><span class="line">          ans[i &gt;&gt; <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">          --d[edge[i].to];</span><br><span class="line">          <span class="keyword">if</span>( !--d[u] ) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d "</span>,ans[i]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="寄蒜几盒"><a href="http://noi.ac/contest/345/problem/1996" target="_blank" rel="noopener">寄蒜几盒</a></h5>
<p>考虑从当前点能 '看到' 多边形上哪些边. 如果被染色了 , 最多只能看到 <span class="math inline">\(\frac{n}{2} -1\)</span> 条边 , 否则没有被染色. 可以二分得出可以看到的边数 , 这里参照神仙代码写了倍增.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">typedef</span> __int128 ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , T , q , cnt;</span><br><span class="line">lol x[N] , y[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">nxt</span><span class="params">( <span class="keyword">int</span> id )</span> </span>&#123; <span class="keyword">return</span> id == n ? <span class="number">1</span> : id + <span class="number">1</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">chk</span><span class="params">( <span class="keyword">int</span> id , ll _x , ll _y )</span> </span>&#123;</span><br><span class="line">  ll dx1 = x[id] - _x , dy1 = y[id] - _y ,</span><br><span class="line">     dx2 = x[nxt( id )] - _x , dy2 = y[nxt( id )] - _y;</span><br><span class="line">  <span class="keyword">return</span> dx1 * dy2 &gt;= dy1 * dx2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;T,&amp;n);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%lld%lld"</span>,x+i,y+i);</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;q);</span><br><span class="line">  lol X , Y;</span><br><span class="line">  <span class="keyword">while</span>( q-- ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%lld%lld"</span>,&amp;X,&amp;Y);</span><br><span class="line">    <span class="keyword">if</span>( T ) &#123;</span><br><span class="line">      X ^= <span class="number">1L</span>L * cnt * cnt * cnt;</span><br><span class="line">      Y ^= <span class="number">1L</span>L * cnt * cnt * cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> f1 = chk( <span class="number">1</span> , X , Y ) , f2 = chk( n / <span class="number">2</span> + <span class="number">1</span> , X , Y );</span><br><span class="line">    <span class="keyword">if</span>( f1 &amp;&amp; f2 ) &#123; <span class="built_in">puts</span>(<span class="string">"DA"</span>); ++cnt; <span class="keyword">continue</span>; &#125;</span><br><span class="line">    <span class="keyword">if</span>( !f1 &amp;&amp; !f2 ) &#123; <span class="built_in">puts</span>(<span class="string">"NE"</span>); <span class="keyword">continue</span>; &#125;</span><br><span class="line">    <span class="keyword">int</span> p = f1 ? <span class="number">1</span> : n / <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">17</span> , c = <span class="number">0</span> ; ~i ; --i )</span><br><span class="line">      <span class="keyword">if</span>( (c|(<span class="number">1</span>&lt;&lt;i)) &lt; n / <span class="number">2</span> &amp;&amp; chk( (p+(<span class="number">1</span>&lt;&lt;i)<span class="number">-1</span>)%n+<span class="number">1</span> , X , Y ) )</span><br><span class="line">        p = ( p + ( <span class="number">1</span> &lt;&lt; i ) - <span class="number">1</span> ) % n + <span class="number">1</span> , c += ( <span class="number">1</span> &lt;&lt; i );</span><br><span class="line">    <span class="keyword">if</span>( chk( (p+n/<span class="number">2</span><span class="number">-1</span>)%n+<span class="number">1</span> , X , Y ) ) <span class="built_in">puts</span>(<span class="string">"DA"</span>),++cnt;</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">"NE"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="b"><a href="http://noi.ac/contest/346/problem/1770" target="_blank" rel="noopener">B</a></h5>
<p>相交的只能是左右和上下. 二分图匹配.</p>
<p>由于是单调的 , 线段树优化建图.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Network_flows &#123;</span><br><span class="line">  <span class="keyword">int</span> head[M] , eidx , dep[M] , cur[M] , st , ed , que[M] , he , ta;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt , to , flow , cap; &#125; edge[M &lt;&lt; <span class="number">5</span>];</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v , <span class="keyword">int</span> cap )</span> </span>&#123;</span><br><span class="line">    edge[++eidx] = (Edge) &#123; head[u] , v , <span class="number">0</span> , cap &#125;; head[u] = eidx;</span><br><span class="line">    edge[++eidx] = (Edge) &#123; head[v] , u , <span class="number">0</span> , <span class="number">0</span> &#125;; head[v] = eidx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">( <span class="keyword">int</span> s , <span class="keyword">int</span> t )</span> </span>&#123; st = s , ed = t; <span class="built_in">memset</span>( head , <span class="number">-1</span> , <span class="keyword">sizeof</span> head ) , eidx = <span class="number">-1</span>; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>( dep , <span class="number">0</span> , <span class="keyword">sizeof</span> dep );</span><br><span class="line">    dep[que[he = ta = <span class="number">1</span>] = st] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>( he &lt;= ta ) &#123;</span><br><span class="line">      <span class="keyword">int</span> u = que[he++];</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] , v ; ~i ; i = edge[i].nxt )</span><br><span class="line">        <span class="keyword">if</span>( !dep[v = edge[i].to] &amp;&amp; edge[i].cap &gt; edge[i].flow )</span><br><span class="line">          dep[que[++ta] = v] = dep[u] + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dep[ed] != <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> fl )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( u == ed || !fl ) <span class="keyword">return</span> fl;</span><br><span class="line">    <span class="keyword">int</span> g = <span class="number">0</span> , d;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> &amp; i = cur[u] ; ~i ; i = edge[i].nxt )</span><br><span class="line">      <span class="keyword">if</span>( dep[edge[i].to] == dep[u] + <span class="number">1</span> &amp;&amp; ( d = dfs( edge[i].to , min( edge[i].cap - edge[i].flow , fl - g ) ) ) ) &#123;</span><br><span class="line">        edge[i].flow += d , edge[i ^ <span class="number">1</span>].flow -= d;</span><br><span class="line">        <span class="keyword">if</span>( ( g += d ) &gt;= fl ) <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">return</span> g;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">dinic</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( bfs() ) &#123;</span><br><span class="line">      <span class="built_in">memcpy</span>( cur , head , <span class="keyword">sizeof</span> cur );</span><br><span class="line">      res += dfs( st , INF );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">using</span> <span class="keyword">namespace</span> Network_flows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> A[N] , B[N] , C[N] , D[N] , n , nidx , son[N &lt;&lt; <span class="number">5</span>][<span class="number">2</span>] , rt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> &amp; u , <span class="keyword">int</span> diff )</span> </span>&#123;</span><br><span class="line">  u = ++nidx;</span><br><span class="line">  <span class="keyword">if</span>( l == r ) &#123;</span><br><span class="line">    addedge( u , l + diff , <span class="number">1</span> );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  build( l , mid , son[u][<span class="number">0</span>] , diff );</span><br><span class="line">  build( mid + <span class="number">1</span> , r , son[u][<span class="number">1</span>] , diff );</span><br><span class="line">  addedge( u , son[u][<span class="number">0</span>] , INF );</span><br><span class="line">  addedge( u , son[u][<span class="number">1</span>] , INF );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Addedge</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> u , <span class="keyword">int</span> L , <span class="keyword">int</span> R , <span class="keyword">int</span> id )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( l &gt;= L &amp;&amp; r &lt;= R ) <span class="keyword">return</span> addedge( id , u , <span class="number">1</span> ) , <span class="keyword">void</span>();</span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>( mid &gt;= L ) Addedge( l , mid , son[u][<span class="number">0</span>] , L , R , id );</span><br><span class="line">  <span class="keyword">if</span>( mid &lt; R ) Addedge( mid + <span class="number">1</span> , r , son[u][<span class="number">1</span>] , L , R , id );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n); </span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,A+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,B+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,C+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,D+i);</span><br><span class="line">  init( M - <span class="number">1</span> , M - <span class="number">2</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    addedge( st , i , <span class="number">1</span> );</span><br><span class="line">    addedge( st , i + n , <span class="number">1</span> );</span><br><span class="line">    addedge( i + <span class="number">2</span> * n , ed , <span class="number">1</span> );</span><br><span class="line">    addedge( i + <span class="number">3</span> * n , ed , <span class="number">1</span> );</span><br><span class="line">  &#125;</span><br><span class="line">  nidx = n * <span class="number">4</span>;</span><br><span class="line">  build( <span class="number">1</span> , n , rt , n * <span class="number">2</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , l = <span class="number">1</span> , r = n , L , R ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">while</span>( l &lt;= n &amp;&amp; A[l] &lt; i ) ++l;</span><br><span class="line">    <span class="keyword">while</span>( r &amp;&amp; A[r] &lt; i ) --r;</span><br><span class="line">    L = l , R = min( C[i] , r );</span><br><span class="line">    <span class="keyword">if</span>( L &lt;= R ) Addedge( <span class="number">1</span> , n , rt , L , R , i );</span><br><span class="line">    L = max( n - D[i] + <span class="number">1</span> , l ) , R = r;</span><br><span class="line">    <span class="keyword">if</span>( L &lt;= R ) Addedge( <span class="number">1</span> , n , rt , L , R , i + n );</span><br><span class="line">  &#125;</span><br><span class="line">  build( <span class="number">1</span> , n , rt , n * <span class="number">3</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = n , l = <span class="number">1</span> , r = n , L , R ; i ; --i ) &#123;</span><br><span class="line">    <span class="keyword">while</span>( l &lt;= n &amp;&amp; n - B[l] &gt;= i ) ++l;</span><br><span class="line">    <span class="keyword">while</span>( r &amp;&amp; n - B[r] &gt;= i ) --r;</span><br><span class="line">    L = l , R = min( C[i] , r );</span><br><span class="line">    <span class="keyword">if</span>( L &lt;= R ) Addedge( <span class="number">1</span> , n , rt , L , R , i );</span><br><span class="line">    L = max( n - D[i] + <span class="number">1</span> , l ) , R = r;</span><br><span class="line">    <span class="keyword">if</span>( L &lt;= R ) Addedge( <span class="number">1</span> , n , rt , L , R , i + n );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,<span class="number">4</span>*n - dinic() );</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="array"><a href="http://noi.ac/contest/346/problem/1772" target="_blank" rel="noopener">array</a></h5>
<p>可以将 <span class="math inline">\(i\)</span> 向下一个最近的 <span class="math inline">\(a_i+1\)</span> 连边. 形成一颗树 , 然后用 <span class="math inline">\(\rm LCT\)</span> 维护 , 每次询问直接在 <span class="math inline">\(\rm splay\)</span> 上二分. 不过这样一次修改最差要更改 <span class="math inline">\(O(n)\)</span> 个点的连边. 可以然 <span class="math inline">\(i\)</span> 向下一个最近的 <span class="math inline">\(a_i+1\)</span> 或 <span class="math inline">\(a_i\)</span> 连边 , 这样每次修改只会更改 <span class="math inline">\(O(1)\)</span> 条边 , 询问依旧在 <span class="math inline">\(\rm splay\)</span> 上二分. 常数略大. 可以随机 <span class="math inline">\(\rm splay\)</span> 一个节点减少树高.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> IN_LEN = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> buf[IN_LEN] , *s , *t;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Getchar</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="keyword">return</span> s == t &amp;&amp; ( t = ( s = buf ) + fread( buf , <span class="number">1</span> , IN_LEN , <span class="built_in">stdin</span> ) ) , s == t ? <span class="number">-1</span> : *s++; &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>( <span class="title">T</span> &amp; <span class="title">x</span> ) &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c , f; c = Getchar() , x = f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span> ) &#123; <span class="keyword">if</span>( c == <span class="string">'-'</span> ) f = <span class="number">1</span>; c = Getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span>( c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span> ) x = x * <span class="number">10</span> + c - <span class="number">48</span> , c = Getchar();</span><br><span class="line">    x = f ? -x : x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , q , son[N][<span class="number">2</span>] , p[N] , dat[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">which</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123; <span class="keyword">return</span> p[x] ? x == son[p[x]][<span class="number">1</span>] : <span class="number">0</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">noroot</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123; <span class="keyword">return</span> p[x] ? x == son[p[x]][<span class="number">0</span>] || x == son[p[x]][<span class="number">1</span>] : <span class="number">0</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> f , w; w = which( u ) , f = p[u];</span><br><span class="line">  p[u] = p[f]; <span class="keyword">if</span>( noroot( f ) ) son[p[f]][which( f )] = u;</span><br><span class="line">  <span class="keyword">if</span>( ( son[f][w] = son[u][w ^ <span class="number">1</span>] ) ) p[son[u][w ^ <span class="number">1</span>]] = f;</span><br><span class="line">  son[p[f] = u][w ^ <span class="number">1</span>] = f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> f; </span><br><span class="line">  <span class="keyword">while</span>( noroot( u ) ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( noroot( f = p[u] ) ) rotate( which( u ) ^ which( f ) ? u : f );</span><br><span class="line">    rotate( u );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">access</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123; <span class="keyword">for</span>( <span class="keyword">int</span> t = <span class="number">0</span> ; x ; t = x , x = p[x] ) splay( x ) , son[x][<span class="number">1</span>] = t; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> r )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> mx = u;</span><br><span class="line">  <span class="keyword">while</span>( u ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( u &lt;= r ) &#123;</span><br><span class="line">      mx = max( mx , u );</span><br><span class="line">      u = son[u][<span class="number">0</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> u = son[u][<span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> mx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>&lt;<span class="keyword">int</span>&gt; S[N];</span><br><span class="line"><span class="built_in">set</span>&lt;<span class="keyword">int</span>&gt;::iterator it;</span><br><span class="line"><span class="keyword">int</span> las[N] , fa[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">findnxt</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> min( *S[dat[u]].lower_bound( u + <span class="number">1</span> ) , *S[dat[u] + <span class="number">1</span>].lower_bound( u ) );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">disconnect</span><span class="params">( <span class="keyword">int</span> id )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> pre , flg;</span><br><span class="line">  it = S[dat[id]].lower_bound( id );</span><br><span class="line">  <span class="keyword">if</span>( it != S[dat[id]].begin() ) &#123;</span><br><span class="line">    --it;</span><br><span class="line">    pre = *it;</span><br><span class="line">    flg = fa[pre] == id;</span><br><span class="line">    <span class="keyword">if</span>( flg ) &#123;</span><br><span class="line">      access( pre ); splay( pre );</span><br><span class="line">      p[son[pre][<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">      son[pre][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      fa[pre] = p[pre] = findnxt( pre );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  it = S[dat[id] - <span class="number">1</span>].lower_bound( id );</span><br><span class="line">  <span class="keyword">if</span>( it != S[dat[id] - <span class="number">1</span>].begin() ) &#123;</span><br><span class="line">    --it;</span><br><span class="line">    pre = *it;</span><br><span class="line">    flg = fa[pre] == id;</span><br><span class="line">    <span class="keyword">if</span>( flg ) &#123;</span><br><span class="line">      access( pre ); splay( pre );</span><br><span class="line">      p[son[pre][<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">      son[pre][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      fa[pre] = p[pre] = findnxt( pre );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  access( id ); splay( id );</span><br><span class="line">  p[son[id][<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">  son[id][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  fa[id] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">connect</span><span class="params">( <span class="keyword">int</span> id )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> pre;</span><br><span class="line">  assert( !fa[id] &amp;&amp; !p[id] &amp;&amp; !son[id][<span class="number">0</span>] &amp;&amp; !son[id][<span class="number">1</span>] );</span><br><span class="line">  fa[id] = p[id] = findnxt( id );</span><br><span class="line">  it = S[dat[id]].lower_bound( id );</span><br><span class="line">  <span class="keyword">if</span>( it != S[dat[id]].begin() ) &#123;</span><br><span class="line">    --it;</span><br><span class="line">    pre = *it;</span><br><span class="line">    <span class="keyword">if</span>( findnxt( pre ) == id ) &#123;</span><br><span class="line">      access( pre ); splay( pre );</span><br><span class="line">      p[son[pre][<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">      son[pre][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      fa[pre] = p[pre] = id;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  it = S[dat[id] - <span class="number">1</span>].lower_bound( id );</span><br><span class="line">  <span class="keyword">if</span>( it != S[dat[id] - <span class="number">1</span>].begin() ) &#123;</span><br><span class="line">    --it;</span><br><span class="line">    pre = *it;</span><br><span class="line">    <span class="keyword">if</span>( findnxt( pre ) == id ) &#123;</span><br><span class="line">      access( pre ); splay( pre );</span><br><span class="line">      p[son[pre][<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">      son[pre][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      fa[pre] = p[pre] = id;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( son[u][<span class="number">0</span>] ) dfs( son[u][<span class="number">0</span>] );</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d "</span>,u);</span><br><span class="line">  <span class="keyword">if</span>( son[u][<span class="number">1</span>] ) dfs( son[u][<span class="number">1</span>] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  srand( time( <span class="number">0</span> ) );</span><br><span class="line">  read( n ) , read( q );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) las[i] = n + <span class="number">1</span> , S[i].insert( n + <span class="number">1</span> ) , read( dat[i] );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = n ; i ; --i ) &#123;</span><br><span class="line">    S[dat[i]].insert( i );</span><br><span class="line">    fa[i] = p[i] = min( las[dat[i]] , las[dat[i] + <span class="number">1</span>] );</span><br><span class="line">    las[dat[i]] = i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> opt , l , r , x , k;</span><br><span class="line">  <span class="keyword">while</span>( q-- ) &#123;</span><br><span class="line">    read( opt );</span><br><span class="line">    <span class="keyword">if</span>( q % <span class="number">10</span> == <span class="number">0</span> ) splay( rand() % n + <span class="number">1</span> );</span><br><span class="line">    <span class="keyword">if</span>( opt == <span class="number">1</span> ) &#123;</span><br><span class="line">      read( x );</span><br><span class="line">      S[dat[x]].erase( x );</span><br><span class="line">      disconnect( x );</span><br><span class="line">      read( dat[x] );</span><br><span class="line">      S[dat[x]].insert( x );</span><br><span class="line">      connect( x );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      read( l ) , read( r ) , read( x );</span><br><span class="line">      k = *S[x].lower_bound( l );</span><br><span class="line">      <span class="keyword">if</span>( k &gt; r ) &#123; <span class="built_in">puts</span>(<span class="string">"-1"</span>); <span class="keyword">continue</span>; &#125;</span><br><span class="line">      access( k ); splay( k );</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,dat[find( k , r )] - x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="铍配"><a href="http://noi.ac/problem/1998" target="_blank" rel="noopener">铍配</a></h5>
<p>令 <span class="math inline">\(2^k \geq n\)</span> , 每次只用保留最后 <span class="math inline">\(k\)</span> 位. 由于 <span class="math inline">\(n &gt; 2^{k-1}\)</span> 所以 <span class="math inline">\([0,n)\)</span> 和 <span class="math inline">\([m,n+m)\)</span> 在模 <span class="math inline">\(2^k\)</span> 意义下一定有交 , 有交就直接匹配. 剩下的两段一定有一段靠在区间 <span class="math inline">\([0,2^k)\)</span> 的边上 , 并且两段的长度都不超过 <span class="math inline">\(2^{k-1}\)</span> , 于是可以化成规模减半的问题 , 这样处理下去就好. 不会有无解的情况.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; pii;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m , lim , l , tot , mark[N] , ntot , bk[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Data</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> val , id , type;</span><br><span class="line">  Data( <span class="keyword">int</span> val , <span class="keyword">int</span> id , <span class="keyword">int</span> type ):val( val ) , id( id ) , type( type ) &#123;&#125; Data() &#123;&#125;</span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; ( <span class="keyword">const</span> Data &amp; rhs ) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> val &lt; rhs.val;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; dat[<span class="number">2</span>][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">match</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( !dat[<span class="number">0</span>][a].type ) mark[dat[<span class="number">0</span>][a].id] = dat[<span class="number">1</span>][b].id;</span><br><span class="line">  <span class="keyword">else</span> mark[dat[<span class="number">1</span>][b].id] = dat[<span class="number">0</span>][a].id;</span><br><span class="line">  bk[dat[<span class="number">0</span>][a].id] = bk[dat[<span class="number">1</span>][b].id] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</span><br><span class="line">  lim = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span>( lim &lt; n ) lim &lt;&lt;= <span class="number">1</span> , ++l;</span><br><span class="line">  tot = n; --lim;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; tot ; ++i ) &#123;</span><br><span class="line">    dat[<span class="number">0</span>][i] = Data( i , i , <span class="number">0</span> );</span><br><span class="line">    dat[<span class="number">1</span>][i] = Data( ( i + m ) &amp; lim , i + m , <span class="number">1</span> );</span><br><span class="line">  &#125;</span><br><span class="line">  sort( dat[<span class="number">1</span>] , dat[<span class="number">1</span>] + n ) , ++l;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> k = l , cur ; ~k ; --k ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( !tot ) <span class="keyword">break</span>;</span><br><span class="line">    ntot = <span class="number">0</span> , cur = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; tot ; ++i ) &#123;</span><br><span class="line">      <span class="keyword">while</span>( cur &lt; tot - <span class="number">1</span> &amp;&amp; dat[<span class="number">1</span>][cur].val &lt; dat[<span class="number">0</span>][i].val ) ++cur;</span><br><span class="line">      <span class="keyword">if</span>( dat[<span class="number">1</span>][cur].val == dat[<span class="number">0</span>][i].val )</span><br><span class="line">        match( i , cur );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; tot ; ++i )</span><br><span class="line">      <span class="keyword">if</span>( !bk[dat[<span class="number">0</span>][i].id] )</span><br><span class="line">        dat[<span class="number">0</span>][ntot++] = dat[<span class="number">0</span>][i];</span><br><span class="line">    ntot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; tot ; ++i )</span><br><span class="line">      <span class="keyword">if</span>( !bk[dat[<span class="number">1</span>][i].id] )</span><br><span class="line">        dat[<span class="number">1</span>][ntot++] = dat[<span class="number">1</span>][i];</span><br><span class="line">    <span class="keyword">if</span>( !ntot ) <span class="keyword">break</span>;</span><br><span class="line">    tot = ntot;</span><br><span class="line">    <span class="keyword">if</span>( dat[<span class="number">0</span>][tot].val ) &#123;</span><br><span class="line">      swap( dat[<span class="number">0</span>] , dat[<span class="number">1</span>] );</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; tot ; ++i )</span><br><span class="line">        dat[<span class="number">0</span>][i].val ^= lim , dat[<span class="number">1</span>][i].val ^= lim;</span><br><span class="line">    &#125;</span><br><span class="line">    lim &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; tot ; ++i )</span><br><span class="line">      dat[<span class="number">0</span>][i].val &amp;= lim , dat[<span class="number">1</span>][i].val &amp;= lim;</span><br><span class="line">    sort( dat[<span class="number">0</span>] , dat[<span class="number">0</span>] + tot );</span><br><span class="line">    sort( dat[<span class="number">1</span>] , dat[<span class="number">1</span>] + tot );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++i )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>,i,mark[i]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="union"><a href="http://noi.ac/contest/347/problem/923" target="_blank" rel="noopener">union</a></h5>
<p>对树重链剖分后每条路经拆成 <span class="math inline">\(\rm dfs\)</span> 序连续的 <span class="math inline">\(\log n\)</span> 个区间. 于是得到了 <span class="math inline">\(\log^2 n\)</span> 个矩形加操作. 直接二维前缀和维护.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> IN_LEN = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> buf[IN_LEN] , *s , *t;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Getchar</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="keyword">return</span> s == t &amp;&amp; ( t = ( s = buf ) + fread( buf , <span class="number">1</span> , IN_LEN , <span class="built_in">stdin</span> ) ) , s == t ? <span class="number">-1</span> : *s++; &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>( <span class="title">T</span> &amp; <span class="title">x</span> ) &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c , f; c = Getchar() , x = f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span> ) &#123; <span class="keyword">if</span>( c == <span class="string">'-'</span> ) f = <span class="number">1</span>; c = Getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span>( c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span> ) x = x * <span class="number">10</span> + c - <span class="number">48</span> , c = Getchar();</span><br><span class="line">    x = f ? -x : x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">typedef</span> short duliu;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;duliu,duliu&gt; pii;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">lol sum[<span class="number">2</span>][N];</span><br><span class="line"><span class="built_in">vector</span>&lt;pii&gt; ent[N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Tree</span> &#123;</span></span><br><span class="line">  short head[N] , eidx , dfn[N] , dfc , top[N] , fa[N] , dep[N] , rmp[N] , siz[N] , hs[N] , n;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt , to; &#125; edge[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123; </span><br><span class="line">    edge[++eidx] = (Edge) &#123; head[u] , v &#125;; head[u] = eidx;</span><br><span class="line">    edge[++eidx] = (Edge) &#123; head[v] , u &#125;; head[v] = eidx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">    siz[u] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] , v ; i ; i = edge[i].nxt )</span><br><span class="line">      <span class="keyword">if</span>( ( v = edge[i].to ) != fa[u] ) &#123;</span><br><span class="line">        fa[v] = u , dep[v] = dep[u] + <span class="number">1</span>;</span><br><span class="line">        dfs( v ); siz[u] += siz[v];</span><br><span class="line">        <span class="keyword">if</span>( siz[v] &gt; siz[hs[u]] )</span><br><span class="line">          hs[u] = v;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> ftop )</span> </span>&#123;</span><br><span class="line">    top[u] = ftop; rmp[dfn[u] = ++dfc] = u;</span><br><span class="line">    <span class="keyword">if</span>( hs[u] ) dfs( hs[u] , ftop );</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] , v ; i ; i = edge[i].nxt )</span><br><span class="line">      <span class="keyword">if</span>( ( v = edge[i].to ) != fa[u] &amp;&amp; v != hs[u] )</span><br><span class="line">        dfs( v , v );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">get</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v , pii * dat , <span class="keyword">int</span> &amp; tot )</span> </span>&#123;</span><br><span class="line">    tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( top[u] != top[v] ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( dep[top[u]] &lt; dep[top[v]] ) swap( u , v );</span><br><span class="line">      dat[++tot] = pii( dfn[top[u]] , dfn[u] );</span><br><span class="line">      u = fa[top[u]];</span><br><span class="line">    &#125; <span class="keyword">if</span>( dep[u] &lt; dep[v] ) swap( u , v );</span><br><span class="line">    dat[++tot] = pii( dfn[v] , dfn[u] );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    read( n );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , v ; i &lt; n ; ++i ) &#123;</span><br><span class="line">      read( u ) , read( v );</span><br><span class="line">      addedge( u , v );</span><br><span class="line">    &#125;</span><br><span class="line">    dfs( <span class="number">1</span> );</span><br><span class="line">    dfs( <span class="number">1</span> , <span class="number">1</span> );</span><br><span class="line">  &#125;</span><br><span class="line">&#125; A , B;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> q , a , b , c , d , w , ta , tb;</span><br><span class="line">pii sa[N] , sb[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  A.init(); B.init();</span><br><span class="line">  read( q );</span><br><span class="line">  <span class="keyword">while</span>( q-- ) &#123;</span><br><span class="line">    read( a ) , read( b ) , read( c ) , read( d ) , read( w );</span><br><span class="line">    A.get( a , b , sa , ta );</span><br><span class="line">    B.get( c , d , sb , tb );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= ta ; ++i )</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= tb ; ++j ) &#123;</span><br><span class="line">        ent[sa[i].fi].push_back( pii( sb[j].fi , w ) );</span><br><span class="line">        ent[sa[i].fi].push_back( pii( sb[j].se + <span class="number">1</span> , -w ) );</span><br><span class="line">        ent[sa[i].se + <span class="number">1</span>].push_back( pii( sb[j].fi , -w ) );</span><br><span class="line">        ent[sa[i].se + <span class="number">1</span>].push_back( pii( sb[j].se + <span class="number">1</span> , w ) );</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  lol ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , cur = <span class="number">0</span> ; i &lt;= A.n ; ++i ) &#123;</span><br><span class="line">    u = A.rmp[i] , cur ^= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">memset</span>( sum[cur] + <span class="number">1</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( lol ) * B.n );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">const</span> pii &amp; v : ent[i] )</span><br><span class="line">      sum[cur][v.fi] += v.se;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= B.n ; ++j ) &#123;</span><br><span class="line">      sum[cur][j] += sum[cur ^ <span class="number">1</span>][j] + sum[cur][j - <span class="number">1</span>] - sum[cur ^ <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">      ans ^= sum[cur][j] * u * B.rmp[j];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="zyb的画图计划"><a href="http://noi.ac/contest/347/problem/1762" target="_blank" rel="noopener">ZYB的画图计划</a></h5>
<p>考虑如果有一个颜色出现在两个不相连的位置. 中间的颜色块只能在这之后覆盖. 就成了一个子问题. 对于不存在包含关系的颜色块. 设 <span class="math inline">\(f_{i,j}\)</span> 表示覆盖了 <span class="math inline">\([i,j]\)</span> 颜色的最大收益 , 枚举涂哪一种颜色 <span class="math inline">\(k\)</span> , 有转移 <span class="math inline">\(f_{i,j} = \max(f_{i,k-1}+f_{k+1,j}+\text{len}_{i,j})\)</span> . 可以四边形不等式优化.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; pii;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">5e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m , dat[N] , S[N] , tp , st[N] , ed[N] , tot , g[M][M];</span><br><span class="line">pii seg[N];</span><br><span class="line">lol ans , f[M][M];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( !tot ) <span class="keyword">return</span>;</span><br><span class="line">  sort( seg + <span class="number">1</span> , seg + <span class="number">1</span> + tot );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= tot ; ++i ) f[i][i] = seg[i].se - seg[i].fi + <span class="number">1</span> , g[i][i] = i;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> len = <span class="number">2</span> ; len &lt;= tot ; ++len ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> l = <span class="number">1</span> , r = len ; r &lt;= tot ; ++l , ++r ) &#123;</span><br><span class="line">      f[l][r] = g[l][r] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> k = g[l][r - <span class="number">1</span>] ; k &lt;= g[l + <span class="number">1</span>][r] ; ++k ) &#123;</span><br><span class="line">        <span class="keyword">if</span>( f[l][k - <span class="number">1</span>] + f[k + <span class="number">1</span>][r] &gt;= f[l][r] )</span><br><span class="line">          f[l][r] = f[l][k - <span class="number">1</span>] + f[k + <span class="number">1</span>][r] , g[l][r] = k;</span><br><span class="line">      &#125;</span><br><span class="line">      f[l][r] = max( f[l][r] , max( f[l][r - <span class="number">1</span>] , f[l + <span class="number">1</span>][r] ) );</span><br><span class="line">      f[l][r] += seg[r].se - seg[l].fi + <span class="number">1</span>;</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">  ans += f[<span class="number">1</span>][tot];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,dat+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( !st[dat[i]] ) st[dat[i]] = i , S[++tp] = dat[i];</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      tot = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span>( tp &amp;&amp; S[tp] != dat[i] ) &#123;</span><br><span class="line">        seg[++tot] = pii( st[S[tp]] , ed[S[tp]] ); </span><br><span class="line">        --tp;</span><br><span class="line">      &#125;</span><br><span class="line">      solve();</span><br><span class="line">    &#125;</span><br><span class="line">    ed[dat[i]] = i;</span><br><span class="line">  &#125; </span><br><span class="line">  tot = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>( tp ) seg[++tot] = pii( st[S[tp]] , ed[S[tp]] ) , --tp;</span><br><span class="line">  solve();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%lld"</span>,ans);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="t2"><a href="http://noi.ac/contest/347/problem/1765" target="_blank" rel="noopener">T2</a></h5>
<p>总对数减去不相交的对数.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m , f[N];</span><br><span class="line"><span class="keyword">char</span> str[N] , s[N];</span><br><span class="line">lol tot , ed[N] , fi[N] , sum[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%s"</span>,str+<span class="number">1</span>);</span><br><span class="line">  n = <span class="built_in">strlen</span>( str + <span class="number">1</span> );</span><br><span class="line">  m = n * <span class="number">2</span>;</span><br><span class="line">  s[<span class="number">0</span>] = <span class="string">'\n'</span> , s[m + <span class="number">2</span>] = <span class="string">'\t'</span>;</span><br><span class="line">  s[<span class="number">1</span>] = <span class="string">'#'</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    s[i &lt;&lt; <span class="number">1</span>] = str[i] , s[i &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] = <span class="string">'#'</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , k = <span class="number">0</span> , l = <span class="number">0</span> ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    f[i] = l &gt; i ? min( l - i , f[<span class="number">2</span> * k - i] ) : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( s[i - f[i]] == s[i + f[i]] ) ++f[i];</span><br><span class="line">    <span class="keyword">if</span>( i + f[i] &gt; l ) k = i , l = i + f[i];</span><br><span class="line">    tot += f[i] / <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  tot = ( tot % mod ) * ( ( tot - <span class="number">1</span> ) % mod ) % mod * ( ( mod + <span class="number">1</span> ) / <span class="number">2</span> ) % mod;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> , L , R ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    L = ( i + <span class="number">1</span> ) / <span class="number">2</span>;</span><br><span class="line">    R = ( i + f[i] - <span class="number">1</span> ) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>( L &lt;= R ) </span><br><span class="line">      ++ed[L] , --ed[R + <span class="number">1</span>];</span><br><span class="line">    L = ( i - f[i] + <span class="number">2</span> ) / <span class="number">2</span>;</span><br><span class="line">    R = i / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>( L &lt;= R )</span><br><span class="line">      ++fi[L] , --fi[R + <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    ed[i] += ed[i - <span class="number">1</span>];</span><br><span class="line">    fi[i] += fi[i - <span class="number">1</span>];</span><br><span class="line">    sum[i] = sum[i - <span class="number">1</span>] + ed[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = n ; i ; --i )</span><br><span class="line">    tot = ( tot - fi[i] * sum[i - <span class="number">1</span>] ) % mod;</span><br><span class="line">  tot = ( tot % mod + mod ) % mod;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; tot;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="制胡窜"><a href="http://noi.ac/contest/348/problem/1997" target="_blank" rel="noopener">制胡窜</a></h5>
<p>点分治 , 维护一个广义后缀自动机. 每次枚举回文中心所在的子树 , 在其他子树中进行匹配.</p>
<p>令字符串 <span class="math inline">\(ABC\)</span> 为当前节点的最长回文串. 当前枚举的串为 <span class="math inline">\(D\)</span> . 在其它子树中最长匹配到了 <span class="math inline">\(E\)</span>. 也就是 <span class="math inline">\(|DE| \geq |ABC|\)</span> . 需要枚举合法的 <span class="math inline">\(C\)</span> 进行判断. 考虑这么一件事 , 如果回文中心 <span class="math inline">\(F\)</span> 不合法 . 在回文串的两边扩展字符后 <span class="math inline">\(F\)</span> 依旧是这个字符串的中心 , 依旧不合法. 于是只需要保留最长合法匹配即可. 这样就不用枚举所有的 <span class="math inline">\(C\)</span> 了.</p>
<p>对于自动机上的节点 , 令 <span class="math inline">\(fi\)</span> 表示其 <span class="math inline">\(\rm endpos\)</span> 中的最小值. 其代表一个合法 <span class="math inline">\(C\)</span> 的条件是 <span class="math inline">\(fi = \text{maxlen}\)</span> .</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> U = <span class="number">26</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">1e9</span> + <span class="number">9</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> base = <span class="number">131</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SAM &#123;</span><br><span class="line">  <span class="keyword">int</span> trs[N][U] , nidx , len[N] , fi[N] , lnk[N];</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= nidx ; ++i )</span><br><span class="line">      <span class="built_in">memset</span>( trs[i] , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * U );</span><br><span class="line">    nidx = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ext</span><span class="params">( <span class="keyword">const</span> <span class="keyword">int</span> &amp; c , <span class="keyword">int</span> las , <span class="keyword">int</span> dep )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> np , p , nq , q;</span><br><span class="line">    <span class="keyword">if</span>( trs[las][c] ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( len[trs[las][c]] == len[las] + <span class="number">1</span> ) <span class="keyword">return</span> fi[trs[las][c]] = min( fi[trs[las][c]] , dep ) , trs[las][c];</span><br><span class="line">      len[nq = ++nidx] = len[p = las] + <span class="number">1</span>; q = trs[las][c];</span><br><span class="line">      <span class="built_in">memcpy</span>( trs[nq] , trs[q] , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * U ); lnk[nq] = lnk[q] , fi[nq] = min( dep , fi[q] );</span><br><span class="line">      <span class="keyword">while</span>( p &amp;&amp; trs[p][c] == q ) trs[p][c] = nq , p = lnk[p];</span><br><span class="line">      <span class="keyword">return</span> lnk[q] = nq;</span><br><span class="line">    &#125;</span><br><span class="line">    len[np = ++nidx] = len[p = las] + <span class="number">1</span>; fi[np] = dep;</span><br><span class="line">    <span class="keyword">while</span>( p &amp;&amp; !trs[p][c] ) trs[p][c] = np , p = lnk[p];</span><br><span class="line">    <span class="keyword">if</span>( !p ) <span class="keyword">return</span> lnk[np] = <span class="number">1</span> , np;</span><br><span class="line">    <span class="keyword">if</span>( len[q = trs[p][c]] == len[p] + <span class="number">1</span> ) <span class="keyword">return</span> lnk[np] = q , np;</span><br><span class="line">    len[nq = ++nidx] = len[p] + <span class="number">1</span>; <span class="built_in">memcpy</span>( trs[nq] , trs[q] , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * U ); lnk[nq] = lnk[q] , fi[nq] = min( fi[q] , dep );</span><br><span class="line">    <span class="keyword">while</span>( p &amp;&amp; trs[p][c] == q ) trs[p][c] = nq , p = lnk[p];</span><br><span class="line">    lnk[q] = lnk[np] = nq; <span class="keyword">return</span> np;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">( <span class="keyword">const</span> <span class="keyword">int</span> &amp; c )</span> </span>&#123; <span class="keyword">return</span> trs[<span class="number">1</span>][c] ? trs[<span class="number">1</span>][c] : <span class="number">1</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , ans = <span class="number">1</span> , siz[N] , Pow[N];</span><br><span class="line"><span class="keyword">char</span> s[N];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> vis[N];</span><br><span class="line"><span class="keyword">int</span> Mx , Rt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getrt</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> fa , <span class="keyword">int</span> SIZ )</span> </span>&#123;</span><br><span class="line">  siz[u] = <span class="number">1</span>; <span class="keyword">int</span> mx = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : G[u] ) </span><br><span class="line">    <span class="keyword">if</span>( !vis[v] &amp;&amp; v != fa ) &#123;</span><br><span class="line">      getrt( v , u , SIZ );</span><br><span class="line">      mx = max( mx , siz[v] );</span><br><span class="line">      siz[u] += siz[v];</span><br><span class="line">    &#125;</span><br><span class="line">  mx = max( mx , SIZ - siz[u] );</span><br><span class="line">  <span class="keyword">if</span>( mx &lt; Mx ) Mx = mx , Rt = u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> hs1[N] , hs2[N] , dep[N] , S[N] , tp;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">chk</span><span class="params">( <span class="keyword">int</span> p )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> k = tp - SAM::len[p];</span><br><span class="line">  <span class="keyword">return</span> hs1[S[k]] == hs2[S[k]] &amp;&amp; SAM::len[p] == SAM::fi[p];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> fa , <span class="keyword">int</span> p , <span class="keyword">int</span> L )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  S[++tp] = u; dep[u] = dep[fa] + <span class="number">1</span>;</span><br><span class="line">  hs1[u] = ( <span class="number">1L</span>L * hs1[fa] * base + s[u] ) % mod;</span><br><span class="line">  hs2[u] = ( <span class="number">1L</span>L * Pow[dep[u] - <span class="number">1</span>] * s[u] + hs2[fa] ) % mod;</span><br><span class="line">  <span class="keyword">if</span>( hs1[u] == hs2[u] ) ans = max( ans , dep[u] );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> c = s[u] - <span class="string">'a'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>( p != <span class="number">1</span> &amp;&amp; !SAM::trs[p][c] ) p = SAM::lnk[p] , L = min( L , SAM::len[p] );</span><br><span class="line">  <span class="keyword">if</span>( SAM::trs[p][c] ) p = SAM::trs[p][c] , ++L;</span><br><span class="line">  <span class="keyword">while</span>( SAM::len[p] &gt; L ) p = SAM::lnk[p] , L = min( L , SAM::len[p] );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>( p != <span class="number">1</span> &amp;&amp; !chk( p ) ) </span><br><span class="line">    p = SAM::lnk[p] , L = min( L , SAM::len[p] );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>( p != <span class="number">1</span> ) &#123;</span><br><span class="line">    ans = max( ans , L + dep[u] );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : G[u] )</span><br><span class="line">    <span class="keyword">if</span>( !vis[v] &amp;&amp; v != fa )</span><br><span class="line">      dfs1( v , u , p , L );</span><br><span class="line"></span><br><span class="line">  --tp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> fa , <span class="keyword">int</span> las )</span> </span>&#123;</span><br><span class="line">  las = SAM::ext( s[u] - <span class="string">'a'</span> , las , dep[u] - <span class="number">1</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : G[u] )</span><br><span class="line">    <span class="keyword">if</span>( !vis[v] &amp;&amp; v != fa )</span><br><span class="line">      dfs2( v , u , las );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> SIZ )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( SIZ == <span class="number">1</span> ) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  Mx = N , Rt = <span class="number">0</span>;</span><br><span class="line">  getrt( u , u , SIZ );</span><br><span class="line">  <span class="keyword">int</span> x = Rt; assert( Rt );</span><br><span class="line">  getrt( x , x , SIZ );</span><br><span class="line"></span><br><span class="line">  SAM::clear();</span><br><span class="line"></span><br><span class="line">  vis[x] = <span class="number">1</span> , dep[x] = <span class="number">1</span>;</span><br><span class="line">  hs1[x] = hs2[x] = s[x];</span><br><span class="line">  S[tp = <span class="number">1</span>] = x;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> p , L;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : G[x] ) </span><br><span class="line">    <span class="keyword">if</span>( !vis[v] ) &#123;</span><br><span class="line">      p = SAM::get( s[x] - <span class="string">'a'</span> );</span><br><span class="line">      <span class="keyword">if</span>( p != <span class="number">1</span> ) L = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">else</span> L = <span class="number">0</span>;</span><br><span class="line">      dfs1( v , x , p , L );</span><br><span class="line">      dfs2( v , x , <span class="number">1</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  SAM::clear();</span><br><span class="line">  reverse( G[x].begin() , G[x].end() );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : G[x] ) </span><br><span class="line">    <span class="keyword">if</span>( !vis[v] ) &#123;</span><br><span class="line">      p = SAM::get( s[x] - <span class="string">'a'</span> );</span><br><span class="line">      <span class="keyword">if</span>( p != <span class="number">1</span> ) L = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">else</span> L = <span class="number">0</span>;</span><br><span class="line">      dfs1( v , x , p , L );</span><br><span class="line">      dfs2( v , x , <span class="number">1</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : G[x] )</span><br><span class="line">    <span class="keyword">if</span>( !vis[v] )</span><br><span class="line">      solve( v , siz[v] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%s"</span>,&amp;n,s+<span class="number">1</span>);  </span><br><span class="line">  Pow[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) Pow[i] = (lol)Pow[i - <span class="number">1</span>] * base % mod;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , v ; i &lt; n ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;v);</span><br><span class="line">    G[u].push_back( v );</span><br><span class="line">    G[v].push_back( u );</span><br><span class="line">  &#125;</span><br><span class="line">  solve( <span class="number">1</span> , n );</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d"</span>,ans);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="摔跤"><a href="http://noi.ac/contest/348/problem/1999" target="_blank" rel="noopener">摔跤</a></h5>
<p>参见雅礼集训选做.</p>
<h5 id="病毒"><a href="http://noi.ac/contest/348/problem/2000" target="_blank" rel="noopener">病毒</a></h5>
<p>答案不会超过 <span class="math inline">\(\sqrt n + 1\)</span> .</p>
<p>令为 <span class="math inline">\(k^2 = n\)</span>. 将所有不包含深度为 <span class="math inline">\(k\)</span> 的节点的子树删去. 接下来可以选 <span class="math inline">\(k\)</span> 个深度不同节点并删去其子树. 考虑这样一个策略 , 每次选择到第一个度数大于二的节点的路径上节点数最小的子树. 如果在选择深度为 <span class="math inline">\(1,2,3,\cdots,d\)</span> 的节点后第一次选了有至少两个孩子节点的节点. 这 <span class="math inline">\(d\)</span> 个点所在的每个除 <span class="math inline">\(1\)</span> 节点的树 , 至少有 <span class="math inline">\(2k-d\)</span> 个节点 , 删去后的森林中至多 <span class="math inline">\(k^2-d(2k-d)=(k-d)^2\)</span> 个节点. 接着变成 <span class="math inline">\((k-d)^2\)</span> 的子问题. 其于是答案不会超过 <span class="math inline">\(k\)</span> .</p>
<p>这样只用状压前 <span class="math inline">\(20\)</span> 深度那些深度选了即可.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">4e2</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> S = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> f[N][S];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[N] , fl[N];</span><br><span class="line"><span class="keyword">int</span> n , dep[N] , fa[N] , lca[N][N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> fa )</span> </span>&#123;</span><br><span class="line">  fl[dep[u]].push_back( u );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : G[u] )</span><br><span class="line">    <span class="keyword">if</span>( v != fa ) &#123;</span><br><span class="line">      ::fa[v] = u;</span><br><span class="line">      dep[v] = dep[u] + <span class="number">1</span>;</span><br><span class="line">      dfs( v , u );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getlca</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span>( u != v ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( dep[u] &lt; dep[v] ) swap( u , v );</span><br><span class="line">    u = fa[u];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">chk</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123;</span><br><span class="line">  <span class="built_in">memset</span>( f , <span class="number">0</span> , <span class="keyword">sizeof</span> f );</span><br><span class="line">  <span class="keyword">int</span> m = fl[x].size() - <span class="number">1</span> , U = <span class="number">1</span> &lt;&lt; x;</span><br><span class="line">  f[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , d ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> s = <span class="number">0</span> ; s &lt; U ; ++s ) &#123;</span><br><span class="line">      d = fl[x][i];</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> j = i - <span class="number">1</span> ; ~j ; --j ) &#123;</span><br><span class="line">        <span class="keyword">if</span>( f[j][s] ) &#123;</span><br><span class="line">           <span class="keyword">for</span>( <span class="keyword">int</span> t = dep[d] - <span class="number">1</span> ; ~t ; --t )</span><br><span class="line">             <span class="keyword">if</span>( (~s &gt;&gt; t) &amp; <span class="number">1</span> )</span><br><span class="line">               f[i][s | ( <span class="number">1</span> &lt;&lt; t )] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        d = lca[d][fl[x][j]];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> s = <span class="number">0</span> ; s &lt; U ; ++s )</span><br><span class="line">    <span class="keyword">if</span>( f[m][s] ) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , v ; i &lt; n ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;v);</span><br><span class="line">    G[u].push_back( v );</span><br><span class="line">    G[v].push_back( u );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) fl[i].push_back( <span class="number">0</span> );</span><br><span class="line">  dfs( <span class="number">1</span> , <span class="number">1</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++j )</span><br><span class="line">      lca[i][j] = getlca( i , j );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i * i &lt;= n ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( chk( i ) )</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">"%d"</span>,i),<span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,<span class="keyword">int</span>(<span class="built_in">sqrt</span>(n))+<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/06/08/Solutions/APIO-%E9%80%89%E5%81%9A/" rel="prev" title="[APIO] 选做">
      <i class="fa fa-chevron-left"></i> [APIO] 选做
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/06/12/Solutions/%E6%9D%82%E9%A2%98%202/" rel="next" title="杂题 2">
      杂题 2 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-5"><a class="nav-link" href="#sam"><span class="nav-number">1.</span> <span class="nav-text">SAM</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#t1"><span class="nav-number">2.</span> <span class="nav-text">T1</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#海盗"><span class="nav-number">3.</span> <span class="nav-text">海盗</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#sam2"><span class="nav-number">4.</span> <span class="nav-text">SAM2</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#zyb的赈灾计划"><span class="nav-number">5.</span> <span class="nav-text">ZYB的赈灾计划</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#重复"><span class="nav-number">6.</span> <span class="nav-text">重复</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ball"><span class="nav-number">7.</span> <span class="nav-text">ball</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#c"><span class="nav-number">8.</span> <span class="nav-text">C</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#寄蒜几盒"><span class="nav-number">9.</span> <span class="nav-text">寄蒜几盒</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#b"><span class="nav-number">10.</span> <span class="nav-text">B</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#array"><span class="nav-number">11.</span> <span class="nav-text">array</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#铍配"><span class="nav-number">12.</span> <span class="nav-text">铍配</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#union"><span class="nav-number">13.</span> <span class="nav-text">union</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#zyb的画图计划"><span class="nav-number">14.</span> <span class="nav-text">ZYB的画图计划</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#t2"><span class="nav-number">15.</span> <span class="nav-text">T2</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#制胡窜"><span class="nav-number">16.</span> <span class="nav-text">制胡窜</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#摔跤"><span class="nav-number">17.</span> <span class="nav-text">摔跤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#病毒"><span class="nav-number">18.</span> <span class="nav-text">病毒</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Guyan</p>
  <div class="site-description" itemprop="description">水平低啊</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">135</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Guyan</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
