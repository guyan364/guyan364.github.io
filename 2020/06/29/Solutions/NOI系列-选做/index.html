<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="现在不做 \(\rm NOI\) 的题 , 以后就没有机会做了.">
<meta property="og:type" content="article">
<meta property="og:title" content="[NOI系列] 选做">
<meta property="og:url" content="http://yoursite.com/2020/06/29/Solutions/NOI%E7%B3%BB%E5%88%97-%E9%80%89%E5%81%9A/index.html">
<meta property="og:site_name" content="Guyan&#39;s blog">
<meta property="og:description" content="现在不做 \(\rm NOI\) 的题 , 以后就没有机会做了.">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-06-29T11:11:53.000Z">
<meta property="article:modified_time" content="2020-07-08T09:07:09.369Z">
<meta property="article:author" content="Guyan">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/06/29/Solutions/NOI%E7%B3%BB%E5%88%97-%E9%80%89%E5%81%9A/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>[NOI系列] 选做 | Guyan's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Guyan's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/29/Solutions/NOI%E7%B3%BB%E5%88%97-%E9%80%89%E5%81%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guyan">
      <meta itemprop="description" content="水平低啊">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guyan's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [NOI系列] 选做
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-29 19:11:53" itemprop="dateCreated datePublished" datetime="2020-06-29T19:11:53+08:00">2020-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-08 17:07:09" itemprop="dateModified" datetime="2020-07-08T17:07:09+08:00">2020-07-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">题解</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>现在不做 <span class="math inline">\(\rm NOI\)</span> 的题 , 以后就没有机会做了.</p>
<a id="more"></a>
<h4 id="section">2015</h4>
<h5 id="noi2015-程序自动分析"><a href="https://loj.ac/problem/2129" target="_blank" rel="noopener">[NOI2015] 程序自动分析</a></h5>
<p>并查集维护相等关系. 最后判断一下就好了.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> discre[N] , discre_tot , _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> f[N] , n;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Opt</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> opt , u , v;</span><br><span class="line">&#125; dat[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123; <span class="keyword">return</span> f[x] &lt; <span class="number">0</span> ? x : f[x] = find( f[x] ); &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123;</span><br><span class="line">  u = find( u ) , v = find( v );</span><br><span class="line">  <span class="keyword">if</span>( u == v ) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span>( f[u] &lt; f[v] ) swap( u , v );</span><br><span class="line">  --f[v]; f[u] = v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n) , discre_tot = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;dat[i].u,&amp;dat[i].v,&amp;dat[i].opt);</span><br><span class="line">    discre[++discre_tot] = dat[i].u;</span><br><span class="line">    discre[++discre_tot] = dat[i].v;</span><br><span class="line">  &#125;</span><br><span class="line">  sort( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot );</span><br><span class="line">  discre_tot = unique( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot ) - discre - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= discre_tot ; ++i ) f[i] = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) </span><br><span class="line">    <span class="keyword">if</span>( dat[i].opt == <span class="number">1</span> ) </span><br><span class="line">      merge( lower_bound( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot , dat[i].u ) - discre , </span><br><span class="line">             lower_bound( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot , dat[i].v ) - discre );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( dat[i].opt == <span class="number">0</span> ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( find( lower_bound( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot , dat[i].u ) - discre ) == </span><br><span class="line">          find( lower_bound( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot , dat[i].v ) - discre ) )</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"NO"</span>),<span class="keyword">void</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"YES"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> T;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</span><br><span class="line">  <span class="keyword">while</span>( T-- ) solve();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2015-软件包管理器"><a href="https://loj.ac/problem/2130" target="_blank" rel="noopener">[NOI2015] 软件包管理器</a></h5>
<p>树剖板子题.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> head[N] , eidx , dfn[N] , hs[N] , siz[N] , fa[N] , top[N] , dfc , dep[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt , to; &#125; edge[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123; edge[++eidx] = (Edge) &#123; head[u] , v &#125;; head[u] = eidx; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  siz[u] = <span class="number">1</span> , hs[u] = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] , v ; i ; i = edge[i].nxt ) &#123;</span><br><span class="line">    dep[v = edge[i].to] = dep[u] + <span class="number">1</span>;</span><br><span class="line">    dfs( v );</span><br><span class="line">    siz[u] += siz[v];</span><br><span class="line">    <span class="keyword">if</span>( !~hs[u] || siz[hs[u]] &lt; siz[v] )</span><br><span class="line">      hs[u] = v;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> ftop )</span> </span>&#123;</span><br><span class="line">  dfn[u] = ++dfc , top[u] = ftop;</span><br><span class="line">  <span class="keyword">if</span>( ~hs[u] ) dfs( hs[u] , ftop );</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] , v ; i ; i = edge[i].nxt )</span><br><span class="line">    <span class="keyword">if</span>( ( v = edge[i].to ) != hs[u] )</span><br><span class="line">      dfs( v , v );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> val[N &lt;&lt; <span class="number">2</span>] , settag[N &lt;&lt; <span class="number">2</span>] , setval[N &lt;&lt; <span class="number">2</span>] , _siz[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">up</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123; val[u] = val[u &lt;&lt; <span class="number">1</span>] + val[u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>]; &#125;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span> _set( <span class="keyword">int</span> u , <span class="keyword">int</span> k ) &#123;</span><br><span class="line">  setval[u] = k;</span><br><span class="line">  val[u] = _siz[u] * k;</span><br><span class="line">  settag[u] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dn</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( settag[u] ) &#123;</span><br><span class="line">    _set( u &lt;&lt; <span class="number">1</span> , setval[u] );</span><br><span class="line">    _set( u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> , setval[u] );</span><br><span class="line">    settag[u] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  _siz[u] = r - l + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>( l == r ) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  build( l , mid , u &lt;&lt; <span class="number">1</span> );</span><br><span class="line">  build( mid + <span class="number">1</span> , r , u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> );</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qry</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> u , <span class="keyword">int</span> L , <span class="keyword">int</span> R )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( l &gt;= L &amp;&amp; r &lt;= R ) <span class="keyword">return</span> val[u];</span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>; dn( u );</span><br><span class="line">  <span class="keyword">if</span>( mid &gt;= R ) <span class="keyword">return</span> qry( l , mid , u &lt;&lt; <span class="number">1</span> , L , R );</span><br><span class="line">  <span class="keyword">if</span>( mid &lt; L ) <span class="keyword">return</span> qry( mid + <span class="number">1</span> , r , u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> , L , R );</span><br><span class="line">  <span class="keyword">return</span> qry( l , mid , u &lt;&lt; <span class="number">1</span> , L , R ) + qry( mid + <span class="number">1</span> , r , u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> , L , R );</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mdf</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> u , <span class="keyword">int</span> L , <span class="keyword">int</span> R , <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( l &gt;= L &amp;&amp; r &lt;= R ) <span class="keyword">return</span> _set( u , k ) , <span class="keyword">void</span>();</span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>; dn( u );</span><br><span class="line">  <span class="keyword">if</span>( mid &gt;= L ) mdf( l , mid , u &lt;&lt; <span class="number">1</span> , L , R , k );</span><br><span class="line">  <span class="keyword">if</span>( mid &lt; R ) mdf( mid + <span class="number">1</span> , r , u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> , L , R , k );</span><br><span class="line">  up( u );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UNIN</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> l = dfn[u] , r = dfn[u] + siz[u] - <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,qry(<span class="number">1</span>,n,<span class="number">1</span>,l,r));</span><br><span class="line">  mdf( <span class="number">1</span> , n , <span class="number">1</span> , l , r , <span class="number">0</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">INST</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> res = dep[u] , p = u;</span><br><span class="line">  <span class="keyword">while</span>( ~p ) &#123;</span><br><span class="line">    res -= qry( <span class="number">1</span> , n , <span class="number">1</span> , dfn[top[p]] , dfn[p] );</span><br><span class="line">    mdf( <span class="number">1</span> , n , <span class="number">1</span> , dfn[top[p]] , dfn[p] , <span class="number">1</span> );</span><br><span class="line">    p = fa[top[p]];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n); fa[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , p ; i &lt; n ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;p);</span><br><span class="line">    fa[i] = p;</span><br><span class="line">    addedge( p , i );</span><br><span class="line">  &#125; dep[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  dfs( <span class="number">0</span> );</span><br><span class="line">  dfs( <span class="number">0</span> , <span class="number">0</span> );</span><br><span class="line">  build( <span class="number">1</span> , n , <span class="number">1</span> );</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m);</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> str[<span class="number">15</span>];</span><br><span class="line">  <span class="keyword">int</span> u;</span><br><span class="line">  <span class="keyword">while</span>( m-- ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%s%d"</span>,str,&amp;u);</span><br><span class="line">    <span class="keyword">if</span>( *str == <span class="string">'u'</span> ) UNIN( u );</span><br><span class="line">    <span class="keyword">else</span> INST( u );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2015-寿司晚宴"><a href="https://loj.ac/problem/2131" target="_blank" rel="noopener">[NOI2015] 寿司晚宴</a></h5>
<p>对于小于 <span class="math inline">\(\sqrt n\)</span> 的质数状压 , 大于 <span class="math inline">\(\sqrt n\)</span> 的质数只会出现一次. 于是分层转移.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">510</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P[<span class="number">8</span>] = &#123; <span class="number">2</span> , <span class="number">3</span> , <span class="number">5</span> , <span class="number">7</span> , <span class="number">11</span> , <span class="number">13</span> , <span class="number">17</span> , <span class="number">19</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1</span> &lt;&lt; <span class="number">8</span>;</span><br><span class="line"><span class="keyword">int</span> _w , mod;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">pls</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; a += b - mod; <span class="keyword">return</span> a + ( a &gt;&gt; <span class="number">31</span> &amp; mod ); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">mns</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; a -= b; <span class="keyword">return</span> a + ( a &gt;&gt; <span class="number">31</span> &amp; mod ); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">inc</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; a += b - mod; a += a &gt;&gt; <span class="number">31</span> &amp; mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dec</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; a -= b; a += a &gt;&gt; <span class="number">31</span> &amp; mod; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , f[<span class="number">2</span>][M][M] , prime[N] , prime_tot , vis[N] , pw[N] , g[M][M];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;mod);</span><br><span class="line">  pw[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) pw[i] = pls( pw[i - <span class="number">1</span>] , pw[i - <span class="number">1</span>] );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= n ; ++i ) dec( pw[i] , <span class="number">1</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( !vis[i] ) prime[++prime_tot] = i;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= prime_tot ; ++j ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( i * prime[j] &gt; n ) <span class="keyword">break</span>;</span><br><span class="line">      vis[i * prime[j]] = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span>( i % prime[j] == <span class="number">0</span> ) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">memset</span>( vis , <span class="number">0</span> , <span class="keyword">sizeof</span> vis );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">9</span> ; i &lt;= prime_tot ; ++i )</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j * prime[i] &lt;= n ; ++j )</span><br><span class="line">      vec[i].push_back( j * prime[i] ) , vis[j * prime[i]] = <span class="number">1</span>;</span><br><span class="line">  f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> cur = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> , s ; i &lt;= n ; ++i ) </span><br><span class="line">    <span class="keyword">if</span>( !vis[i] ) &#123;</span><br><span class="line">      s = <span class="number">0</span> , cur ^= <span class="number">1</span>;</span><br><span class="line">      <span class="built_in">memcpy</span>( f[cur] , f[cur ^ <span class="number">1</span>] , <span class="keyword">sizeof</span> f[cur] );</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; <span class="number">8</span> ; ++j )</span><br><span class="line">        <span class="keyword">if</span>( i % P[j] == <span class="number">0</span> )</span><br><span class="line">          s ^= ( <span class="number">1</span> &lt;&lt; j );</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> a = <span class="number">0</span> ; a &lt; M ; ++a )</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">int</span> b = <span class="number">0</span> ; b &lt; M ; ++b ) &#123;</span><br><span class="line">          <span class="keyword">if</span>( f[cur ^ <span class="number">1</span>][a][b] ) &#123;</span><br><span class="line">            inc( f[cur][a|s][b] , f[cur^<span class="number">1</span>][a][b] );</span><br><span class="line">            inc( f[cur][a][b|s] , f[cur^<span class="number">1</span>][a][b] );</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">9</span> ; i &lt;= prime_tot ; ++i ) &#123;</span><br><span class="line">    <span class="built_in">memcpy</span>( g , f[cur] , <span class="keyword">sizeof</span> g );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : vec[i] ) &#123;</span><br><span class="line">      <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">      cur ^= <span class="number">1</span>;</span><br><span class="line">      <span class="built_in">memcpy</span>( f[cur] , f[cur ^ <span class="number">1</span>] , <span class="keyword">sizeof</span> f[cur] );</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; <span class="number">8</span> ; ++j )</span><br><span class="line">        <span class="keyword">if</span>( v % P[j] == <span class="number">0</span> )</span><br><span class="line">          s ^= ( <span class="number">1</span> &lt;&lt; j );</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> a = <span class="number">0</span> ; a &lt; M ; ++a )</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">int</span> b = <span class="number">0</span> ; b &lt; M ; ++b )</span><br><span class="line">          inc( f[cur][a][b | s] , f[cur ^ <span class="number">1</span>][a][b] );</span><br><span class="line">    &#125;</span><br><span class="line">    cur ^= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">memcpy</span>( f[cur] , f[cur ^ <span class="number">1</span>] , <span class="keyword">sizeof</span> f[cur] );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> a = <span class="number">0</span> ; a &lt; M ; ++a )</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> b = <span class="number">0</span> ; b &lt; M ; ++b ) &#123;</span><br><span class="line">        inc( f[cur][a][b] ,f[cur ^ <span class="number">1</span>][b][a] );</span><br><span class="line">        dec( f[cur][a][b] , g[b][a] );</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> a = <span class="number">0</span> ; a &lt; M ; ++a )</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> b = <span class="number">0</span> ; b &lt; M ; ++b )</span><br><span class="line">      <span class="keyword">if</span>( !( a &amp; b ) ) </span><br><span class="line">        inc( ans , f[cur][a][b] );</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d"</span>,ans);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2015-荷马史诗"><a href="https://loj.ac/problem/2132" target="_blank" rel="noopener">[NOI2015] 荷马史诗</a></h5>
<p>哈夫曼树.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;lol,<span class="keyword">int</span>&gt; pii;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line">priority_queue&lt;pii,<span class="built_in">vector</span>&lt;pii&gt;,greater&lt;pii&gt; &gt; Q;</span><br><span class="line"></span><br><span class="line">lol ans1 , s , tt;</span><br><span class="line"><span class="keyword">int</span> n , k , ans2 , mx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;k);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span>  ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%lld"</span>,&amp;tt);</span><br><span class="line">    Q.push( pii( tt , <span class="number">0</span> ) );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span>( ( n - <span class="number">1</span> ) % ( k - <span class="number">1</span> ) ) ++n , Q.push( pii( <span class="number">0</span> , <span class="number">0</span> ) );</span><br><span class="line">  <span class="keyword">while</span>( Q.size() &gt; <span class="number">1</span> ) &#123;</span><br><span class="line">    <span class="keyword">int</span> t = k; s = mx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( t-- ) &#123;</span><br><span class="line">      s += Q.top().fi;</span><br><span class="line">      mx = max( mx , Q.top().se );</span><br><span class="line">      Q.pop();</span><br><span class="line">    &#125;</span><br><span class="line">    ans1 += s;</span><br><span class="line">    Q.push( pii( s , mx + <span class="number">1</span> ) );</span><br><span class="line">  &#125;</span><br><span class="line">  ans2 = Q.top().se;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%lld\n%d"</span>,ans1,ans2);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2015-品酒大会"><a href="https://loj.ac/problem/2133" target="_blank" rel="noopener">[NOI2015] 品酒大会</a></h5>
<p>后缀数组 , 单调栈</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> lol INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>LL;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> sa[N] , ht[N] , rnk[N] , tp[N] , c[N] , n;</span><br><span class="line"><span class="keyword">char</span> str[N]; lol ans1[N] , ans2[N] , dat[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b , <span class="keyword">int</span> k )</span> </span>&#123; <span class="keyword">return</span> tp[a] == tp[b] &amp;&amp; tp[a + k] == tp[b + k]; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SuffixSort</span><span class="params">( <span class="keyword">int</span> m = <span class="number">256</span> )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> kc[N];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) ++c[rnk[i] = str[i]];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) c[i] += c[i - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = n ; i ; --i ) sa[c[rnk[i]]--] = i;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> k = <span class="number">1</span> , p = <span class="number">0</span> ; p &lt; n ; k &lt;&lt;= <span class="number">1</span> , m = p ) &#123;</span><br><span class="line">    p = <span class="number">0</span>; <span class="keyword">for</span>( <span class="keyword">int</span> i = n - k + <span class="number">1</span> ; i &lt;= n ; ++i ) tp[++p] = i;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) <span class="keyword">if</span>( sa[i] &gt; k ) tp[++p] = sa[i] - k;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= m ; ++i ) c[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) ++c[rnk[i]] , kc[i] = rnk[tp[i]];</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) c[i] += c[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = n ; i ; --i ) sa[c[kc[i]]--] = tp[i];</span><br><span class="line">    swap( rnk , tp ); rnk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++i ) rnk[sa[i]] = cmp( sa[i] , sa[i - <span class="number">1</span>] , k ) ? p : ++p;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , k = <span class="number">0</span> , p ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( k ) --k;</span><br><span class="line">    p = sa[rnk[i] - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">while</span>( str[i + k] == str[p + k] ) ++k;</span><br><span class="line">    ht[rnk[i]] = k;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">  node() &#123;&#125; </span><br><span class="line">  node( lol siz , lol mx , lol mi , lol ht ):siz( siz ) , mx( mx ) , mi( mi ) , ht( ht ) &#123;&#125;</span><br><span class="line">  lol siz , mx , mi , ht;</span><br><span class="line">&#125; S[N];</span><br><span class="line"><span class="function">lol <span class="title">getmx</span><span class="params">( lol mxa , lol mia , lol mxb , lol mib )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> max( max( mxa * mxb , mxa * mib ) ,</span><br><span class="line">              max( mia * mxb , mia * mib ) );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%s"</span>,&amp;n,str+<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%lld"</span>,dat+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= n ; ++i ) ans2[i] = -INF;</span><br><span class="line">  SuffixSort();</span><br><span class="line">  <span class="keyword">int</span> tp;</span><br><span class="line">  S[tp = <span class="number">1</span>] = node( <span class="number">1</span> , dat[sa[<span class="number">1</span>]] , dat[sa[<span class="number">1</span>]] , ht[<span class="number">2</span>] );</span><br><span class="line">  lol siz , mx , mi;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> ; i &lt; n ; ++i ) &#123;</span><br><span class="line">    siz = <span class="number">1</span> , mx = mi = dat[sa[i]];</span><br><span class="line">    <span class="keyword">while</span>( tp &amp;&amp; S[tp].ht &gt; ht[i + <span class="number">1</span>] ) &#123;</span><br><span class="line">      ans1[S[tp].ht] += S[tp].siz * siz;</span><br><span class="line">      siz += S[tp].siz;</span><br><span class="line">      ans2[S[tp].ht] = max( ans2[S[tp].ht] , getmx( S[tp].mx , S[tp].mi , mx , mi ) );</span><br><span class="line">      mx = max( mx , S[tp].mx ) , mi = min( mi , S[tp].mi );</span><br><span class="line">      --tp;</span><br><span class="line">    &#125;</span><br><span class="line">    S[++tp] = node( siz , mx , mi , ht[i + <span class="number">1</span>] );</span><br><span class="line">  &#125;</span><br><span class="line">  siz = <span class="number">1</span> , mx = dat[sa[n]] , mi = dat[sa[n]];</span><br><span class="line">  <span class="keyword">while</span>( tp ) &#123;</span><br><span class="line">    ans1[S[tp].ht] += S[tp].siz * siz;</span><br><span class="line">    ans2[S[tp].ht] = max( ans2[S[tp].ht] , getmx( S[tp].mx , S[tp].mi , mx , mi ) );</span><br><span class="line">    mx = max( mx , S[tp].mx ) , mi = min( mi , S[tp].mi );</span><br><span class="line">    siz += S[tp].siz;</span><br><span class="line">    --tp; </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = n - <span class="number">1</span> ; ~i ; --i ) &#123;</span><br><span class="line">    ans2[i] = max( ans2[i] , ans2[i + <span class="number">1</span>] );</span><br><span class="line">    ans1[i] += ans1[i + <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++i )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld %lld\n"</span>,ans1[i],ans2[i] == -INF ? <span class="number">0</span> : ans2[i]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2015-小园丁与老司机"><a href="https://loj.ac/problem/2134" target="_blank" rel="noopener">[NOI2015] 小园丁与老司机</a></h5>
<p>DP 之后路径还原 , 跑一个上下界网络流就好了.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> IN_LEN = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> buf[IN_LEN] , *s , *t;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Getchar</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="keyword">return</span> s == t &amp;&amp; ( t = ( s = buf ) + fread( buf , <span class="number">1</span> , IN_LEN , <span class="built_in">stdin</span> ) ) , s == t ? <span class="number">-1</span> : *s++; &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>( <span class="title">T</span> &amp; <span class="title">x</span> ) &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c , f; c = Getchar() , x = f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span> ) &#123; <span class="keyword">if</span>( c == <span class="string">'-'</span> ) f = <span class="number">1</span>; c = Getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span>( c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span> ) x = x * <span class="number">10</span> + c - <span class="number">48</span> , c = Getchar();</span><br><span class="line">    x = f ? -x : x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e4</span> + <span class="number">15</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Network_flows &#123;</span><br><span class="line">  <span class="keyword">int</span> head[N] , eidx , que[N] , he , ta , dep[N] , cur[N];</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt , to , flow , cap; <span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; cap = flow = <span class="number">0</span>; &#125; &#125; edge[N &lt;&lt; <span class="number">8</span>];</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v , <span class="keyword">int</span> cap )</span> </span>&#123;</span><br><span class="line">    edge[++eidx] = (Edge) &#123; head[u] , v , <span class="number">0</span> , cap &#125;; head[u] = eidx;</span><br><span class="line">    edge[++eidx] = (Edge) &#123; head[v] , u , <span class="number">0</span> , <span class="number">0</span> &#125;; head[v] = eidx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">( <span class="keyword">int</span> st , <span class="keyword">int</span> ed )</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>( dep , <span class="number">0</span> , <span class="keyword">sizeof</span> dep );</span><br><span class="line">    dep[que[he = ta = <span class="number">1</span>] = st] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>( he &lt;= ta ) &#123;</span><br><span class="line">      <span class="keyword">int</span> u = que[he++];</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] ; ~i ; i = edge[i].nxt )</span><br><span class="line">        <span class="keyword">if</span>( !dep[edge[i].to] &amp;&amp; edge[i].cap &gt; edge[i].flow )</span><br><span class="line">          dep[que[++ta] = edge[i].to] = dep[u] + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dep[ed] != <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> fl , <span class="keyword">const</span> <span class="keyword">int</span> &amp; ed )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( u == ed || !fl ) <span class="keyword">return</span> fl;</span><br><span class="line">    <span class="keyword">int</span> g = <span class="number">0</span> , d;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> &amp; i = cur[u] ; ~i ; i = edge[i].nxt )</span><br><span class="line">      <span class="keyword">if</span>( dep[edge[i].to] == dep[u] + <span class="number">1</span> &amp;&amp; ( d = dfs( edge[i].to , min( edge[i].cap - edge[i].flow , fl - g ) , ed ) ) ) &#123;</span><br><span class="line">        edge[i].flow += d , edge[i ^ <span class="number">1</span>].flow -= d;</span><br><span class="line">        <span class="keyword">if</span>( ( g += d ) &gt;= fl ) <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">return</span> g;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">dinic</span><span class="params">( <span class="keyword">int</span> st , <span class="keyword">int</span> ed )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( bfs( st , ed ) ) &#123;</span><br><span class="line">      <span class="built_in">memcpy</span>( cur , head , <span class="keyword">sizeof</span> cur );</span><br><span class="line">      res += dfs( st , INF , ed );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="built_in">memset</span>( head , <span class="number">-1</span> , <span class="keyword">sizeof</span> head ) , eidx = <span class="number">-1</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Data</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> x , y , id;</span><br><span class="line">&#125; dat[N];</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; lv[N];</span><br><span class="line"><span class="keyword">int</span> discre[N] , discre_tot , n , nxt[N][<span class="number">3</span>] , pre[N][<span class="number">3</span>] , las[N] , g[N][<span class="number">2</span>] , f[N][<span class="number">2</span>] , trs[N][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">discreid</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123; <span class="keyword">return</span> lower_bound( discre + <span class="number">1</span> ,discre + <span class="number">1</span> + discre_tot , x ) - discre; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> DP &#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">( <span class="keyword">int</span> &amp; u , <span class="keyword">int</span> v , <span class="keyword">int</span> &amp; trs , <span class="keyword">int</span> fr )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( u &lt; v ) u = v , trs = fr;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Row</span><span class="params">( <span class="keyword">int</span> f[][<span class="number">2</span>] , <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp; vec , <span class="keyword">int</span> trs[][<span class="number">2</span>] )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> mx , fr , siz;</span><br><span class="line">    mx = -INF , fr = <span class="number">0</span> , siz = vec.size();</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> , u ; i &lt; siz ; ++i ) &#123;</span><br><span class="line">      u = vec[i];</span><br><span class="line">      upd( f[u][<span class="number">1</span>] , f[u][<span class="number">0</span>] , trs[u][<span class="number">1</span>] , u );</span><br><span class="line">      upd( f[u][<span class="number">1</span>] , mx + i , trs[u][<span class="number">1</span>] , fr );</span><br><span class="line">      <span class="keyword">if</span>( f[u][<span class="number">0</span>] &gt; mx ) mx = f[u][<span class="number">0</span>] , fr = u;</span><br><span class="line">    &#125;</span><br><span class="line">    mx = -INF , fr = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = siz - <span class="number">1</span> , u ; ~i ; --i ) &#123;</span><br><span class="line">      u = vec[i];</span><br><span class="line">      upd( f[u][<span class="number">1</span>] , mx + siz - i - <span class="number">1</span> , trs[u][<span class="number">1</span>] , fr );</span><br><span class="line">      <span class="keyword">if</span>( f[u][<span class="number">0</span>] &gt; mx ) mx = f[u][<span class="number">0</span>] , fr = u;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Roww</span><span class="params">( <span class="keyword">int</span> f[][<span class="number">2</span>] , <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp; vec , <span class="keyword">int</span> trs[][<span class="number">2</span>] )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> mx , fr , siz;</span><br><span class="line">    mx = -INF , fr = <span class="number">0</span> , siz = vec.size();</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> , u ; i &lt; siz ; ++i ) &#123;</span><br><span class="line">      u = vec[i];</span><br><span class="line">      upd( f[u][<span class="number">1</span>] , f[u][<span class="number">0</span>] , trs[u][<span class="number">1</span>] , u );</span><br><span class="line">      upd( f[u][<span class="number">1</span>] , siz + mx , trs[u][<span class="number">1</span>] , fr );</span><br><span class="line">      <span class="keyword">if</span>( f[u][<span class="number">0</span>] - i - <span class="number">1</span> &gt; mx ) mx = f[u][<span class="number">0</span>] - i - <span class="number">1</span> , fr = u;</span><br><span class="line">    &#125;</span><br><span class="line">    mx = -INF , fr = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = siz - <span class="number">1</span> , u ; ~i ; --i ) &#123;</span><br><span class="line">      u = vec[i];</span><br><span class="line">      upd( f[u][<span class="number">1</span>] , siz + mx , trs[u][<span class="number">1</span>] , fr );</span><br><span class="line">      <span class="keyword">if</span>( f[u][<span class="number">0</span>] - ( siz - i ) &gt; mx )</span><br><span class="line">        mx = f[u][<span class="number">0</span>] - siz + i , fr = u;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">dp</span><span class="params">( <span class="keyword">int</span> f[][<span class="number">2</span>] , <span class="keyword">int</span> trs[][<span class="number">2</span>] , <span class="keyword">int</span> nxt[][<span class="number">3</span>] , <span class="keyword">int</span> flag )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> l = <span class="number">1</span> ; l &lt;= discre_tot ; ++l ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( flag ) Roww( f , lv[l] , trs );</span><br><span class="line">      <span class="keyword">else</span> Row( f , lv[l] , trs );</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; u : lv[l] ) &#123;</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span> , v ; j &lt; <span class="number">3</span> ; ++j ) </span><br><span class="line">          <span class="keyword">if</span>( ( v = nxt[u][j] ) ) </span><br><span class="line">            upd( f[v][<span class="number">0</span>] , f[u][<span class="number">1</span>] + <span class="number">1</span> , trs[v][<span class="number">0</span>] , u );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; opt;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">( <span class="keyword">int</span> f[][<span class="number">2</span>] , <span class="keyword">int</span> trs[][<span class="number">2</span>] )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mx = -INF , u = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = n ; i ; --i )</span><br><span class="line">      <span class="keyword">if</span>( f[i][<span class="number">1</span>] &gt; mx ) mx = f[i][<span class="number">1</span>] , u = i;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,mx);</span><br><span class="line">    <span class="keyword">while</span>( u != n ) &#123;</span><br><span class="line">      opt.push_back( u );</span><br><span class="line">      <span class="keyword">int</span> v = trs[u][<span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span>( v ^ u ) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp; vec = lv[discreid( dat[u].y )];</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator itu = vec.begin() , itv = vec.begin();</span><br><span class="line">        <span class="keyword">while</span>( *itu != u ) ++itu;</span><br><span class="line">        <span class="keyword">while</span>( *itv != v ) ++itv;</span><br><span class="line">        <span class="keyword">if</span>( dat[u].x &lt; dat[v].x ) &#123;</span><br><span class="line">          ++itu;</span><br><span class="line">          <span class="keyword">while</span>( *itu != v ) &#123;</span><br><span class="line">            opt.push_back( *itu );</span><br><span class="line">            ++itu;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">for</span>( <span class="keyword">int</span> i = vec.size() - <span class="number">1</span> ; ; --i ) &#123;</span><br><span class="line">            opt.push_back( vec[i] );</span><br><span class="line">            <span class="keyword">if</span>( vec[i] == v ) <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          --itu;</span><br><span class="line">          <span class="keyword">while</span>( *itu != v ) &#123;</span><br><span class="line">            opt.push_back( *itu );</span><br><span class="line">            --itu;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; ; ++i ) &#123;</span><br><span class="line">            opt.push_back( vec[i] );</span><br><span class="line">            <span class="keyword">if</span>( vec[i] == v ) <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        u = v;</span><br><span class="line">      &#125; </span><br><span class="line">      u = trs[u][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    reverse( opt.begin() , opt.end() );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : opt )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%d "</span>,v);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">""</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  read( n );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) read( dat[i].x ) , read( dat[i].y ) , dat[i].id = i;</span><br><span class="line">  ++n; dat[n].id = n;</span><br><span class="line">  sort( dat + <span class="number">1</span> , dat + <span class="number">1</span> + n , []( Data a , Data b ) &#123; <span class="keyword">return</span> a.y &lt; b.y; &#125; );</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">memset</span>( las , <span class="number">0</span> , <span class="keyword">sizeof</span> las ) , discre_tot = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) discre[++discre_tot] = dat[i].x;</span><br><span class="line">  sort( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot );</span><br><span class="line">  discre_tot = unique( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot ) - discre - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , t ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    t = discreid( dat[i].x );</span><br><span class="line">    <span class="keyword">if</span>( las[t] ) &#123;</span><br><span class="line">      pre[dat[i].id][<span class="number">0</span>] = las[t];</span><br><span class="line">      nxt[las[t]][<span class="number">0</span>] = dat[i].id;</span><br><span class="line">    &#125;</span><br><span class="line">    las[t] = dat[i].id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>( las , <span class="number">0</span> , <span class="keyword">sizeof</span> las ) , discre_tot = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) discre[++discre_tot] = dat[i].x + dat[i].y;</span><br><span class="line">  sort( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot ); </span><br><span class="line">  discre_tot = unique( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot ) - discre - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , t ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    t = discreid( dat[i].x + dat[i].y );</span><br><span class="line">    <span class="keyword">if</span>( las[t] ) &#123;</span><br><span class="line">      pre[dat[i].id][<span class="number">1</span>] = las[t];</span><br><span class="line">      nxt[las[t]][<span class="number">1</span>] = dat[i].id;</span><br><span class="line">    &#125;</span><br><span class="line">    las[t] = dat[i].id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>( las , <span class="number">0</span> , <span class="keyword">sizeof</span> las ) , discre_tot = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) discre[++discre_tot] = dat[i].x - dat[i].y;</span><br><span class="line">  sort( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot );</span><br><span class="line">  discre_tot = unique( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot ) - discre - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , t ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    t = discreid( dat[i].x - dat[i].y );</span><br><span class="line">    <span class="keyword">if</span>( las[t] ) &#123;</span><br><span class="line">      pre[dat[i].id][<span class="number">2</span>] = las[t];</span><br><span class="line">      nxt[las[t]][<span class="number">2</span>] = dat[i].id;</span><br><span class="line">    &#125;</span><br><span class="line">    las[t] = dat[i].id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  discre_tot = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) discre[++discre_tot] = dat[i].y;</span><br><span class="line">  sort( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot );</span><br><span class="line">  discre_tot = unique( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot ) - discre - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , t ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    t = discreid( dat[i].y );</span><br><span class="line">    lv[t].push_back( dat[i].id );</span><br><span class="line">  &#125;</span><br><span class="line">  sort( dat + <span class="number">1</span> , dat + <span class="number">1</span> + n , []( Data a , Data b ) &#123; <span class="keyword">return</span> a.id &lt; b.id; &#125; );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= discre_tot ; ++i )</span><br><span class="line">    sort( lv[i].begin() , lv[i].end() , []( <span class="keyword">int</span> a , <span class="keyword">int</span> b ) &#123; <span class="keyword">return</span> dat[a].x &lt; dat[b].x; &#125; );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>( f , <span class="number">0xc0</span> , <span class="keyword">sizeof</span> f );</span><br><span class="line">  <span class="built_in">memset</span>( trs , <span class="number">0</span> , <span class="keyword">sizeof</span> trs );</span><br><span class="line">  f[n][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  DP::dp( f , trs , nxt , <span class="number">0</span> );</span><br><span class="line"></span><br><span class="line">  DP::output( f , trs );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) </span><br><span class="line">    g[i][<span class="number">0</span>] = g[i][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  reverse( lv + <span class="number">1</span> , lv + <span class="number">1</span> + discre_tot );</span><br><span class="line">  DP::dp( g , trs , pre , <span class="number">1</span> );</span><br><span class="line"></span><br><span class="line">  --g[n][<span class="number">0</span>] , --g[n][<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">int</span> S = N - <span class="number">1</span> , T = N - <span class="number">2</span> , SS = N - <span class="number">3</span> , TT = N - <span class="number">4</span> , mx = g[n][<span class="number">0</span>];</span><br><span class="line">  Network_flows::init();</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    Network_flows::addedge( S , i , INF );</span><br><span class="line">    Network_flows::addedge( i , T , INF );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , v ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; <span class="number">3</span> ; ++j ) &#123;</span><br><span class="line">      u = i , v = nxt[u][j];</span><br><span class="line">      <span class="keyword">if</span>( !v ) <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">if</span>( u &amp;&amp; v &amp;&amp; f[u][<span class="number">1</span>] + g[v][<span class="number">1</span>] == mx ) &#123;</span><br><span class="line">        Network_flows::addedge( SS , v , <span class="number">1</span> );</span><br><span class="line">        Network_flows::addedge( u , TT , <span class="number">1</span> );</span><br><span class="line">        Network_flows::addedge( u , v , INF );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Network_flows::addedge( T , S , INF );</span><br><span class="line">  Network_flows::dinic( SS , TT );</span><br><span class="line">  <span class="keyword">int</span> res = -Network_flows::edge[Network_flows::eidx].flow;</span><br><span class="line">  Network_flows::edge[Network_flows::eidx].erase();</span><br><span class="line">  Network_flows::edge[Network_flows::eidx - <span class="number">1</span>].erase();</span><br><span class="line">  res -= Network_flows::dinic( T , S );</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="section-1">2016</h4>
<h5 id="noi2016-优秀的拆分"><a href="https://loj.ac/problem/2083" target="_blank" rel="noopener">[NOI2016] 优秀的拆分</a></h5>
<p>经典的枚举长度. 之后调和级数.</p>
<h5 id="noi2016-网格"><a href="https://loj.ac/problem/2084" target="_blank" rel="noopener">[NOI2016] 网格</a></h5>
<p>答案只可能是 <span class="math inline">\(-1,0,1,2\)</span>.</p>
<p><span class="math inline">\(-1\)</span> 就是只有一个跳蚤 , 或者有两个 , 且相邻.</p>
<p><span class="math inline">\(0\)</span> 就是原图不联通 , <span class="math inline">\(1\)</span> 就是原图存在割点. 其余情况就是 <span class="math inline">\(2\)</span> 了.</p>
<p>判断是否全部联通可以只保留蛐蛐周围八个格子的跳蚤 , 对于每个八连通的蛐蛐判断是否只有一个连通块.</p>
<p>割点只可能是与蛐蛐八连通的跳蚤. 由于要看是否是割点 , 需要保留两层点 , 也就是周边 <span class="math inline">\(5\times 5\)</span> 的区域.</p>
<p>注意特判 <span class="math inline">\(n , m\)</span> 为 <span class="math inline">\(1\)</span> 的情况.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> IN_LEN = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> buf[IN_LEN] , *s , *t;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Getchar</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="keyword">return</span> s == t &amp;&amp; ( t = ( s = buf ) + fread( buf , <span class="number">1</span> , IN_LEN , <span class="built_in">stdin</span> ) ) , s == t ? <span class="number">-1</span> : *s++; &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>( <span class="title">T</span> &amp; <span class="title">x</span> ) &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c , f; c = Getchar() , x = f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span> ) &#123; <span class="keyword">if</span>( c == <span class="string">'-'</span> ) f = <span class="number">1</span>; c = Getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span>( c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span> ) x = x * <span class="number">10</span> + c - <span class="number">48</span> , c = Getchar();</span><br><span class="line">    x = f ? -x : x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pii</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> fi , se;</span><br><span class="line">  pii( <span class="keyword">int</span> fi = <span class="number">0</span> , <span class="keyword">int</span> se = <span class="number">0</span> ):fi( fi ) , se( se ) &#123;&#125;</span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; ( <span class="keyword">const</span> pii &amp; rhs ) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fi &lt; rhs.fi || ( fi == rhs.fi &amp;&amp; se &lt; rhs.se );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dir4[<span class="number">2</span>][<span class="number">4</span>] = &#123; &#123; <span class="number">0</span> , <span class="number">0</span> , <span class="number">1</span> , <span class="number">-1</span> &#125; , &#123; <span class="number">1</span> , <span class="number">-1</span> , <span class="number">0</span> , <span class="number">0</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dir8[<span class="number">2</span>][<span class="number">8</span>] = &#123; &#123; <span class="number">1</span> , <span class="number">1</span> , <span class="number">1</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">-1</span> , <span class="number">-1</span> , <span class="number">-1</span> &#125; , &#123; <span class="number">1</span> , <span class="number">-1</span> , <span class="number">0</span> , <span class="number">-1</span> , <span class="number">1</span> , <span class="number">1</span> , <span class="number">-1</span> , <span class="number">0</span> &#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m , c;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HashTable</span> &#123;</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">1145141</span>;</span><br><span class="line">  <span class="keyword">int</span> head[mod] , nxt[N] , val[N] , tot;</span><br><span class="line">  lol que[N];</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">count</span><span class="params">( pii p )</span> </span>&#123;</span><br><span class="line">    lol v = <span class="number">2000000000L</span>L * p.fi + p.se;</span><br><span class="line">    <span class="keyword">int</span> u = v % mod;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] ; i ; i = nxt[i] )</span><br><span class="line">      <span class="keyword">if</span>( que[i] == v ) </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> &amp; <span class="keyword">operator</span> []( pii p ) &#123;</span><br><span class="line">    lol v = <span class="number">2000000000L</span>L * p.fi + p.se;</span><br><span class="line">    <span class="keyword">int</span> u = v % mod;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] ; i ; i = nxt[i] )</span><br><span class="line">      <span class="keyword">if</span>( que[i] == v ) </span><br><span class="line">        <span class="keyword">return</span> val[i];</span><br><span class="line">    nxt[++tot] = head[u]; val[tot] = <span class="number">0</span>; que[tot] = v; head[u] = tot;</span><br><span class="line">    <span class="keyword">return</span> val[tot];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>( head , <span class="number">0</span> , <span class="keyword">sizeof</span> head );</span><br><span class="line">    <span class="keyword">while</span>( tot ) &#123;</span><br><span class="line">      que[tot] = val[tot] = nxt[tot] = <span class="number">0</span>;</span><br><span class="line">      --tot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; mp[<span class="number">2</span>];</span><br><span class="line">pii dat[N]; <span class="keyword">bool</span> mark[N];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">iswhite</span><span class="params">( <span class="keyword">int</span> x , <span class="keyword">int</span> y )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( x &lt; <span class="number">1</span> || x &gt; n || y &lt; <span class="number">1</span> || y &gt; m ) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span>( mp[<span class="number">0</span>].count( pii( x , y ) ) ) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</span><br><span class="line">  mark[u] = <span class="number">1</span> , Q.push( u );</span><br><span class="line">  <span class="keyword">while</span>( !Q.empty() ) &#123;</span><br><span class="line">    u = Q.front(); Q.pop();</span><br><span class="line">    vec.push_back( u );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> k = <span class="number">0</span> , x , y ; k &lt; <span class="number">8</span> ; ++k ) &#123;</span><br><span class="line">      x = dat[u].fi + dir8[<span class="number">0</span>][k];</span><br><span class="line">      y = dat[u].se + dir8[<span class="number">1</span>][k];</span><br><span class="line">      <span class="keyword">if</span>( mp[<span class="number">0</span>].count( pii( x , y ) ) ) &#123;</span><br><span class="line">        x = mp[<span class="number">0</span>][pii( x , y )];</span><br><span class="line">        <span class="keyword">if</span>( !mark[x] ) &#123;</span><br><span class="line">          mark[x] = <span class="number">1</span>;</span><br><span class="line">          Q.push( x );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> DSU &#123;</span><br><span class="line">  <span class="keyword">int</span> f[N];</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = l ; i &lt;= r ; ++i ) f[i] = <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123; <span class="keyword">return</span> f[x] &lt; <span class="number">0</span> ? x : f[x] = find( f[x] ); &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123;</span><br><span class="line">    u = find( u ) , v = find( v );</span><br><span class="line">    <span class="keyword">if</span>( u == v ) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>( f[u] &lt; f[v] ) swap( u , v );</span><br><span class="line">    f[u] = v; --f[v];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pii P[N];</span><br><span class="line"><span class="keyword">int</span> tot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> _floodfill( <span class="keyword">void</span> ) &#123;</span><br><span class="line">  <span class="keyword">int</span> tmp = tot;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : vec ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> p = <span class="number">0</span> , x , y ; p &lt; <span class="number">8</span> ; ++p ) &#123;</span><br><span class="line">      x = dat[v].fi + dir8[<span class="number">0</span>][p];</span><br><span class="line">      y = dat[v].se + dir8[<span class="number">1</span>][p];</span><br><span class="line">      <span class="keyword">if</span>( !iswhite( x , y ) ) <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">if</span>( !mp[<span class="number">1</span>].count( pii( x , y ) ) ) &#123;</span><br><span class="line">        P[++tot] = pii( x , y );</span><br><span class="line">        mp[<span class="number">1</span>][pii( x , y )] = tot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  DSU::init( tmp + <span class="number">1</span> , tot );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = tmp + <span class="number">1</span> , x , y ; i &lt;= tot ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> p = <span class="number">0</span> ; p &lt; <span class="number">4</span> ; ++p ) &#123;</span><br><span class="line">      x = P[i].fi + dir4[<span class="number">0</span>][p];</span><br><span class="line">      y = P[i].se + dir4[<span class="number">1</span>][p];</span><br><span class="line">      <span class="keyword">if</span>( mp[<span class="number">1</span>].count( pii( x , y ) ) ) &#123;</span><br><span class="line">        x = mp[<span class="number">1</span>][pii( x , y )];</span><br><span class="line">        DSU::merge( i , x );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = tmp + <span class="number">2</span> , las = DSU::find( tmp + <span class="number">1</span> ) ; i &lt;= tot ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( DSU::find( i ) != las ) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">floodfill</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  <span class="built_in">memset</span>( mark + <span class="number">1</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">bool</span> ) * c );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= c ; ++i ) </span><br><span class="line">    <span class="keyword">if</span>( !mark[i] ) &#123;</span><br><span class="line">      vec.clear();</span><br><span class="line">      bfs( i );</span><br><span class="line">      <span class="keyword">if</span>( _floodfill() ) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Tarjan &#123;</span><br><span class="line">  <span class="keyword">int</span> head[N] , eidx , dfn[N] , low[N] , dfc;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt , to; &#125; edge[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">( <span class="keyword">int</span> n )</span> </span>&#123; </span><br><span class="line">    <span class="built_in">memset</span>( head + <span class="number">1</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * n );</span><br><span class="line">    <span class="built_in">memset</span>( dfn + <span class="number">1</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * n );</span><br><span class="line">    dfc = eidx = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123;</span><br><span class="line">    edge[++eidx] = (Edge) &#123; head[u] , v &#125;; head[u] = eidx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> fa )</span> </span>&#123;</span><br><span class="line">    dfn[u] = low[u] = ++dfc;</span><br><span class="line">    <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] , v ; i ; i = edge[i].nxt )</span><br><span class="line">      <span class="keyword">if</span>( !dfn[v = edge[i].to] ) &#123;</span><br><span class="line">        ++s;</span><br><span class="line">        <span class="keyword">if</span>( dfs( v , u ) ) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        low[u] = min( low[u] , low[v] );</span><br><span class="line">        <span class="keyword">if</span>( low[v] &gt;= dfn[u] &amp;&amp; fa &amp;&amp; mark[u] )</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> low[u] = min( low[u] , dfn[v] );</span><br><span class="line">    <span class="keyword">if</span>( !fa ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( s &gt; <span class="number">1</span> &amp;&amp; mark[u] ) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">work</span><span class="params">( <span class="keyword">int</span> n )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) </span><br><span class="line">      <span class="keyword">if</span>( !dfn[i] ) &#123;</span><br><span class="line">        <span class="keyword">if</span>( dfs( i , <span class="number">0</span> ) )</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cutpoint</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , x , y ; i &lt;= c ; ++i ) &#123;</span><br><span class="line">    x = dat[i].fi , y = dat[i].se;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> nx = x - <span class="number">2</span> ; nx &lt;= x + <span class="number">2</span> ; ++nx )</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> ny = y - <span class="number">2</span> ; ny &lt;= y + <span class="number">2</span> ; ++ny )</span><br><span class="line">        <span class="keyword">if</span>( nx == x - <span class="number">2</span> || nx == x + <span class="number">2</span> || ny == y - <span class="number">2</span> || ny == y + <span class="number">2</span> ) &#123;</span><br><span class="line">          <span class="keyword">if</span>( !iswhite( nx , ny ) ) <span class="keyword">continue</span>;</span><br><span class="line">          <span class="keyword">if</span>( !mp[<span class="number">1</span>].count( pii( nx , ny ) ) ) &#123;</span><br><span class="line">            mp[<span class="number">1</span>][pii( nx , ny )] = ++tot;</span><br><span class="line">            P[tot] = pii( nx , ny );</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">memset</span>( mark + <span class="number">1</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">bool</span> ) * tot );</span><br><span class="line">  Tarjan::init( tot );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , x , y ; i &lt;= tot ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> p = <span class="number">0</span> ; p &lt; <span class="number">4</span> ; ++p ) &#123;</span><br><span class="line">      x = P[i].fi + dir4[<span class="number">0</span>][p] , y = P[i].se + dir4[<span class="number">1</span>][p];</span><br><span class="line">      <span class="keyword">if</span>( mp[<span class="number">1</span>].count( pii( x , y ) ) ) &#123;</span><br><span class="line">        x = mp[<span class="number">1</span>][pii( x , y )];</span><br><span class="line">        Tarjan::addedge( i , x );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> p = <span class="number">0</span> ; p &lt; <span class="number">8</span> ; ++p ) &#123;</span><br><span class="line">      x = P[i].fi + dir8[<span class="number">0</span>][p] , y = P[i].se + dir8[<span class="number">1</span>][p];</span><br><span class="line">      <span class="keyword">if</span>( mp[<span class="number">0</span>].count( pii( x , y ) ) )</span><br><span class="line">        mark[i] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>( Tarjan::work( tot ) )</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Special</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( m == <span class="number">1</span> ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= c ; ++i )</span><br><span class="line">      swap( dat[i].fi , dat[i].se );</span><br><span class="line">    swap( n , m );</span><br><span class="line">  &#125;</span><br><span class="line">  sort( dat + <span class="number">1</span> , dat + <span class="number">1</span> + c );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , r ; i &lt;= c ; i = r + <span class="number">1</span> ) &#123;</span><br><span class="line">    r = i;</span><br><span class="line">    <span class="keyword">while</span>( r &lt; c &amp;&amp; dat[r + <span class="number">1</span>].se == dat[r].se + <span class="number">1</span> ) ++r;</span><br><span class="line">    <span class="keyword">if</span>( dat[i].se != <span class="number">1</span> &amp;&amp; dat[r].se != m ) &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"0"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"1"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  read( n ) , read( m ) , read( c );</span><br><span class="line">  mp[<span class="number">0</span>].clear() , mp[<span class="number">1</span>].clear() , tot = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= c ; ++i ) &#123;</span><br><span class="line">    read( dat[i].fi ) , read( dat[i].se );</span><br><span class="line">    mp[<span class="number">0</span>][dat[i]] = i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>( <span class="number">1L</span>L * n * m - c &lt;= <span class="number">1</span> ) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"-1"</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>( <span class="number">1L</span>L * n * m - c == <span class="number">2</span> ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++j )</span><br><span class="line">        <span class="keyword">if</span>( !mp[<span class="number">0</span>].count( pii( i , j ) ) ) &#123;</span><br><span class="line">          <span class="keyword">for</span>( <span class="keyword">int</span> p = <span class="number">0</span> ; p &lt; <span class="number">4</span> ; ++p ) </span><br><span class="line">            <span class="keyword">if</span>( iswhite( i + dir4[<span class="number">0</span>][p] , j + dir4[<span class="number">1</span>][p] ) ) &#123;</span><br><span class="line">              <span class="built_in">puts</span>(<span class="string">"-1"</span>);</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>( n == <span class="number">1</span> || m == <span class="number">1</span> ) &#123;</span><br><span class="line">    Special();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>( floodfill() ) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"0"</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>( cutpoint() ) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"1"</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"2"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  <span class="built_in">memset</span>( DSU::f , <span class="number">-1</span> , <span class="keyword">sizeof</span> DSU::f );</span><br><span class="line">  <span class="keyword">int</span> T; read( T );</span><br><span class="line">  <span class="keyword">while</span>( T-- ) solve();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2016-循环之美"><a href="https://loj.ac/problem/2085" target="_blank" rel="noopener">[NOI2016] 循环之美</a></h5>
<p>令 <span class="math inline">\((P,Q)=1\)</span> , 则 <span class="math inline">\(\frac{P}{Q}\)</span> 的小数部分为 <span class="math inline">\(\frac{P \bmod Q}{Q}\)</span> . 由于是纯循环小数 ,令其循环节长度为 <span class="math inline">\(t\)</span> , 则 <span class="math inline">\(k^t \cdot (P \bmod Q )\frac{1}{Q}\)</span> 的小数部分等于 <span class="math inline">\(\frac{P \mod Q}{Q}\)</span> ,也就是 <span class="math display">\[
\begin{aligned}
P \cdot k^t &amp;\equiv P \pmod Q \\
k^t &amp;\equiv 1 \pmod Q
\end{aligned}
\]</span> 也就是 <span class="math inline">\(k\)</span> 在模 <span class="math inline">\(Q\)</span> 意义下有逆元. 那么 <span class="math inline">\((k,Q)=1\)</span>. 问题变为 <span class="math display">\[
\begin{aligned}
\sum_{Q=1}^m\sum_{i=1}^n [(Q,k)=1][(i,Q)=1]
\end{aligned}
\]</span> 莫比乌斯反演 <span class="math display">\[
\begin{aligned}
&amp;\ \ \ \ \ \sum_{i=1}^n\sum_{j=1}^m[(i,k)=1][(j,i) =1] \\
&amp;= \sum_{i=1}^n [(i,k)=1]\sum_{d \mid i}\mu(d)\lfloor \frac{m}{d} \rfloor \\
&amp;= \sum_{d=1}^n\mu(d) \lfloor \frac{m}{d} \rfloor[(d,k)=1] \sum_{i=1}^{\lfloor \frac{n}{d}\rfloor}[(i,k)=1] 
\end{aligned}
\]</span> 对于第二个和式 , 可以预处理 <span class="math inline">\(O(1)\)</span> 计算. 前面的和式整除分块 , 问题在于 <span class="math inline">\(\sum_{d=1}^n \mu(d) [(d,k)=1]\)</span> 要怎么求.</p>
<p>类比 <span class="math inline">\(\text{min25}\)</span> 筛中的处理. 令 <span class="math inline">\(S(n,x) = \sum_{i=1}^n \mu(i) [(i,x)=1]\)</span> . 然后递归计算即可.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HashTable</span> &#123;</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">114514</span>;</span><br><span class="line">  lol que[N];</span><br><span class="line">  <span class="keyword">int</span> val[N] , nxt[N] , head[mod] , tot;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">( lol u , <span class="keyword">int</span> v )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t = u % mod;</span><br><span class="line">    val[++tot] = v;</span><br><span class="line">    nxt[tot] = head[t];</span><br><span class="line">    head[t] = tot;</span><br><span class="line">    que[tot] = u;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">count</span><span class="params">( lol u )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t = u % mod;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = head[t] ; i ; i = nxt[i] )</span><br><span class="line">      <span class="keyword">if</span>( que[i] == u )</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> &amp; <span class="keyword">operator</span> [] ( lol v ) &#123;</span><br><span class="line">    <span class="keyword">int</span> u = v % mod;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] ; i ; i = nxt[i] )</span><br><span class="line">      <span class="keyword">if</span>( que[i] == v )</span><br><span class="line">        <span class="keyword">return</span> val[i];</span><br><span class="line">    <span class="keyword">return</span> val[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125; mp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m , k , prime_tot , prime[N] , mu[N] , f[N] , p[N] , q[N];</span><br><span class="line"><span class="keyword">bool</span> vis[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">F</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123; <span class="keyword">return</span> ( x / k ) * f[k] + f[x % k]; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gcd</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; <span class="keyword">return</span> b ? gcd( b , a % b ) : a; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">S</span><span class="params">( <span class="keyword">int</span> n , <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( !n || ( k == <span class="number">1</span> &amp;&amp; n &lt; N ) ) <span class="keyword">return</span> mu[n];</span><br><span class="line">  lol hs = <span class="number">2001L</span>L * n + k;</span><br><span class="line">  <span class="keyword">if</span>( mp.count( hs ) ) <span class="keyword">return</span> mp[hs];</span><br><span class="line">  <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>( k == <span class="number">1</span> ) &#123;</span><br><span class="line">    res = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> , r ; i &lt;= n ; i = r + <span class="number">1</span> ) &#123;</span><br><span class="line">      r = ( n / ( n / i ) );</span><br><span class="line">      res -= S( n / i , <span class="number">1</span> ) * ( r - i + <span class="number">1</span> );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> res = S( n , q[k] ) + S( n / p[k] , k );</span><br><span class="line">  mp.insert( hs , res );</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;n,&amp;m,&amp;k);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> ; i &lt; N ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( !vis[i] ) prime[++prime_tot] = i , mu[i] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= prime_tot ; ++j ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( <span class="number">1L</span>L * i * prime[j] &gt;= N ) <span class="keyword">break</span>;</span><br><span class="line">      vis[i * prime[j]] = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span>( i % prime[j] ) mu[i * prime[j]] = -mu[i];</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> ; i &lt; N ; ++i ) mu[i] += mu[i - <span class="number">1</span>];</span><br><span class="line">  f[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= k ; ++i ) &#123;</span><br><span class="line">    f[i] = f[i - <span class="number">1</span>] + ( gcd( i , k ) == <span class="number">1</span> );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= prime_tot ; ++j )</span><br><span class="line">      <span class="keyword">if</span>( i % prime[j] == <span class="number">0</span> ) &#123;</span><br><span class="line">        p[i] = prime[j];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    q[i] = i;</span><br><span class="line">    <span class="keyword">while</span>( q[i] % p[i] == <span class="number">0</span> ) q[i] /= p[i];</span><br><span class="line">  &#125;</span><br><span class="line">  lol ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , r , las = <span class="number">0</span> , now ; i &lt;= min( n , m ) ; i = r + <span class="number">1</span> ) &#123;</span><br><span class="line">    r = min( ( n / ( n / i ) ) , ( m / ( m / i ) ) );</span><br><span class="line">    now = S( r , k );</span><br><span class="line">    ans += <span class="number">1L</span>L * ( now - las ) * F( m / i ) * ( n / i );</span><br><span class="line">    las = now;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; ans;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2016-区间"><a href="https://loj.ac/problem/2086" target="_blank" rel="noopener">[NOI2016] 区间</a></h5>
<p>扫描线</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> IN_LEN = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> buf[IN_LEN] , *s , *t;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Getchar</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="keyword">return</span> s == t &amp;&amp; ( t = ( s = buf ) + fread( buf , <span class="number">1</span> , IN_LEN , <span class="built_in">stdin</span> ) ) , s == t ? <span class="number">-1</span> : *s++; &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>( <span class="title">T</span> &amp; <span class="title">x</span> ) &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c , f; c = Getchar() , x = f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span> ) &#123; <span class="keyword">if</span>( c == <span class="string">'-'</span> ) f = <span class="number">1</span>; c = Getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span>( c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span> ) x = x * <span class="number">10</span> + c - <span class="number">48</span> , c = Getchar();</span><br><span class="line">    x = f ? -x : x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> val[N &lt;&lt; <span class="number">2</span>] , tag[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">up</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123; val[u] = max( val[u &lt;&lt; <span class="number">1</span>] , val[u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] ); &#125;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span> _tag( <span class="keyword">int</span> u , <span class="keyword">int</span> k ) &#123;</span><br><span class="line">  val[u] += k , tag[u] += k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dn</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( tag[u] ) &#123;</span><br><span class="line">    _tag( u &lt;&lt; <span class="number">1</span> , tag[u] );</span><br><span class="line">    _tag( u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> , tag[u] );</span><br><span class="line">    tag[u] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mdf</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> u , <span class="keyword">int</span> L , <span class="keyword">int</span> R , <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( l &gt;= L &amp;&amp; r &lt;= R ) &#123;</span><br><span class="line">    _tag( u , k );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>; dn( u );</span><br><span class="line">  <span class="keyword">if</span>( mid &gt;= L ) mdf( l , mid , u &lt;&lt; <span class="number">1</span> , L , R , k );</span><br><span class="line">  <span class="keyword">if</span>( mid &lt; R ) mdf( mid + <span class="number">1</span> , r , u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> , L , R , k );</span><br><span class="line">  up( u );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Seg</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> l , r , len;</span><br><span class="line">  Seg() &#123;&#125;</span><br><span class="line">  Seg( <span class="keyword">int</span> l , <span class="keyword">int</span> r ):l( l ) , r( r ) &#123;&#125;</span><br><span class="line">&#125; dat[N]; </span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> discre[N] , discre_tot;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;Seg&gt; vec[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  read( n ) , read( m );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , l , r ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    read( l ) , read( r );</span><br><span class="line">    discre[++discre_tot] = l;</span><br><span class="line">    discre[++discre_tot] = r;</span><br><span class="line">    dat[i] = Seg( l , r );</span><br><span class="line">    dat[i].len = r - l;</span><br><span class="line">  &#125;</span><br><span class="line">  sort( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot );</span><br><span class="line">  discre_tot = unique( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot ) - discre - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    dat[i].l = lower_bound( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot , dat[i].l ) - discre;</span><br><span class="line">    dat[i].r = lower_bound( discre + <span class="number">1</span> , discre + <span class="number">1</span> + discre_tot , dat[i].r ) - discre;</span><br><span class="line">  &#125;</span><br><span class="line">  sort( dat + <span class="number">1</span> , dat + <span class="number">1</span> + n , []( <span class="keyword">const</span> Seg &amp; a , <span class="keyword">const</span> Seg &amp; b ) &#123; <span class="keyword">return</span> a.len &lt; b.len; &#125; );</span><br><span class="line">  <span class="keyword">int</span> res = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">  <span class="keyword">bool</span> flag;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , cur = <span class="number">1</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    mdf( <span class="number">1</span> , discre_tot , <span class="number">1</span> , dat[i].l , dat[i].r , <span class="number">1</span> );</span><br><span class="line">    flag = val[<span class="number">1</span>] &gt;= m;</span><br><span class="line">    <span class="keyword">while</span>( val[<span class="number">1</span>] &gt;= m ) &#123;</span><br><span class="line">      mdf( <span class="number">1</span> , discre_tot , <span class="number">1</span> , dat[cur].l , dat[cur].r , <span class="number">-1</span> );</span><br><span class="line">      ++cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>( flag )</span><br><span class="line">      res = min( res , dat[i].len - dat[cur - <span class="number">1</span>].len );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>( res == <span class="number">0x3f3f3f3f</span> ) res = <span class="number">-1</span>;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; res;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2016-国王饮水记"><a href="https://loj.ac/problem/2087" target="_blank" rel="noopener">[NOI2016] 国王饮水记</a></h5>
<p>将 z<span class="math inline">\(h_i\)</span> 排序后 , 若 <span class="math inline">\(k\geq n\)</span> , 那么从小到大依次与 <span class="math inline">\(1\)</span> 连通. 否则就要一次连一些. 且在排序后是连续的. 于是就可以 <span class="math inline">\(\rm DP\)</span> , 令 <span class="math inline">\(f_{i,j}\)</span> 表示前 <span class="math inline">\(i\)</span> 个水箱分了 <span class="math inline">\(j\)</span> 段时 , <span class="math inline">\(1\)</span> 号水箱的最高水位. 于是就有 <span class="math inline">\(O(n^2 k)\)</span> 的做法了. <span class="math inline">\(f_{i,j} = \max_{k&lt;i}{\frac{f_{k,j-1}+S(k+1,i)}{i-k+1}}\)</span> , 这个 <span class="math inline">\(\rm DP\)</span> 可以斜率优化 , 于是就可以 <span class="math inline">\(O(nk)\)</span> 做了. 当然这样依旧过不了 , 注意到一件事 , 每次分成段的长度不大于上一次的段长. 这是因为对于较大的 <span class="math inline">\(h\)</span> , 自己和 <span class="math inline">\(h_1\)</span> 取平均更优. 打表发现最优决策中 , 段长会很快收敛至 <span class="math inline">\(1\)</span> , 大约需要 <span class="math inline">\(14\)</span> 层. 具体证明见 <a href="https://wenku.baidu.com/view/7842de6784868762cbaed52e.html" target="_blank" rel="noopener">官方题解</a>. 这样复杂度就是 <span class="math inline">\(O(14n)\)</span> 了.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> BASE = <span class="number">1e8</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> f[N];</span><br><span class="line"><span class="keyword">int</span> g[<span class="number">15</span>][N] , n , k , p , he , ta , S[N] , h[N];</span><br><span class="line"><span class="keyword">int</span> num[N] , tp;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Div</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123;</span><br><span class="line">  lol d = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= tp ; ++i ) &#123;</span><br><span class="line">    d = d * BASE + num[i];</span><br><span class="line">    num[i] = d / x;</span><br><span class="line">    d %= x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>,<span class="keyword">double</span>&gt; pii;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line">pii que[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">slope</span><span class="params">( <span class="keyword">const</span> pii &amp; a , <span class="keyword">const</span> pii &amp; b )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ( b.se - a.se ) / ( b.fi - a.fi );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;n,&amp;k,&amp;p);</span><br><span class="line">  k = min( k , n - <span class="number">1</span> );</span><br><span class="line">  tp = p / <span class="number">8</span> + <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">if</span>( tp * <span class="number">8</span> &gt; p * <span class="number">2</span> ) --tp;</span><br><span class="line">  <span class="keyword">int</span> tot = <span class="number">1</span>;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,h+<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> , x ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">    <span class="keyword">if</span>( x &gt; h[<span class="number">1</span>] ) h[++tot] = x;</span><br><span class="line">  &#125;</span><br><span class="line">  n = tot;</span><br><span class="line">  sort( h + <span class="number">1</span> , h + <span class="number">1</span> + tot );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= n ; ++i ) f[i] = h[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) S[i] = S[i - <span class="number">1</span>] + h[i];</span><br><span class="line">  <span class="keyword">int</span> lim = min( <span class="number">14</span> , k );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= lim ; ++i ) &#123;</span><br><span class="line">    que[he = ta = <span class="number">1</span>] = pii( i - <span class="number">2</span> , S[i - <span class="number">1</span>] - f[i - <span class="number">1</span>] );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = i ; j &lt;= n ; ++j ) &#123;</span><br><span class="line">      pii p = pii( j - <span class="number">1</span> , S[j] - f[j] );</span><br><span class="line">      <span class="keyword">while</span>( he &lt; ta &amp;&amp; slope( que[he] , pii( j , S[j] ) ) &lt;= slope( que[he + <span class="number">1</span>] , pii( j , S[j] ) ) ) ++he;</span><br><span class="line">      f[j] = slope( que[he] , pii( j , S[j] ) );</span><br><span class="line">      g[i][j] = que[he].fi + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span>( he &lt; ta &amp;&amp; slope( que[ta] , p ) &lt; slope( que[ta - <span class="number">1</span>] , p ) ) --ta;</span><br><span class="line">      que[++ta] = p;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> las = k - lim;</span><br><span class="line">  <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt; vec;</span><br><span class="line">  num[<span class="number">0</span>] = h[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> u = n - las , t = lim ; t ; --t ) &#123;</span><br><span class="line">    vec.push_back( pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;( u - g[t][u] + <span class="number">1</span> , S[u] - S[g[t][u]] ) );</span><br><span class="line">    u = g[t][u];</span><br><span class="line">  &#125;</span><br><span class="line">  reverse( vec.begin() , vec.end() );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">const</span> pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; &amp; v : vec ) &#123;</span><br><span class="line">    num[<span class="number">0</span>] += v.se;</span><br><span class="line">    Div( v.fi );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = n - las + <span class="number">1</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    num[<span class="number">0</span>] += h[i];</span><br><span class="line">    Div( <span class="number">2</span> );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d."</span>,num[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= tp ; ++i )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%08d"</span>,num[i]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2016-旷野大计算"><a href="https://loj.ac/problem/2088" target="_blank" rel="noopener">[NOI2016] 旷野大计算</a></h5>
<p><strong>Problem1</strong>: 模拟.</p>
<p><strong>Problem2</strong>: 利用左移避免乘法.</p>
<p><strong>Problem3</strong>: 利用 <span class="math inline">\(S\)</span> 函数的取值范围 , 将 <span class="math inline">\(a\)</span> 左移若干位 , 此时取值就是 <span class="math inline">\({0,0.5,1}\)</span>.</p>
<p><strong>Problem4</strong>:</p>
<p>对于 <span class="math inline">\(S(x)\)</span> , <span class="math inline">\(S&#39;(x) = \frac{e^{-x}}{(1+e^{-x})^2}\)</span>. , 于是 <span class="math inline">\(S&#39;(0) = \frac{1}{4}\)</span> . 那么在 <span class="math inline">\(|x|\)</span> 极小的时候 <span class="math inline">\(S(x) \approx \frac{1}{4} x+0.5\)</span> . 这样可以解决负数的情况. 对于正数 , 考虑去除 <span class="math inline">\(a\)</span> , 令 <span class="math inline">\(p = S(a\cdot 2^k)\)</span> , 如果 <span class="math inline">\(a&gt;0\)</span> , <span class="math inline">\(p=1\)</span> 否则 <span class="math inline">\(p=0\)</span>. 则对于 <span class="math inline">\(S(a + p\cdot 2^k)\)</span> , 如果 <span class="math inline">\(a\)</span> 为正数则为 <span class="math inline">\(1\)</span> , 否则为 <span class="math inline">\(\frac{1}{4}a + 0.5\)</span>. 对于正数也像负数这样减 , 会多减 <span class="math inline">\(2^k\)</span> , 用 <span class="math inline">\(p\)</span> 来抵消即可.</p>
<p><strong>Problem5</strong>: 一个一个左移.</p>
<p><strong>Problem6</strong>: 就是对于每一位问是否大于 <span class="math inline">\(2^i\)</span> . 用 <span class="math inline">\(4\)</span> 中的方法就行了.</p>
<p><strong>Problem7</strong>:</p>
<p>考虑两个数两位分别是 <span class="math inline">\(a,b\)</span> , 如果 <span class="math inline">\(a+b = 0\)</span> 或 <span class="math inline">\(a+b = 2\)</span> , 则此位位 <span class="math inline">\(0\)</span> , 如果 <span class="math inline">\(a+b = 1\)</span> 则为 <span class="math inline">\(1\)</span> .</p>
<p>于是当 <span class="math inline">\(a+b = 2\)</span> 时异或为 <span class="math inline">\(0\)</span> , 否则为 <span class="math inline">\(a+b\)</span> . 于是减去 <span class="math inline">\(1.5\)</span> 求 <span class="math inline">\(S((a+b)\cdot 2^k)\)</span> , 如果是 <span class="math inline">\(2\)</span> 的话就是 <span class="math inline">\(1\)</span> , 否则是 <span class="math inline">\(0\)</span> , 乘 <span class="math inline">\(2\)</span> 后减去就行了</p>
<p><strong>Problem8</strong>:</p>
<p>可以二分出 <span class="math inline">\(S&#39;(x) \approx \frac{1}{10}\)</span> 的 <span class="math inline">\(x\)</span> . 然后直接算就行了. 找出 <span class="math inline">\(x\)</span> 可以直接 <span class="math inline">\(\rm python\)</span> 大法.</p>
<p><strong>Problem9</strong>:</p>
<p>考虑冒泡排序 , 每次需要求出 <span class="math inline">\(\min(a,b),\max(a,b)\)</span> .</p>
<p>考虑 k<span class="math inline">\(\max( a,b) = a + \max( 0 , b-a )\)</span>. <span class="math inline">\(\max(0,x)\)</span> 可以用 <span class="math inline">\(4\)</span> 中的方法求出.</p>
<p><strong>Problem10</strong>:</p>
<p>用快速乘算出 <span class="math inline">\(ab\)</span> , 然后每次判断和 <span class="math inline">\(m \cdot 2^k\)</span> 大小的关系来减就好了.</p>
<h4 id="section-2">2017</h4>
<h5 id="noi2017-整数"><a href="https://loj.ac/problem/2302" target="_blank" rel="noopener">[NOI2017] 整数</a></h5>
<p>线段树维护全是 <span class="math inline">\(1\)</span> 的位和全是 <span class="math inline">\(0\)</span> 的位 , 每次加减进位就找到最近的不是全 <span class="math inline">\(0\)</span> 或全 <span class="math inline">\(1\)</span> 的位进行操作 , 需要压位.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> IN_LEN = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> buf[IN_LEN] , *s , *t;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Getchar</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="keyword">return</span> s == t &amp;&amp; ( t = ( s = buf ) + fread( buf , <span class="number">1</span> , IN_LEN , <span class="built_in">stdin</span> ) ) , s == t ? <span class="number">-1</span> : *s++; &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>( <span class="title">T</span> &amp; <span class="title">x</span> ) &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c , f; c = Getchar() , x = f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span> ) &#123; <span class="keyword">if</span>( c == <span class="string">'-'</span> ) f = <span class="number">1</span>; c = Getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span>( c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span> ) x = x * <span class="number">10</span> + c - <span class="number">48</span> , c = Getchar();</span><br><span class="line">    x = f ? -x : x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> oubuf[<span class="number">1</span> &lt;&lt; <span class="number">21</span> | <span class="number">1</span>] , *tp = oubuf;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">( <span class="keyword">char</span> c )</span> </span>&#123;</span><br><span class="line">    *tp++ = c;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">flush</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    fwrite( oubuf , <span class="number">1</span> , tp - oubuf , <span class="built_in">stdout</span> );</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">using</span> IO::read;</span><br><span class="line"><span class="keyword">using</span> IO::print;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> lol U = ( <span class="number">1L</span>L &lt;&lt; <span class="number">60</span> ) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> _1[N &lt;&lt; <span class="number">2</span>] , _0[N &lt;&lt; <span class="number">2</span>] , set_1[N &lt;&lt; <span class="number">2</span>] , set_0[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line">lol val[N];</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  _0[u] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>( l == r ) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  build( l , mid , u &lt;&lt; <span class="number">1</span> );</span><br><span class="line">  build( mid + <span class="number">1</span> , r , u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">up</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  _1[u] = _1[u &lt;&lt; <span class="number">1</span>] &amp; _1[u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">  _0[u] = _0[u &lt;&lt; <span class="number">1</span>] &amp; _0[u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span> _set_1( <span class="keyword">int</span> u ) &#123;</span><br><span class="line">  set_1[u] = <span class="number">1</span>;</span><br><span class="line">  set_0[u] = <span class="number">0</span>;</span><br><span class="line">  _1[u] = <span class="number">1</span> , _0[u] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span> _set_0( <span class="keyword">int</span> u ) &#123;</span><br><span class="line">  set_0[u] = <span class="number">1</span>;</span><br><span class="line">  set_1[u] = <span class="number">0</span>;</span><br><span class="line">  _0[u] = <span class="number">1</span> , _1[u] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dn</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( set_1[u] ) &#123;</span><br><span class="line">    _set_1( u &lt;&lt; <span class="number">1</span> );</span><br><span class="line">    _set_1( u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> );</span><br><span class="line">    set_1[u] = <span class="number">0</span>;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">if</span>( set_0[u] ) &#123;</span><br><span class="line">    _set_0( u &lt;&lt; <span class="number">1</span> );</span><br><span class="line">    _set_0( u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> );</span><br><span class="line">    set_0[u] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">upd</span><span class="params">( <span class="keyword">int</span> p , <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( set_1[u] ) </span><br><span class="line">    val[p] = U;</span><br><span class="line">  <span class="keyword">if</span>( set_0[u] ) </span><br><span class="line">    val[p] = <span class="number">0</span>;</span><br><span class="line">  set_1[u] = set_0[u] = <span class="number">0</span>;</span><br><span class="line">  _1[u] = _0[u] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>( val[p] == U ) _1[u] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>( val[p] == <span class="number">0</span> ) _0[u] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">lol <span class="title">qry</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> u , <span class="keyword">int</span> pos )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( l == r ) &#123;</span><br><span class="line">    upd( l , u );</span><br><span class="line">    <span class="keyword">return</span> val[l];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>; dn( u );</span><br><span class="line">  <span class="keyword">if</span>( mid &gt;= pos ) <span class="keyword">return</span> qry( l , mid , u &lt;&lt; <span class="number">1</span> , pos );</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> qry( mid + <span class="number">1</span> , r , u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> , pos );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mdf</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> u , <span class="keyword">int</span> pos , lol k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( l == r ) &#123;</span><br><span class="line">    val[l] = k;</span><br><span class="line">    set_1[u] = set_0[u] = <span class="number">0</span>;</span><br><span class="line">    upd( l , u );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>; dn( u );</span><br><span class="line">  <span class="keyword">if</span>( mid &gt;= pos ) mdf( l , mid , u &lt;&lt; <span class="number">1</span> , pos , k );</span><br><span class="line">  <span class="keyword">else</span> mdf( mid + <span class="number">1</span> , r , u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> , pos , k );</span><br><span class="line">  up( u );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Set_1</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> u , <span class="keyword">int</span> L , <span class="keyword">int</span> R )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( l &gt;= L &amp;&amp; r &lt;= R ) &#123;</span><br><span class="line">    _set_1( u );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>; dn( u );</span><br><span class="line">  <span class="keyword">if</span>( mid &gt;= L ) Set_1( l , mid , u &lt;&lt; <span class="number">1</span> , L , R );</span><br><span class="line">  <span class="keyword">if</span>( mid &lt; R ) Set_1( mid + <span class="number">1</span> , r , u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> , L , R );</span><br><span class="line">  up( u );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Set_0</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> u , <span class="keyword">int</span> L , <span class="keyword">int</span> R )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( l &gt;= L &amp;&amp; r &lt;= R ) &#123;</span><br><span class="line">    _set_0( u );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>; dn( u );</span><br><span class="line">  <span class="keyword">if</span>( mid &gt;= L ) Set_0( l , mid , u &lt;&lt; <span class="number">1</span> , L , R );</span><br><span class="line">  <span class="keyword">if</span>( mid &lt; R ) Set_0( mid + <span class="number">1</span> , r , u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> , L , R );</span><br><span class="line">  up( u );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_no_1</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> u , <span class="keyword">int</span> L )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( _1[u] ) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">if</span>( l == r ) &#123;</span><br><span class="line">    upd( l , u );</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>; dn( u );</span><br><span class="line">  <span class="keyword">if</span>( L &lt;= mid ) &#123;</span><br><span class="line">    <span class="keyword">int</span> t = get_no_1( l , mid , u &lt;&lt; <span class="number">1</span> , L );</span><br><span class="line">    <span class="keyword">return</span> ~t ? t : get_no_1( mid + <span class="number">1</span> , r , u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> , L );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> get_no_1( mid + <span class="number">1</span> , r , u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> , L );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_no_0</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> u , <span class="keyword">int</span> L )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( _0[u] ) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">if</span>( l == r ) &#123;</span><br><span class="line">    upd( l , u );</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>; dn( u );</span><br><span class="line">  <span class="keyword">if</span>( L &lt;= mid ) &#123;</span><br><span class="line">    <span class="keyword">int</span> t = get_no_0( l , mid , u &lt;&lt; <span class="number">1</span> , L );</span><br><span class="line">    <span class="keyword">return</span> ~t ? t : get_no_0( mid + <span class="number">1</span> , r ,  u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> , L );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> get_no_0( mid + <span class="number">1</span> , r , u &lt;&lt; <span class="number">1</span> | <span class="number">1</span> , L );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _Dec( lol a , <span class="keyword">int</span> b ) &#123;</span><br><span class="line">  <span class="keyword">if</span>( !a ) <span class="keyword">return</span>;</span><br><span class="line">  lol tmp = qry( <span class="number">0</span> , n , <span class="number">1</span> , b );</span><br><span class="line">  <span class="keyword">if</span>( tmp &gt;= a ) &#123;</span><br><span class="line">    mdf( <span class="number">0</span> , n , <span class="number">1</span> , b , tmp - a );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  tmp = ( tmp - a ) + U + <span class="number">1</span>;</span><br><span class="line">  mdf( <span class="number">0</span> , n , <span class="number">1</span> , b , tmp );</span><br><span class="line">  <span class="keyword">int</span> id = get_no_0( <span class="number">0</span> , n , <span class="number">1</span> , b + <span class="number">1</span> );</span><br><span class="line">  <span class="keyword">if</span>( b + <span class="number">1</span> &lt;= id - <span class="number">1</span> ) Set_1( <span class="number">0</span> , n , <span class="number">1</span> , b + <span class="number">1</span> , id - <span class="number">1</span> );</span><br><span class="line">  mdf( <span class="number">0</span> , n , <span class="number">1</span> , id , qry( <span class="number">0</span> , n , <span class="number">1</span> , id ) - <span class="number">1</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _Add( lol a , <span class="keyword">int</span> b ) &#123;</span><br><span class="line">  <span class="keyword">if</span>( !a ) <span class="keyword">return</span>;</span><br><span class="line">  lol tmp = qry( <span class="number">0</span> , n , <span class="number">1</span> , b );</span><br><span class="line">  <span class="keyword">if</span>( a + tmp &lt;= U ) &#123;</span><br><span class="line">    mdf( <span class="number">0</span> , n , <span class="number">1</span> , b , tmp + a );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  tmp = tmp + a - U - <span class="number">1</span>;</span><br><span class="line">  mdf( <span class="number">0</span> , n , <span class="number">1</span> , b , tmp );</span><br><span class="line">  <span class="keyword">int</span> id = get_no_1( <span class="number">0</span> , n , <span class="number">1</span> , b + <span class="number">1</span> );</span><br><span class="line">  <span class="keyword">if</span>( b + <span class="number">1</span> &lt;= id - <span class="number">1</span> ) Set_0( <span class="number">0</span> , n , <span class="number">1</span> , b + <span class="number">1</span> , id - <span class="number">1</span> );</span><br><span class="line">  mdf( <span class="number">0</span> , n , <span class="number">1</span> , id , qry( <span class="number">0</span> , n , <span class="number">1</span> , id ) + <span class="number">1</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dec</span><span class="params">( lol a , <span class="keyword">int</span> b )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> id = ( b / <span class="number">60</span> ) , m = ( b % <span class="number">60</span> ); </span><br><span class="line">  lol tmp = ( a &amp; ( ( <span class="number">1L</span>L &lt;&lt; ( <span class="number">60</span> - m ) ) - <span class="number">1</span> ) ) &lt;&lt; m;</span><br><span class="line">  _Dec( tmp , id );</span><br><span class="line">  _Dec( a &gt;&gt; ( <span class="number">60</span> - m ) , id + <span class="number">1</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">( lol a , <span class="keyword">int</span> b )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> id = ( b / <span class="number">60</span> ) , m = ( b % <span class="number">60</span> );</span><br><span class="line">  lol tmp = ( a &amp; ( ( <span class="number">1L</span>L &lt;&lt; ( <span class="number">60</span> - m ) ) - <span class="number">1</span> ) ) &lt;&lt; m;</span><br><span class="line">  _Add( tmp , id );</span><br><span class="line">  _Add( a &gt;&gt; ( <span class="number">60</span> - m ) , id + <span class="number">1</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Qry</span><span class="params">( <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> id = k / <span class="number">60</span> , m = k % <span class="number">60</span>;</span><br><span class="line">  lol res = qry( <span class="number">0</span> , n , <span class="number">1</span> , id );</span><br><span class="line">  <span class="keyword">if</span>( ( res &gt;&gt; m ) &amp; <span class="number">1</span> ) print(<span class="string">'1'</span>);</span><br><span class="line">  <span class="keyword">else</span> print(<span class="string">'0'</span>);</span><br><span class="line">  print(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  read( n ) , read( val[<span class="number">0</span>] ) , read( val[<span class="number">0</span>] ) , read( val[<span class="number">0</span>] ) , val[<span class="number">0</span>] = <span class="number">0</span>; <span class="keyword">int</span> tn = n; n = n / <span class="number">2</span> + <span class="number">5</span>;</span><br><span class="line">  build( <span class="number">0</span> , n , <span class="number">1</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , a , b , opt ; i &lt;= tn ; ++i ) &#123;</span><br><span class="line">    read( opt ) , read( a );</span><br><span class="line">    <span class="keyword">if</span>( opt == <span class="number">2</span> ) Qry( a );</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      read( b );</span><br><span class="line">      <span class="keyword">if</span>( !a ) <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">if</span>( a &lt; <span class="number">0</span> ) Dec( -a , b );</span><br><span class="line">      <span class="keyword">else</span> Add( a , b );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  IO::flush();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2017-蚯蚓排队"><a href="https://loj.ac/problem/2303" target="_blank" rel="noopener">[NOI2017] 蚯蚓排队</a></h5>
<p>对于 <span class="math inline">\(S\)</span> 的每个子串都要单独询问 , 那么就有 <span class="math inline">\(|S|\)</span> 个询问 , 要做到 <span class="math inline">\(O(1)\)</span>. 考虑用 <span class="math inline">\(\rm Hash\)</span> 表保存所有小于等于 <span class="math inline">\(k\)</span> 长度的串的出现次数. 对于只有操作 <span class="math inline">\(1\)</span> , 以每个长度结尾的字符串只会加入哈希表 <span class="math inline">\(1\)</span> 次 , 这部分复杂度是 <span class="math inline">\(O(nk)\)</span>. 对于操作二 , 假设其分裂与再合并改变的子串数量都是 <span class="math inline">\(k^2\)</span> , 复杂度就是 <span class="math inline">\(O(ck^2)\)</span> . 可以通过.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> base = <span class="number">131</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> K = <span class="number">51</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Hash</span> &#123;</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> mod1 = <span class="number">1e9</span> + <span class="number">9</span> , mod2 = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line">  <span class="keyword">int</span> hs1 , hs2;</span><br><span class="line">  Hash() &#123; hs1 = hs2 = <span class="number">0</span>; &#125;</span><br><span class="line">  Hash( <span class="keyword">int</span> a , <span class="keyword">int</span> b ):hs1( a ) , hs2( b ) &#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">mo</span><span class="params">( <span class="keyword">int</span> x , <span class="keyword">int</span> mod )</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> ( x + ( x &gt;&gt; <span class="number">31</span> &amp; mod ) ); &#125;</span><br><span class="line">  <span class="keyword">void</span> <span class="keyword">operator</span> = ( <span class="keyword">const</span> <span class="keyword">int</span> &amp; rhs ) &#123;</span><br><span class="line">    hs1 = rhs , hs2 = rhs;</span><br><span class="line">  &#125;</span><br><span class="line">  Hash <span class="keyword">operator</span> * ( <span class="keyword">const</span> <span class="keyword">int</span> &amp; k ) <span class="keyword">const</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> Hash( <span class="number">1L</span>L * hs1 * k % mod1 , <span class="number">1L</span>L * hs2 * k % mod2 );</span><br><span class="line">  &#125;</span><br><span class="line">  Hash <span class="keyword">operator</span> - ( <span class="keyword">const</span> Hash &amp; rhs ) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Hash( mo( hs1 - rhs.hs1 , mod1 ) , mo( hs2 - rhs.hs2 , mod2 ) );</span><br><span class="line">  &#125;</span><br><span class="line">  Hash <span class="keyword">operator</span> + ( <span class="keyword">const</span> <span class="keyword">int</span> &amp; k ) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Hash( mo( hs1 + k - mod1 , mod1 ) , mo( hs2 + k - mod2 , mod2 ) );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span> == ( <span class="keyword">const</span> Hash &amp; rhs ) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> hs1 == rhs.hs1 &amp;&amp; hs2 == rhs.hs2;</span><br><span class="line">  &#125;</span><br><span class="line">  Hash <span class="keyword">operator</span> * ( <span class="keyword">const</span> Hash &amp; rhs ) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Hash( <span class="number">1L</span>L * hs1 * rhs.hs1 % mod1 , <span class="number">1L</span>L * hs2 * rhs.hs2 % mod2 );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Hash_Table</span> &#123;</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">19260817</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1e7</span> + <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">int</span> head[mod] , nxt[M] , tot , val[M]; Hash que[M];</span><br><span class="line">  <span class="keyword">int</span> &amp; <span class="keyword">operator</span> [] ( Hash k ) &#123;</span><br><span class="line">    <span class="keyword">int</span> u = k.hs1 % mod;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] ; i ; i = nxt[i] )</span><br><span class="line">      <span class="keyword">if</span>( que[i] == k ) <span class="keyword">return</span> val[i];</span><br><span class="line">    nxt[++tot] = head[u]; que[tot] = k , val[tot] = <span class="number">0</span>; </span><br><span class="line">    head[u] = tot;</span><br><span class="line">    <span class="keyword">return</span> val[tot];</span><br><span class="line">  &#125;</span><br><span class="line">&#125; mp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> nxt[N] , pre[N] , dat[N] , n , m , bac[<span class="number">11</span>];</span><br><span class="line"><span class="keyword">char</span> str[<span class="keyword">int</span>(<span class="number">5e5</span>) + <span class="number">5</span>];</span><br><span class="line">Hash Pow[N];</span><br><span class="line"></span><br><span class="line">Hash _get( Hash * hs , <span class="keyword">int</span> L , <span class="keyword">int</span> R ) &#123;</span><br><span class="line">  <span class="keyword">return</span> hs[R] - ( hs[L - <span class="number">1</span>] * Pow[R - L + <span class="number">1</span>] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> A[N] , B[N] , tpa , tpb , tot , u , C[N] , tpc;</span><br><span class="line">  tot = <span class="number">0</span> , u = a , tpa = tpb = <span class="number">0</span>; <span class="keyword">static</span> Hash hs[N];</span><br><span class="line">  <span class="keyword">while</span>( tpa &lt; K - <span class="number">2</span> &amp;&amp; u ) &#123;</span><br><span class="line">    A[++tpa] = dat[u];</span><br><span class="line">    u = pre[u];</span><br><span class="line">  &#125;</span><br><span class="line">  tot = <span class="number">0</span> , u = b;</span><br><span class="line">  <span class="keyword">while</span>( tpb &lt; K - <span class="number">2</span> &amp;&amp; u ) &#123;</span><br><span class="line">    B[++tpb] = dat[u];</span><br><span class="line">    u = nxt[u];</span><br><span class="line">  &#125;</span><br><span class="line">  nxt[a] = b , pre[b] = a , tpc = <span class="number">0</span>;</span><br><span class="line">  tot = tpa;</span><br><span class="line">  <span class="keyword">while</span>( tot ) C[++tpc] = A[tot--];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= tpb ; ++i ) C[++tpc] = B[i];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= tpc ; ++i )</span><br><span class="line">    hs[i] = ( hs[i - <span class="number">1</span>] * base + C[i] );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= tpa ; ++i )</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = tpa + <span class="number">1</span> , t = min( tpc , i + K - <span class="number">2</span> ) ; j &lt;= t ; ++j )</span><br><span class="line">      ++mp[_get( hs , i , j )];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qry</span><span class="params">( <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> res = <span class="number">1</span> , m = <span class="built_in">strlen</span>( str + <span class="number">1</span> );</span><br><span class="line">  <span class="keyword">if</span>( m &lt; k ) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"0"</span>),<span class="keyword">void</span>();</span><br><span class="line">  <span class="keyword">if</span>( k == <span class="number">1</span> ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) </span><br><span class="line">      res = <span class="number">1L</span>L * res * bac[str[i] - <span class="string">'0'</span>] % <span class="number">998244353</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> Hash hs[<span class="keyword">int</span>(<span class="number">5e5</span>)+<span class="number">5</span>];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) hs[i] = hs[i - <span class="number">1</span>] * base + ( str[i] - <span class="string">'0'</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = k ; i &lt;= m ; ++i ) </span><br><span class="line">    res = <span class="number">1L</span>L * res * mp[_get( hs , i - k + <span class="number">1</span> , i )] % <span class="number">998244353</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">split</span><span class="params">( <span class="keyword">int</span> a )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> A[N] , B[N] , C[N] , tpa , tpb , tpc , tot , u;</span><br><span class="line">  <span class="keyword">static</span> Hash hs[N];</span><br><span class="line">  tot = <span class="number">0</span> , u = a , tpa = tpb = tpc = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>( tpa &lt; K - <span class="number">2</span> &amp;&amp; u ) &#123;</span><br><span class="line">    A[++tpa] = dat[u];</span><br><span class="line">    u = pre[u];</span><br><span class="line">  &#125;</span><br><span class="line">  tot = <span class="number">0</span> , u = nxt[a];</span><br><span class="line">  <span class="keyword">while</span>( tot &lt; K - <span class="number">2</span> &amp;&amp; u ) &#123;</span><br><span class="line">    B[++tpb] = dat[u];</span><br><span class="line">    u = nxt[u];</span><br><span class="line">  &#125;</span><br><span class="line">  tot = tpa;</span><br><span class="line">  <span class="keyword">while</span>( tot ) C[++tpc] = A[tot--];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= tpb ; ++i ) C[++tpc] = B[i];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= tpc ; ++i ) </span><br><span class="line">    hs[i] = hs[i - <span class="number">1</span>] * base + C[i];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= tpa ; ++i )</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = tpa + <span class="number">1</span> , t = min( tpc , i + K - <span class="number">2</span> ) ; j &lt;= t ; ++j )</span><br><span class="line">      --mp[_get( hs , i , j )];</span><br><span class="line">  pre[nxt[a]] = <span class="number">0</span>;</span><br><span class="line">  nxt[a] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line">  Pow[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) Pow[i] = Pow[i - <span class="number">1</span>] * base;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,dat+i) , ++bac[dat[i]];</span><br><span class="line">  <span class="keyword">int</span> opt , a , b;</span><br><span class="line">  <span class="keyword">while</span>( m-- ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;opt);</span><br><span class="line">    <span class="keyword">if</span>( opt == <span class="number">1</span> ) &#123;</span><br><span class="line">      _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;a,&amp;b);</span><br><span class="line">      merge( a , b );</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>( opt == <span class="number">2</span> ) &#123;</span><br><span class="line">      _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a);</span><br><span class="line">      split( a );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      _w = <span class="built_in">scanf</span>(<span class="string">"%s%d"</span>,str+<span class="number">1</span>,&amp;a);          </span><br><span class="line">      qry( a );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2017-泳池"><a href="https://loj.ac/problem/2304" target="_blank" rel="noopener">[NOI2017] 泳池</a></h5>
<p>恰好为 <span class="math inline">\(k\)</span> 的概率就是最多为 <span class="math inline">\(k\)</span> 的概率减去最多为 <span class="math inline">\(k-1\)</span> 的概率.</p>
<p>令 <span class="math inline">\(f_i\)</span> 表示到第 <span class="math inline">\(i\)</span> 列 , 前面没有一个超过 <span class="math inline">\(k\)</span> 的矩形且第 <span class="math inline">\(i\)</span> 列的第 <span class="math inline">\(1\)</span> 行危险的概率. 求的就是 <span class="math inline">\(f_{n+1}\)</span> .</p>
<p>于是令 <span class="math inline">\(g_{i}\)</span> 表示宽 <span class="math inline">\(i\)</span> 列 , 且没有合法矩形大小大于 <span class="math inline">\(k\)</span> 且最后一列第一行危险的概率. 于是有转移 <span class="math inline">\(f_{i} = \sum_{j=1}^k f_{i-j}g_j\)</span> . 现在的问题是求出 <span class="math inline">\(g_i\)</span> .</p>
<p>考虑一个 <span class="math inline">\(\rm dp\)</span> , <span class="math inline">\(h_{i,j}\)</span> 表示宽 <span class="math inline">\(i\)</span> 列 , 且最低的危险块在第 <span class="math inline">\(j\)</span> 行且没有矩形大小大于 <span class="math inline">\(k\)</span> 的概率. 每次枚举最后一个在 <span class="math inline">\(j\)</span> 行的危险方块转移. <span class="math display">\[
\begin{aligned}
h_{i,j} = \sum_{k=1}^i\left(\sum_{l\geq j}h_{k-1,l}\right)\left(\sum_{l&gt;j}h_{i-k,j+1}\right)p^j(1-p)
\end{aligned}
\]</span> 可以前缀和优化转移.</p>
<p>最后可以得到 <span class="math inline">\(g_i = \sum_{j} h_{i,j}\)</span> .</p>
<p>看起来这部分 <span class="math inline">\(\rm DP\)</span> 的复杂度时 <span class="math inline">\(O(k^3)\)</span> . 实际上有用的状态数只有 <span class="math inline">\(k\ln k\)</span> 个 , 复杂度是 <span class="math inline">\(O(k^2 \ln k)\)</span> .</p>
<p>得到 <span class="math inline">\(g_i\)</span> 之后需要多项式取模优化常系数齐次线性递推. 实际上暴力卷积就能过.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> ig = <span class="number">332748118</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> LG = <span class="number">18</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">pls</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; <span class="keyword">return</span> a + b &gt;= mod ? a + b - mod : a + b; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">mns</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; <span class="keyword">return</span> a - b &lt; <span class="number">0</span> ? a - b + mod : a - b; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">inc</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; <span class="keyword">if</span>( ( a += b ) &gt;= mod ) a -= mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dec</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; <span class="keyword">if</span>( ( a -= b ) &lt; <span class="number">0</span> ) a += mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">fpow</span><span class="params">( <span class="keyword">int</span> b , <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> res = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span>( k ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( k &amp; <span class="number">1</span> ) res = <span class="number">1L</span>L * res * b % mod;</span><br><span class="line">    b = <span class="number">1L</span>L * b * b % mod; k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> _r[N] , preG[LG] , preIG[LG];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">( <span class="keyword">int</span> * f , <span class="keyword">int</span> n , <span class="keyword">int</span> flag )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> x , y , w , wn;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++i ) <span class="keyword">if</span>( i &lt; _r[i] ) swap( f[i] , f[_r[i]] );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> mid = <span class="number">1</span> , tk = <span class="number">0</span> ; mid &lt; n ; mid &lt;&lt;= <span class="number">1</span> , ++tk ) &#123;</span><br><span class="line">    wn = flag ? preIG[tk] : preG[tk];</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; i += ( mid &lt;&lt; <span class="number">1</span> ) ) &#123;</span><br><span class="line">      w = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; mid ; ++j , w = <span class="number">1L</span>L * w * wn % mod ) &#123;</span><br><span class="line">        x = f[i + j] , y = <span class="number">1L</span>L * f[i + j + mid] * w % mod;</span><br><span class="line">        f[i + j] = pls( x , y );</span><br><span class="line">        f[i + j + mid] = mns( x , y );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>( flag ) &#123;</span><br><span class="line">    w = fpow( n , mod - <span class="number">2</span> );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++i ) f[i] = <span class="number">1L</span>L * w * f[i] % mod;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> _A[N] , _B[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Inv</span><span class="params">( <span class="keyword">int</span> * f , <span class="keyword">int</span> * g , <span class="keyword">int</span> _n )</span> </span>&#123;</span><br><span class="line">  ++_n; g[<span class="number">0</span>] = fpow( f[<span class="number">0</span>] , mod - <span class="number">2</span> ); <span class="keyword">int</span> lim = <span class="number">1</span> , l = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> n = <span class="number">1</span> ; n &lt; _n * <span class="number">2</span> ; n &lt;&lt;= <span class="number">1</span> ) &#123;</span><br><span class="line">    <span class="keyword">while</span>( lim &lt; n * <span class="number">2</span> ) lim &lt;&lt;= <span class="number">1</span> , ++l;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; lim ; ++i ) _r[i] = ( _r[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span> ) | ( (i&amp;<span class="number">1</span>) &lt;&lt; l );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++i ) _A[i] = f[i] , _B[i] = g[i];</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = n ; i &lt; lim ; ++i ) _A[i] = _B[i] = <span class="number">0</span>;</span><br><span class="line">    NTT( _A , lim , <span class="number">0</span> ) , NTT( _B , lim , <span class="number">0</span> );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; lim ; ++i ) g[i] = mns( pls( _B[i] , _B[i] ) , <span class="number">1L</span>L * _A[i] * _B[i] % mod * _B[i] % mod );</span><br><span class="line">    NTT( g , lim , <span class="number">1</span> ); <span class="keyword">for</span>( <span class="keyword">int</span> i = n ; i &lt; lim ; ++i ) g[i] = <span class="number">0</span>;</span><br><span class="line">  &#125; <span class="keyword">for</span>( <span class="keyword">int</span> i = _n ; i &lt; lim ; ++i ) g[i] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> PointValPmod[N] , PointValInvRevPmod[N] , n , k , f[M][M] , p , Pow[M] , q , base[N] , res[N] , Pmod[N] , g[N] , lim , l;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Mod</span><span class="params">( <span class="keyword">int</span> * f )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> _n , _m , t1[N] , revf[N];</span><br><span class="line">  _n = ( k - <span class="number">1</span> ) * <span class="number">2</span> , _m = k;</span><br><span class="line">  <span class="built_in">memset</span>( revf , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * lim );</span><br><span class="line">  <span class="built_in">memcpy</span>( revf , f , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * ( _n + <span class="number">1</span> ) );</span><br><span class="line">  reverse( revf , revf + <span class="number">1</span> + _n );</span><br><span class="line">  NTT( revf , lim , <span class="number">0</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; lim ; ++i ) t1[i] = <span class="number">1L</span>L * revf[i] * PointValInvRevPmod[i] % mod;</span><br><span class="line">  NTT( t1 , lim , <span class="number">1</span> ); reverse( t1 , t1 + _n - _m + <span class="number">1</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = _n - _m + <span class="number">1</span> ; i &lt; lim ; ++i ) t1[i] = <span class="number">0</span>;</span><br><span class="line">  NTT( t1 , lim , <span class="number">0</span> ); <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; lim ; ++i ) t1[i] = <span class="number">1L</span>L * t1[i] * PointValPmod[i] % mod;</span><br><span class="line">  NTT( t1 , lim , <span class="number">1</span> ); <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; _m ; ++i ) dec( f[i] , t1[i] );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = _m ; i &lt; lim ; ++i ) f[i] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">( <span class="keyword">int</span> _k )</span> </span>&#123;</span><br><span class="line">  k = _k;</span><br><span class="line">  <span class="built_in">memset</span>( f , <span class="number">0</span> , <span class="keyword">sizeof</span> f );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = k + <span class="number">1</span> ; ~i ; --i ) f[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , tmp ; i &lt;= k ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = k / i ; j ; --j ) &#123;</span><br><span class="line">      tmp = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> l = <span class="number">1</span> ; l &lt;= i ; ++l )</span><br><span class="line">        inc( tmp , <span class="number">1L</span>L * f[l - <span class="number">1</span>][j + <span class="number">1</span>] * f[i - l][j] % mod );</span><br><span class="line">      tmp = <span class="number">1L</span>L * tmp * Pow[j] % mod * q % mod;</span><br><span class="line">      f[i][j] = pls( f[i][j + <span class="number">1</span>] , tmp );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; ++k;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++i ) </span><br><span class="line">    Pmod[i] = <span class="number">1L</span>L * f[i - <span class="number">1</span>][<span class="number">1</span>] * q % mod;</span><br><span class="line">  g[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++i ) &#123;</span><br><span class="line">    g[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> , t = min( i , k ) ; j &lt;= t ; ++j )</span><br><span class="line">      inc( g[i] , <span class="number">1L</span>L * g[i - j] * Pmod[j] % mod );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>( n &lt; k ) <span class="keyword">return</span> <span class="number">1L</span>L * g[n + <span class="number">1</span>] * fpow( q , mod - <span class="number">2</span> ) % mod;</span><br><span class="line">  reverse( Pmod , Pmod + <span class="number">1</span> + k );</span><br><span class="line">  Pmod[k] = mod - <span class="number">1</span> , lim = <span class="number">1</span> , l = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">while</span>( lim &lt;= k * <span class="number">3</span> ) lim &lt;&lt;= <span class="number">1</span> , ++l;</span><br><span class="line">  <span class="built_in">memset</span>( PointValPmod , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * lim );</span><br><span class="line">  <span class="built_in">memset</span>( PointValInvRevPmod , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * lim );</span><br><span class="line">  <span class="built_in">memcpy</span>( PointValPmod , Pmod , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * ( k + <span class="number">1</span> ) );</span><br><span class="line">  reverse( Pmod , Pmod + <span class="number">1</span> + k );</span><br><span class="line">  Inv( Pmod , PointValInvRevPmod , k );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; lim ; ++i ) _r[i] = ( _r[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span> ) | ( (i&amp;<span class="number">1</span>) &lt;&lt; l );</span><br><span class="line">  NTT( PointValInvRevPmod , lim , <span class="number">0</span> ) , NTT( PointValPmod , lim , <span class="number">0</span> );</span><br><span class="line">  <span class="built_in">memset</span>( base , <span class="number">0</span> , <span class="keyword">sizeof</span> base ) , <span class="built_in">memset</span>( res , <span class="number">0</span> , <span class="keyword">sizeof</span> res );</span><br><span class="line">  res[<span class="number">0</span>] = <span class="number">1</span> , base[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> tn = n;</span><br><span class="line">  <span class="keyword">while</span>( tn ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( tn &amp; <span class="number">1</span> ) &#123;</span><br><span class="line">      NTT( res , lim , <span class="number">0</span> ) , NTT( base , lim , <span class="number">0</span> );</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; lim ; ++i ) res[i] = <span class="number">1L</span>L * res[i] * base[i] % mod;</span><br><span class="line">      NTT( res , lim , <span class="number">1</span> ); NTT( base , lim , <span class="number">1</span> ); Mod( res );</span><br><span class="line">    &#125;</span><br><span class="line">    NTT( base , lim , <span class="number">0</span> ); </span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; lim ; ++i ) base[i] = <span class="number">1L</span>L * base[i] * base[i] % mod;</span><br><span class="line">    NTT( base , lim , <span class="number">1</span> );</span><br><span class="line">    Mod( base ) , tn &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; k ; ++i ) inc( ans , <span class="number">1L</span>L * g[i + <span class="number">1</span>] * res[i] % mod );</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1L</span>L * ans * fpow( q , mod - <span class="number">2</span> ) % mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> k , a , b;</span><br><span class="line">  <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; k &gt;&gt; a &gt;&gt; b;</span><br><span class="line">  p = <span class="number">1L</span>L * a * fpow( b , mod - <span class="number">2</span> ) % mod;</span><br><span class="line">  q = mns( <span class="number">1</span> , p ); </span><br><span class="line">  Pow[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++i ) Pow[i] = <span class="number">1L</span>L * Pow[i - <span class="number">1</span>] * p % mod;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; LG ; ++i ) &#123;</span><br><span class="line">    preG[i] = fpow( <span class="number">3</span> , ( mod - <span class="number">1</span> ) / ( <span class="number">1</span> &lt;&lt; ( i + <span class="number">1</span> ) ) );</span><br><span class="line">    preIG[i] = fpow( ig , ( mod - <span class="number">1</span> ) / ( <span class="number">1</span> &lt;&lt; ( i + <span class="number">1</span> ) ) );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d"</span>,mns( solve( k ) , solve( k - <span class="number">1</span> ) ) );</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2017-游戏"><a href="https://loj.ac/problem/2305" target="_blank" rel="noopener">[NOI2017] 游戏</a></h5>
<p><span class="math inline">\(\rm 2-sat\)</span> , 对于 <span class="math inline">\(x\)</span> 地图指数枚举.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">5e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mp[<span class="number">3</span>][<span class="number">2</span>] = &#123; &#123; <span class="number">1</span> , <span class="number">2</span> &#125; , &#123; <span class="number">0</span> , <span class="number">2</span> &#125; , &#123; <span class="number">0</span> , <span class="number">1</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> head[N] , eidx , dfn[N] , low[N] , S[N] , tp , dfc , sccnum[N] , scccnt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt , to; &#125; edge[M];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123; edge[++eidx] = (Edge) &#123; head[u] , v &#125;; head[u] = eidx; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">id</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123; <span class="keyword">return</span> u &lt;&lt; <span class="number">1</span> | v; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Addedge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> tu , <span class="keyword">int</span> v , <span class="keyword">int</span> tv )</span> </span>&#123;</span><br><span class="line">  addedge( id( u , tu ) , id( v , tv ) );</span><br><span class="line">  addedge( id( v , tv ^ <span class="number">1</span> ) , id( u , tu ^ <span class="number">1</span> ) );</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">  low[u] = dfn[u] = ++dfc; S[++tp] = u;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] , v ; i ; i = edge[i].nxt )</span><br><span class="line">    <span class="keyword">if</span>( !dfn[v = edge[i].to] )</span><br><span class="line">      dfs( v ) , low[u] = min( low[u] , low[v] );</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( !sccnum[v] ) low[u] = min( low[u] , dfn[v] );</span><br><span class="line">  <span class="keyword">if</span>( dfn[u] == low[u] ) &#123;</span><br><span class="line">    sccnum[u] = ++scccnt;</span><br><span class="line">    <span class="keyword">while</span>( S[tp] != u ) sccnum[S[tp--]] = scccnt;</span><br><span class="line">    --tp;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n , m;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Data</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> u , tu , v , tv;</span><br><span class="line">&#125; dat[N];</span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">work</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  <span class="built_in">memset</span>( head + <span class="number">2</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * n * <span class="number">2</span> ) , eidx = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>( sccnum + <span class="number">2</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * n * <span class="number">2</span> ) , scccnt = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>( dfn + <span class="number">2</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * n * <span class="number">2</span> );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , v ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    u = dat[i].u , v = dat[i].v;</span><br><span class="line">    <span class="keyword">if</span>( u == v ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( dat[i].tu == dat[i].tv ) <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> a = <span class="number">0</span> ; a &lt; <span class="number">2</span> ; ++a )</span><br><span class="line">        <span class="keyword">if</span>( mp[str[u]][a] == dat[i].tu )</span><br><span class="line">          Addedge( u , a , u , a ^ <span class="number">1</span> );</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> a = <span class="number">0</span> ; a &lt; <span class="number">2</span> ; ++a ) <span class="keyword">if</span>( mp[str[u]][a] == dat[i].tu ) &#123;</span><br><span class="line">      <span class="keyword">bool</span> flag = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> b = <span class="number">0</span> ; b &lt; <span class="number">2</span> ; ++b ) <span class="keyword">if</span>( mp[str[v]][b] == dat[i].tv )</span><br><span class="line">        Addedge( u , a , v , b ) , flag = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span>( !flag ) Addedge( u , a , u , a ^ <span class="number">1</span> );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> , t = n * <span class="number">2</span> + <span class="number">1</span> ; i &lt;= t ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( !dfn[i] )</span><br><span class="line">      dfs( i );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( sccnum[i &lt;&lt; <span class="number">1</span>] == sccnum[i &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] )</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> ans[N];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( sccnum[i &lt;&lt; <span class="number">1</span>] &lt; sccnum[i &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] )</span><br><span class="line">      ans[i] = mp[str[i]][<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">else</span> ans[i] = mp[str[i]][<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    <span class="built_in">putchar</span>( ans[i] + <span class="string">'A'</span> );</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> pos[<span class="number">11</span>] , d , U;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%s"</span>,&amp;n,&amp;m,str+<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( str[i] == <span class="string">'x'</span> )</span><br><span class="line">      pos[d++] = i;</span><br><span class="line">    str[i] -= <span class="string">'a'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m);</span><br><span class="line">  <span class="keyword">char</span> c[<span class="number">2</span>];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d%s"</span>,&amp;dat[i].u,c);</span><br><span class="line">    *c -= <span class="string">'A'</span>;</span><br><span class="line">    dat[i].tu = *c;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d%s"</span>,&amp;dat[i].v,c);</span><br><span class="line">    *c -= <span class="string">'A'</span>;</span><br><span class="line">    dat[i].tv = *c;</span><br><span class="line">  &#125;</span><br><span class="line">  U = ( <span class="number">1</span> &lt;&lt; d );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> s = <span class="number">0</span> ; s &lt; U ; ++s ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; d ; ++i )</span><br><span class="line">      str[pos[i]] = ( s &gt;&gt; i ) &amp; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( work() ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"-1"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2017-蔬菜"><a href="https://loj.ac/problem/2306" target="_blank" rel="noopener">[NOI2017] 蔬菜</a></h5>
<p>贪心 , 反着做 , 就变成加入操作了.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;lol,<span class="keyword">int</span>&gt; pii;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line">priority_queue&lt;pii,<span class="built_in">vector</span>&lt;pii&gt;,greater&lt;pii&gt; &gt; q;</span><br><span class="line">priority_queue&lt;pii&gt; Q;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> taken[N] , a[N] , s[N] , x[N] , c[N] , n , t , m , k , qry[N] , dt[N] , tp;</span><br><span class="line">pii S[N]; <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec[N]; lol ans[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">last</span><span class="params">( <span class="keyword">int</span> id , <span class="keyword">int</span> day )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( !x[id] ) <span class="keyword">return</span> c[id] - taken[id];</span><br><span class="line">  <span class="keyword">return</span> ( c[id] - ( day - <span class="number">1</span> ) * x[id] - taken[id] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">( lol &amp; res , <span class="keyword">int</span> &amp; lim , pii p , <span class="keyword">int</span> day )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> las = p.second &gt; n ? <span class="number">1</span> : min( lim , last( p.second , day ) );</span><br><span class="line">  <span class="keyword">if</span>( !las ) <span class="keyword">return</span>; </span><br><span class="line">  <span class="keyword">if</span>( p.second &gt; n ) p.second -= n;</span><br><span class="line">  res += p.first * las;</span><br><span class="line">  taken[p.second] += las;</span><br><span class="line">  lim -= las;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">lol <span class="title">back</span><span class="params">( <span class="keyword">int</span> lim )</span> </span>&#123;</span><br><span class="line">  lol res = <span class="number">0</span> , fl;</span><br><span class="line">  <span class="keyword">while</span>( lim &amp;&amp; !q.empty() ) &#123;</span><br><span class="line">    pii tmp = q.top(); q.pop();</span><br><span class="line">    fl = min( tmp.second , lim );</span><br><span class="line">    lim -= fl , tmp.second -= fl;</span><br><span class="line">    res += fl * tmp.first;</span><br><span class="line">    <span class="keyword">if</span>( tmp.second ) q.push( tmp );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;n,&amp;m,&amp;k);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>,a+i,s+i,c+i,x+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,qry+i);</span><br><span class="line">    t = max( t , qry[i] );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , tim ; i &lt;= n ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( x[i] ) &#123;</span><br><span class="line">      tim = min( t , ( c[i] + x[i] - <span class="number">1</span> ) / x[i] );</span><br><span class="line">      vec[tim].push_back( i );</span><br><span class="line">    &#125; <span class="keyword">else</span> vec[t].push_back( i );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = t , lim ; i ; --i ) &#123;</span><br><span class="line">    lim = m;</span><br><span class="line">    <span class="keyword">for</span>( <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator it = vec[i].begin() ; it != vec[i].end() ; ++it )</span><br><span class="line">      Q.push( pii( s[*it] + a[*it] , *it + n ) ) , Q.push( pii( a[*it] , *it ) );</span><br><span class="line">    tp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( lim &amp;&amp; !Q.empty() ) &#123;</span><br><span class="line">      pii tmp = Q.top(); Q.pop();</span><br><span class="line">      S[++tp] = tmp;</span><br><span class="line">      calc( ans[t] , lim , tmp , i );</span><br><span class="line">    &#125;</span><br><span class="line">    dt[i] = m - lim;</span><br><span class="line">    <span class="keyword">while</span>( tp ) &#123;</span><br><span class="line">      pii tmp = S[tp--];</span><br><span class="line">      <span class="keyword">if</span>( tmp.second &lt;= n &amp;&amp; last( tmp.second , i - <span class="number">1</span> ) )</span><br><span class="line">        Q.push( tmp );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= t ; ++i ) sum += dt[i];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= t ; ++i ) &#123;</span><br><span class="line">    dt[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>( sum ) &#123;</span><br><span class="line">      dt[i] = min( m , sum );</span><br><span class="line">      sum -= dt[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( taken[i] ) &#123;</span><br><span class="line">      q.push( pii( s[i] + a[i] , <span class="number">1</span> ) );</span><br><span class="line">      <span class="keyword">if</span>( taken[i] &gt; <span class="number">1</span> ) q.push( pii( a[i] , taken[i] - <span class="number">1</span> ) );</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = t - <span class="number">1</span> ; i ; --i )</span><br><span class="line">    ans[i] = ans[i + <span class="number">1</span>] - back( dt[i + <span class="number">1</span>] );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++i )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans[qry[i]]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="section-3">2018</h4>
<h5 id="noi2018-归程"><a href="https://loj.ac/problem/2718" target="_blank" rel="noopener">[NOI2018] 归程</a></h5>
<p><span class="math inline">\(\rm kruskal\)</span> 重构树.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> LG = <span class="number">21</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> u , v , l , h;</span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; ( <span class="keyword">const</span> Edge &amp; rhs ) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> h &gt; rhs.h;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; dat[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Dij &#123;</span><br><span class="line">  <span class="keyword">int</span> head[N] , eidx , dis[N];</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt , to , w; &#125; edge[N];</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v , <span class="keyword">int</span> w )</span> </span>&#123;</span><br><span class="line">    edge[++eidx] = (Edge) &#123; head[u] , v , w &#125;; head[u] = eidx;</span><br><span class="line">    edge[++eidx] = (Edge) &#123; head[v] , u , w &#125;; head[v] = eidx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">clr</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="built_in">memset</span>( head , <span class="number">0</span> , <span class="keyword">sizeof</span> head ) , eidx = <span class="number">0</span>; &#125;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> u , w;</span><br><span class="line">    node( <span class="keyword">int</span> u = <span class="number">0</span> , <span class="keyword">int</span> w = <span class="number">0</span> ):u( u ) , w( w ) &#123;&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; ( <span class="keyword">const</span> node &amp; rhs ) <span class="keyword">const</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> w &gt; rhs.w;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  priority_queue&lt;node&gt; Q;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">dij</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) dis[i] = <span class="keyword">int</span>(<span class="number">2e9</span>) + <span class="number">10</span>;</span><br><span class="line">    Q.push( node( <span class="number">1</span> , dis[<span class="number">1</span>] = <span class="number">0</span> ) );</span><br><span class="line">    <span class="keyword">while</span>( !Q.empty() ) &#123;</span><br><span class="line">      <span class="keyword">int</span> u = Q.top().u , w = Q.top().w;</span><br><span class="line">      Q.pop();</span><br><span class="line">      <span class="keyword">if</span>( dis[u] ^ w ) <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] , v ; i ; i = edge[i].nxt )</span><br><span class="line">        <span class="keyword">if</span>( dis[v = edge[i].to] &gt; w + edge[i].w ) </span><br><span class="line">          Q.push( node( v , dis[v] = w + edge[i].w ) );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Kruskal &#123;</span><br><span class="line">  <span class="keyword">int</span> f[N] , nidx , w[N] , fa[LG][N] , mn[N];</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123; <span class="keyword">return</span> x == f[x] ? x : f[x] = find( f[x] ); &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , t = n + m ; i &lt;= t ; ++i ) f[i] = i;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) mn[i] = Dij::dis[i] , w[i] = <span class="keyword">int</span>(<span class="number">2e9</span>);</span><br><span class="line">    nidx = n;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , v ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">      u = find( dat[i].u ) , v = find( dat[i].v );</span><br><span class="line">      <span class="keyword">if</span>( u == v ) <span class="keyword">continue</span>;</span><br><span class="line">      w[++nidx] = dat[i].h;</span><br><span class="line">      mn[nidx] = min( mn[u] , mn[v] );</span><br><span class="line">      fa[<span class="number">0</span>][u] = fa[<span class="number">0</span>][v] = nidx;</span><br><span class="line">      f[u] = f[v] = nidx;</span><br><span class="line">    &#125;</span><br><span class="line">    fa[<span class="number">0</span>][nidx] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; LG ; ++i )</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= nidx ; ++j ) </span><br><span class="line">        fa[i][j] = fa[i - <span class="number">1</span>][fa[i - <span class="number">1</span>][j]];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">Qry</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> h )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = LG - <span class="number">1</span> ; ~i ; --i )</span><br><span class="line">      <span class="keyword">if</span>( fa[i][u] &amp;&amp; w[fa[i][u]] &gt; h )</span><br><span class="line">        u = fa[i][u];</span><br><span class="line">    <span class="keyword">return</span> mn[u];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>,&amp;dat[i].u,&amp;dat[i].v,&amp;dat[i].l,&amp;dat[i].h);</span><br><span class="line">    Dij::addedge( dat[i].u , dat[i].v , dat[i].l );</span><br><span class="line">  &#125;</span><br><span class="line">  sort( dat + <span class="number">1</span> , dat + <span class="number">1</span> + m );</span><br><span class="line">  <span class="keyword">int</span> q , k , s , u , h , _lastans = <span class="number">0</span>;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;q,&amp;k,&amp;s); ++s;</span><br><span class="line">  Dij::dij();</span><br><span class="line">  Kruskal::build();</span><br><span class="line">  <span class="keyword">while</span>( q-- ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;h);</span><br><span class="line">    <span class="keyword">if</span>( k ) &#123;</span><br><span class="line">      u = ( u + _lastans - <span class="number">1</span> ) % n + <span class="number">1</span>; </span><br><span class="line">      h = ( h + _lastans ) % s;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,_lastans = Kruskal::Qry( u , h ) );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  freopen(<span class="string">"return.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">  freopen(<span class="string">"return.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">int</span> T;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</span><br><span class="line">  <span class="keyword">while</span>( T-- ) &#123;</span><br><span class="line">    solve();</span><br><span class="line">    <span class="keyword">if</span>( T ) Dij::clr();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2018-冒泡排序"><a href="https://loj.ac/problem/2719" target="_blank" rel="noopener">[NOI2018] 冒泡排序</a></h5>
<p>考虑 <span class="math inline">\(\frac{1}{2}\sum_{i} |p_i-i|\)</span> 的实际意义 , 也就是将一个数交换到目标位置 , 且每个数不会有折返的交换. 枚举几个排列看一看 , 发现就是没有一个长度大于 <span class="math inline">\(2\)</span> 的下降子序列 , 也就是不存在 <span class="math inline">\(i&lt;j&lt;k\)</span> 满足 <span class="math inline">\(A_i &gt; A_j &gt; A_k\)</span> , 如果存在 , 则存在一个数被向目标方向的反方向交换一次.</p>
<p>考虑如何解决转化后的问题 , 令之前的填数集合为 <span class="math inline">\(S\)</span> , 则可以 <span class="math inline">\(\rm DP\)</span> 转移 <span class="math inline">\(f_{i,S}\)</span> , 将 <span class="math inline">\(S\)</span> 分为两个上升子序列 , 对于最大值i较小的上升子序列 , 如果当前可以填的数小于其最大值 , 则一定会出现一个长度为 <span class="math inline">\(3\)</span> 的下降子序列. 于是每次只能将能填的最小数加到第二个上升子序列后面 , 或是加一个大于 <span class="math inline">\(\max(S)\)</span> 的数 , 加到第一个上升子序列的后面 , 于是不用记录 <span class="math inline">\(S\)</span> , 令 <span class="math inline">\(f_{i,j}\)</span> 表示 , 当之前填的 <span class="math inline">\(i\)</span> 个数中最大值为 <span class="math inline">\(\rm mx\)</span> 时 , 有多少个能填的数小于 <span class="math inline">\(\rm mx\)</span> . 可以得到转移 <span class="math display">\[
\begin{aligned}
f_{i,j} = \sum_{k=0}^{j+1} f_{i-1,k} , f_{0,0} = 1
\end{aligned}
\]</span> 答案就是 <span class="math inline">\(f_{n,0}\)</span> . 考虑组合意义 , 从 <span class="math inline">\((0,0)\)</span> 出发每次可以向上走任意步或向下走一步然后向右移动一步 , 最后走到 <span class="math inline">\((n,0)\)</span> 方案数. 要求中途不能越过 <span class="math inline">\(x\)</span> 轴. 可以视为括号序列. 每次加入若干个右括号和一个左括号. <span class="math inline">\(j+1\)</span> 的转移就是不加右括号. 于是共有 <span class="math inline">\(n\)</span> 个右括号 , 也要有 <span class="math inline">\(n\)</span> 个左括号 , 这样就可以卡塔兰数求解.</p>
<p>考虑有排列限制的时候怎么做. 只用考虑第一个数的限制 , 后面类似于数位 <span class="math inline">\(\rm DP\)</span> 就好了. 假设这一位前面有 <span class="math inline">\(k\)</span> 个能填的数小于 <span class="math inline">\(\rm mx\)</span> , 由于排列限制 , 这一位要大于 <span class="math inline">\(p_i\)</span>. 分两段处理 , <span class="math inline">\(a_i &gt; \text{mx}\)</span> 就是求一个前缀和 , 如果 <span class="math inline">\(a_i &lt; \text{mx}\)</span> , 则 <span class="math inline">\(a_i\)</span> 必须是剩下的最小值. 这种情况不存在. 于是只要求前缀和就好了. 从 <span class="math inline">\((i,j)\)</span> 出发到 <span class="math inline">\((n,0)\)</span> 且不经过 <span class="math inline">\(x\)</span> 轴的方案数就是从 <span class="math inline">\((0,0)\)</span> 出发到达 <span class="math inline">\((n-i,j)\)</span> 且不越过 <span class="math inline">\(x\)</span> 轴的方案数. 对于从 <span class="math inline">\((0,0)\)</span> 到 <span class="math inline">\((x,y)\)</span> 的方案数 , 经典的格路计数 , 就是 <span class="math inline">\(\binom{x+y}{x} - \binom{x+y}{y+1}\)</span> 平行求和就好了.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">13e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">mns</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; a -= b; <span class="keyword">return</span> a + ( a &gt;&gt; <span class="number">31</span> &amp; mod ); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">inc</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; a += b - mod; a += a &gt;&gt; <span class="number">31</span> &amp; mod; &#125;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , mx , mn , fac[N] , ifac[N] , inv[N] , y , ans;</span><br><span class="line"><span class="keyword">bool</span> vis[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">binom</span><span class="params">( <span class="keyword">int</span> n , <span class="keyword">int</span> m )</span> </span>&#123; <span class="keyword">return</span> m &lt; <span class="number">0</span> ? <span class="number">0</span> : lol( fac[n] ) * ifac[m] % mod * ifac[n - m] % mod; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">F</span><span class="params">( <span class="keyword">int</span> x , <span class="keyword">int</span> y )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> mns( binom( x + y - <span class="number">1</span> , y ) , binom( x + y - <span class="number">1</span> , y - <span class="number">1</span> ) );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">  <span class="built_in">memset</span>( vis , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">bool</span> ) * ( n + <span class="number">1</span> ) );</span><br><span class="line">  ans = mx = <span class="number">0</span> , y = n , mn = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">bool</span> flag = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , x ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x); vis[x] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( x &gt; mx ) mx = x , y = n - x;</span><br><span class="line">    <span class="keyword">while</span>( vis[mn] ) ++mn;</span><br><span class="line">    <span class="keyword">if</span>( y &amp;&amp; flag ) inc( ans , F( n - i + <span class="number">2</span> , y - <span class="number">1</span> ) );</span><br><span class="line">    <span class="keyword">if</span>( x &lt; mx &amp;&amp; x &gt; mn ) flag = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  freopen(<span class="string">"inverse.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">  freopen(<span class="string">"inverse.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</span><br><span class="line">  fac[<span class="number">0</span>] = fac[<span class="number">1</span>] = ifac[<span class="number">0</span>] = ifac[<span class="number">1</span>] = inv[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> ; i &lt; N ; ++i ) &#123;</span><br><span class="line">    fac[i] = <span class="number">1L</span>L * fac[i - <span class="number">1</span>] * i % mod;</span><br><span class="line">    inv[i] = <span class="number">1L</span>L * ( mod - mod / i ) * inv[mod % i] % mod;</span><br><span class="line">    ifac[i] = <span class="number">1L</span>L * ifac[i - <span class="number">1</span>] * inv[i] % mod;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> T; _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</span><br><span class="line">  <span class="keyword">while</span>( T-- ) solve();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2018-你的名字"><a href="https://loj.ac/problem/2720" target="_blank" rel="noopener">[NOI2018] 你的名字</a></h5>
<p>补集转化 , 总本质不同子串数减去出现的本质不同子串数.</p>
<p>对于 <span class="math inline">\(S\)</span> 建出 <span class="math inline">\(\rm SAM\)</span> , 线段树合并得到每个点的 <span class="math inline">\(\rm endpos\)</span>.</p>
<p>对于 <span class="math inline">\(T\)</span> 也建出 <span class="math inline">\(\rm SAM\)</span>.</p>
<p>考虑对于每个前缀求出其有多少个新增的后缀答案. 就是减去本质相同的 , 或是在 <span class="math inline">\(T\)</span> 中匹配的. 于是在 <span class="math inline">\(S\)</span> 的 <span class="math inline">\(\rm SAM\)</span> 匹配 , 在 <span class="math inline">\(T\)</span> 的 <span class="math inline">\(\rm SAM\)</span> 上直接跳就好了 , 每个节点只访问 <span class="math inline">\(1\)</span> 次 , 所以复杂度是对的.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> son[N &lt;&lt; <span class="number">5</span>][<span class="number">2</span>] , mx[N &lt;&lt; <span class="number">5</span>] , nidx , rt[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">merge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( !u || !v ) <span class="keyword">return</span> u + v;</span><br><span class="line">  <span class="keyword">int</span> p = ++nidx;</span><br><span class="line">  son[p][<span class="number">0</span>] = merge( son[u][<span class="number">0</span>] , son[v][<span class="number">0</span>] );</span><br><span class="line">  son[p][<span class="number">1</span>] = merge( son[u][<span class="number">1</span>] , son[v][<span class="number">1</span>] );</span><br><span class="line">  mx[p] = max( mx[u] , mx[v] );</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qry</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> u , <span class="keyword">int</span> R )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( !u ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>( r &lt;= R ) <span class="keyword">return</span> mx[u];</span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>( mid &gt;= R ) <span class="keyword">return</span> qry( l , mid , son[u][<span class="number">0</span>] , R );</span><br><span class="line">  <span class="keyword">return</span> max( mx[son[u][<span class="number">0</span>]] , qry( mid + <span class="number">1</span> , r , son[u][<span class="number">1</span>] , R ) );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> &amp; u , <span class="keyword">int</span> pos )</span> </span>&#123;</span><br><span class="line">  mx[u = ++nidx] = pos;</span><br><span class="line">  <span class="keyword">if</span>( l == r ) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>( mid &gt;= pos ) ins( l , mid , son[u][<span class="number">0</span>] , pos );</span><br><span class="line">  <span class="keyword">else</span> ins( mid + <span class="number">1</span> , r , son[u][<span class="number">1</span>] , pos );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SAM</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> trs[N][<span class="number">26</span>] , tot , len[N] , lnk[N] , las , id[N];</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>( trs[<span class="number">1</span>] , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * <span class="number">26</span> );</span><br><span class="line">    tot = las = <span class="number">1</span> , len[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">ext</span><span class="params">( <span class="keyword">const</span> <span class="keyword">int</span> &amp; c )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> np , p , nq , q;</span><br><span class="line">    len[np = ++tot] = len[p = las] + <span class="number">1</span>; <span class="built_in">memset</span>( trs[np] , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * <span class="number">26</span> ); id[len[las = np]] = np;</span><br><span class="line">    <span class="keyword">while</span>( p &amp;&amp; !trs[p][c] ) trs[p][c] = np , p = lnk[p];</span><br><span class="line">    <span class="keyword">if</span>( !p ) <span class="keyword">return</span> lnk[np] = <span class="number">1</span>,  <span class="keyword">void</span>();</span><br><span class="line">    <span class="keyword">if</span>( len[q = trs[p][c]] == len[p] + <span class="number">1</span> ) <span class="keyword">return</span> lnk[np] = q , <span class="keyword">void</span>();</span><br><span class="line">    len[nq = ++tot] = len[p] + <span class="number">1</span>; <span class="built_in">memcpy</span>( trs[nq] , trs[q] , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * <span class="number">26</span> ); lnk[nq] = lnk[q];</span><br><span class="line">    <span class="keyword">while</span>( p &amp;&amp; trs[p][c] == q ) trs[p][c] = nq , p = lnk[p];</span><br><span class="line">    lnk[np] = lnk[q] = nq;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; S , T;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m , _n;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qry</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> R )</span> </span>&#123; <span class="keyword">return</span> qry( <span class="number">1</span> , _n , rt[u] , R ); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) </span><br><span class="line">    ins( <span class="number">1</span> , _n , rt[S.id[i]] , i );</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> c[N] , arr[N];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= S.tot ; ++i )</span><br><span class="line">    ++c[S.len[i]];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= _n ; ++i )</span><br><span class="line">    c[i] += c[i - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = S.tot ; i ; --i ) </span><br><span class="line">    arr[c[S.len[i]]--] = i;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = S.tot , u ; i &gt; <span class="number">1</span> ; --i ) &#123;</span><br><span class="line">    u = arr[i];</span><br><span class="line">    rt[S.lnk[u]] = merge( rt[S.lnk[u]] , rt[u] );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> minlen( u ) ( S.len[S.lnk[u]] + 1 )</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  freopen(<span class="string">"name.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">  freopen(<span class="string">"name.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%s"</span>,str+<span class="number">1</span>);</span><br><span class="line">  n = _n = <span class="built_in">strlen</span>( str + <span class="number">1</span> );</span><br><span class="line">  S.init();</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) </span><br><span class="line">    S.ext( str[i] - <span class="string">'a'</span> );</span><br><span class="line">  build();</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m);</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">bool</span> mark[N];</span><br><span class="line">  <span class="keyword">int</span> l , r , match , u , v;</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> ans;</span><br><span class="line">  <span class="keyword">while</span>( m-- ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%s%d%d"</span>,str+<span class="number">1</span>,&amp;l,&amp;r); --l , u = <span class="number">1</span> , match = <span class="number">0</span>;</span><br><span class="line">    T.init() , n = <span class="built_in">strlen</span>( str + <span class="number">1</span> );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) </span><br><span class="line">      T.ext( str[i] - <span class="string">'a'</span> );</span><br><span class="line">    <span class="built_in">memset</span>( mark + <span class="number">1</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">bool</span> ) * T.tot ) , ans = <span class="number">0</span>;</span><br><span class="line">    mark[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , c , a , b ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">      c = str[i] - <span class="string">'a'</span>;</span><br><span class="line">      <span class="keyword">while</span>( u != <span class="number">1</span> &amp;&amp; !S.trs[u][c] ) u = S.lnk[u] , match = min( match , S.len[u] );</span><br><span class="line">      <span class="keyword">if</span>( S.trs[u][c] ) &#123; </span><br><span class="line">        u = S.trs[u][c] , ++match;</span><br><span class="line">        <span class="keyword">while</span>( u != <span class="number">1</span> &amp;&amp; qry( u , r ) - min( match , minlen( u ) ) &lt; l ) u = S.lnk[u] , match = min( match , S.len[u] );</span><br><span class="line">        match = min( match , qry( u , r ) - l );</span><br><span class="line">      &#125;</span><br><span class="line">      v = T.id[i] , a = match;</span><br><span class="line">      <span class="keyword">while</span>( !mark[v] ) &#123;</span><br><span class="line">        mark[v] = <span class="number">1</span>;</span><br><span class="line">        v = T.lnk[v];</span><br><span class="line">      &#125;</span><br><span class="line">      b = T.len[v];</span><br><span class="line">      ans += i - max( a , b );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2018-屠龙勇士"><a href="https://loj.ac/problem/2721" target="_blank" rel="noopener">[NOI2018] 屠龙勇士</a></h5>
<p>拓展中国剩余定理.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> _w;</span><br><span class="line"></span><br><span class="line"><span class="function">lol <span class="title">pls</span><span class="params">( lol a , lol b , lol mod )</span> </span>&#123;</span><br><span class="line">  a += b - mod;</span><br><span class="line">  <span class="keyword">if</span>( a &lt; <span class="number">0</span> ) a += mod;</span><br><span class="line">  <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">lol <span class="title">mul</span><span class="params">( lol a , lol b , lol mod )</span> </span>&#123;</span><br><span class="line">  lol res = <span class="number">0</span> , base = a;</span><br><span class="line">  <span class="keyword">while</span>( b ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( b &amp; <span class="number">1</span> ) res = pls( res , base , mod );</span><br><span class="line">    base = pls( base , base , mod ); b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">lol <span class="title">gcd</span><span class="params">( lol a , lol b )</span> </span>&#123; <span class="keyword">return</span> b ? gcd( b , a % b ) : a; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function">lol <span class="title">exgcd</span><span class="params">( lol a , lol b , lol &amp; x , lol &amp; y )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( !b ) &#123;</span><br><span class="line">    x = <span class="number">1</span> , y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">  &#125; lol res = exgcd( b , a % b , y , x );</span><br><span class="line">  y -= a / b * x;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">lol <span class="title">mo</span><span class="params">( lol x , lol mod )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( ( x %= mod ) &lt; <span class="number">0</span> ) x += mod;</span><br><span class="line">  <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">lol <span class="title">inv</span><span class="params">( lol a , lol b )</span> </span>&#123;</span><br><span class="line">  lol x , y;</span><br><span class="line">  exgcd( a , b , x , y );</span><br><span class="line">  x = mo( x , b );</span><br><span class="line">  <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m;</span><br><span class="line">lol P[N] , mx , a , M , g , tx , ty , A[N] , B[N] , K[N]; <span class="built_in">multiset</span>&lt;lol&gt; S;</span><br><span class="line"><span class="built_in">multiset</span>&lt;lol&gt;::iterator it;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m) , S.clear();</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%lld"</span>,A+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%lld"</span>,P+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%lld"</span>,K+i);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%lld"</span>,&amp;tx),S.insert(tx);</span><br><span class="line">  mx = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    it = S.lower_bound( A[i] );</span><br><span class="line">    <span class="keyword">if</span>( it != S.end() &amp;&amp; *it == A[i] ) &#123;</span><br><span class="line">      B[i] = *it;</span><br><span class="line">      S.erase( it );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>( it != S.begin() ) --it;</span><br><span class="line">      B[i] = *it;</span><br><span class="line">      S.erase( it );</span><br><span class="line">    &#125;</span><br><span class="line">    S.insert( K[i] );</span><br><span class="line">    mx = max( mx , ( A[i] + B[i] - <span class="number">1</span> ) / B[i] );</span><br><span class="line">    g = gcd( gcd( A[i] , B[i] ) , P[i] );</span><br><span class="line">    A[i] /= g , B[i] /= g , P[i] /= g;</span><br><span class="line">    <span class="keyword">if</span>( gcd( B[i] , P[i] ) != <span class="number">1</span> ) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"-1"</span>),<span class="keyword">void</span>();</span><br><span class="line">    A[i] = mul( A[i] , inv( B[i] , P[i] ) , P[i] );</span><br><span class="line">  &#125;</span><br><span class="line">  a = A[<span class="number">1</span>] , M = P[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    g = exgcd( M , P[i] , tx , ty );</span><br><span class="line">    tx = mo( tx , P[i] / g );</span><br><span class="line">    <span class="keyword">if</span>( ( A[i] - a ) % g ) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"-1"</span>),<span class="keyword">void</span>();</span><br><span class="line">    tx = mo( mul( mo( ( A[i] - a ) / g , P[i] / g ) , tx , P[i] / g ) , P[i] / g );</span><br><span class="line">    ty = M;</span><br><span class="line">    M = M / g * P[i];</span><br><span class="line">    a = mo( mul( tx , ty , M ) + a , M );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span>( a &lt; mx ) a += M;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  freopen(<span class="string">"dragon.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">  freopen(<span class="string">"dragon.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">int</span> T;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</span><br><span class="line">  <span class="keyword">while</span>( T-- ) solve();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2018-情报中心"><a href="https://loj.ac/problem/2722" target="_blank" rel="noopener">[NOI2018] 情报中心</a></h5>
<p>分 <span class="math inline">\(\rm lca\)</span> 相同和不同讨论.</p>
<p>对于不同的情况 , 相交的部分一定是直上直下一条链. 这部分线段树合并.</p>
<p>对于相同的情况 , 枚举 <span class="math inline">\(\rm lca\)</span> , 对于所有 <span class="math inline">\(\rm lca\)</span> 是当前点的路径建虚树. 对于两条路径 <span class="math inline">\((u_1,v_1),(u_2,v_2)\)</span> , 令 <span class="math inline">\(r = \text{lca}(u_1,u_2)\)</span> , 两条路径的长度为 <span class="math inline">\(l_1,l_2\)</span> , 花费为 <span class="math inline">\(c_1,c_2\)</span> , 于是贡献为 <span class="math display">\[
\begin{aligned}
l_1+l_2-c_1-c_2-\text{dep}_r-\text{dep}_{\text{lca}(v_1,v_2)}
\end{aligned}
\]</span> 考虑枚举 <span class="math inline">\(r\)</span> , 对 <span class="math inline">\(v_1\)</span> 附加信息 <span class="math inline">\(w_{v_1} = l_1-c_1\)</span> , <span class="math inline">\(v_2\)</span> 同理. 上式变为 <span class="math inline">\(w_{v_1} + w_{v_2} - \text{dep}_{\text{lca}(v_1,v_2)}\)</span> 发现这类似于直径. 对于两个集合 <span class="math inline">\(S_1,S_2\)</span> 的直径 , <span class="math inline">\(S_1 \cup S_2\)</span> 的直径一定在两个直径的并中. 可以 <span class="math inline">\(O(1)\)</span> 合并.</p>
<p>复杂度 <span class="math inline">\(O(n \log n)\)</span>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> IN_LEN = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> buf[IN_LEN] , *s , *t;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Getchar</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="keyword">return</span> s == t &amp;&amp; ( t = ( s = buf ) + fread( buf , <span class="number">1</span> , IN_LEN , <span class="built_in">stdin</span> ) ) , s == t ? <span class="number">-1</span> : *s++; &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>( <span class="title">T</span> &amp; <span class="title">x</span> ) &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c , f; c = Getchar() , x = f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span> ) &#123; <span class="keyword">if</span>( c == <span class="string">'-'</span> ) f = <span class="number">1</span>; c = Getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span>( c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span> ) x = x * <span class="number">10</span> + c - <span class="number">48</span> , c = Getchar();</span><br><span class="line">    x = f ? -x : x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> LG = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> lol INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>LL;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">chkmin</span><span class="params">( T &amp; a , <span class="keyword">const</span> T &amp; b )</span> </span>&#123; <span class="keyword">if</span>( b &lt; a ) a = b; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">chkmax</span><span class="params">( T &amp; a , <span class="keyword">const</span> T &amp; b )</span> </span>&#123; <span class="keyword">if</span>( a &lt; b ) a = b; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> dfn[N] , dep[N] , n , m , head[N] , eidx , p[N] , dfc , Log[N] , mxdep;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt , to , w; &#125; edge[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v , <span class="keyword">int</span> w )</span> </span>&#123;</span><br><span class="line">  edge[++eidx] = (Edge) &#123; head[u] , v , w &#125;; head[u] = eidx;</span><br><span class="line">&#125; lol dis[N] , ans;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Rd</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> u , v;</span><br><span class="line">  lol w;</span><br><span class="line">&#125; dat[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Tree &#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">pii</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> fi , se;</span><br><span class="line">    pii( <span class="keyword">int</span> fi = <span class="number">0</span> , <span class="keyword">int</span> se = <span class="number">0</span> ):fi( fi ) , se( se ) &#123;&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; ( <span class="keyword">const</span> pii &amp; rhs ) <span class="keyword">const</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> fi &lt; rhs.fi || ( fi == rhs.fi &amp;&amp; se &lt; rhs.se );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; st[LG][N]; </span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">    st[<span class="number">0</span>][dfn[u] = ++dfc] = pii( dep[u] , u );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] , v ; i ; i = edge[i].nxt ) &#123;</span><br><span class="line">      v = edge[i].to; dep[v] = dep[u] + <span class="number">1</span>;</span><br><span class="line">      dis[v] = dis[u] + edge[i].w; dfs( v );</span><br><span class="line">      st[<span class="number">0</span>][++dfc] = pii( dep[u] , u );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    dep[<span class="number">1</span>] = <span class="number">1</span>; dfs( <span class="number">1</span> ); mxdep = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) chkmax( mxdep , dep[i] );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> k = <span class="number">1</span> ; k &lt; LG ; ++k )</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = dfc - ( <span class="number">1</span> &lt;&lt; k ) + <span class="number">1</span> ; i &gt; <span class="number">0</span> ; --i )</span><br><span class="line">        st[k][i] = min( st[k - <span class="number">1</span>][i] , st[k - <span class="number">1</span>][i + ( <span class="number">1</span> &lt;&lt; ( k - <span class="number">1</span> ) )] );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> k;</span><br><span class="line">    <span class="keyword">if</span>( ( l = dfn[l] ) &gt; ( r = dfn[r] ) ) swap( l , r );</span><br><span class="line">    k = Log[r - l + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> min( st[k][l] , st[k][r - ( <span class="number">1</span> &lt;&lt; k ) + <span class="number">1</span>] ).se;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">lol <span class="title">dist</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v , <span class="keyword">int</span> w )</span> </span>&#123; <span class="keyword">return</span> dis[u] + dis[v] - <span class="number">2</span> * dis[w]; &#125;</span><br><span class="line"><span class="function">lol <span class="title">dist</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123; <span class="keyword">return</span> dis[u] + dis[v] - <span class="number">2</span> * dis[Tree::LCA( u , v )]; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Solve1 &#123;</span><br><span class="line">  lol val[N &lt;&lt; <span class="number">5</span>][<span class="number">2</span>] , res;</span><br><span class="line">  <span class="keyword">int</span> son[N &lt;&lt; <span class="number">5</span>][<span class="number">2</span>] , nidx;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">newnode</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = ++nidx;</span><br><span class="line">    val[res][<span class="number">0</span>] = val[res][<span class="number">1</span>] = -INF;</span><br><span class="line">    son[res][<span class="number">0</span>] = son[res][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">up</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">    val[u][<span class="number">0</span>] = max( val[son[u][<span class="number">0</span>]][<span class="number">0</span>] , val[son[u][<span class="number">1</span>]][<span class="number">0</span>] );</span><br><span class="line">    val[u][<span class="number">1</span>] = max( val[son[u][<span class="number">0</span>]][<span class="number">1</span>] , val[son[u][<span class="number">1</span>]][<span class="number">1</span>] );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">merge</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> u , <span class="keyword">int</span> v )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( !u || !v ) <span class="keyword">return</span> u + v;</span><br><span class="line">    <span class="keyword">if</span>( l == r ) &#123;</span><br><span class="line">      chkmax( val[u][<span class="number">0</span>] , val[v][<span class="number">0</span>] );</span><br><span class="line">      chkmax( val[u][<span class="number">1</span>] , val[v][<span class="number">1</span>] );</span><br><span class="line">      <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    chkmax( res , val[son[u][<span class="number">0</span>]][<span class="number">0</span>] + val[son[v][<span class="number">1</span>]][<span class="number">1</span>] );</span><br><span class="line">    chkmax( res , val[son[u][<span class="number">1</span>]][<span class="number">1</span>] + val[son[v][<span class="number">0</span>]][<span class="number">0</span>] );</span><br><span class="line">    son[u][<span class="number">0</span>] = merge( l , mid , son[u][<span class="number">0</span>] , son[v][<span class="number">0</span>] );</span><br><span class="line">    son[u][<span class="number">1</span>] = merge( mid + <span class="number">1</span> , r , son[u][<span class="number">1</span>] , son[v][<span class="number">1</span>] );</span><br><span class="line">    up( u );</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">mdf</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> &amp; u , <span class="keyword">int</span> pos , lol A , lol B , <span class="keyword">bool</span> flag )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( !u ) u = newnode();</span><br><span class="line">    <span class="keyword">if</span>( l == r ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( flag ) val[u][<span class="number">0</span>] = A , val[u][<span class="number">1</span>] = B;</span><br><span class="line">      <span class="keyword">else</span> chkmax( val[u][<span class="number">0</span>] , A ) , chkmax( val[u][<span class="number">1</span>] , B );</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( mid &gt;= pos ) mdf( l , mid , son[u][<span class="number">0</span>] , pos , A , B , flag );</span><br><span class="line">    <span class="keyword">else</span> mdf( mid + <span class="number">1</span> , r , son[u][<span class="number">1</span>] , pos , A , B , flag );</span><br><span class="line">    up( u );</span><br><span class="line">    chkmax( res , val[son[u][<span class="number">0</span>]][<span class="number">0</span>] + val[son[u][<span class="number">1</span>]][<span class="number">1</span>] );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> rt[N];</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">( <span class="keyword">int</span> u )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = head[u] , v ; i ; i = edge[i].nxt ) &#123;</span><br><span class="line">      v = edge[i].to; dfs( v ); res = -INF;</span><br><span class="line">      rt[u] = merge( <span class="number">1</span> , mxdep , rt[u] , rt[v] );</span><br><span class="line">      chkmax( ans , res - dis[u] );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>( dep[u] &gt; <span class="number">1</span> &amp;&amp; rt[u] ) mdf( <span class="number">1</span> , mxdep , rt[u] , dep[u] - <span class="number">1</span> , -INF , -INF , <span class="number">1</span> );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>( rt + <span class="number">1</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * n );</span><br><span class="line">    val[<span class="number">0</span>][<span class="number">0</span>] = val[<span class="number">0</span>][<span class="number">1</span>] = -INF;</span><br><span class="line">    nidx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , v , r ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">      u = dat[i].u , v = dat[i].v;</span><br><span class="line">      <span class="keyword">if</span>( dep[u] &gt; dep[v] ) swap( u , v );</span><br><span class="line">      lol w = dist( u , v , r = Tree::LCA( u , v ) ) - dat[i].w;</span><br><span class="line">      res = -INF;</span><br><span class="line">      mdf( <span class="number">1</span> , mxdep , rt[v] , dep[r] , w , w + dis[r] , <span class="number">0</span> );</span><br><span class="line">      chkmax( ans , res - dis[v] );</span><br><span class="line">      <span class="keyword">if</span>( r ^ u ) </span><br><span class="line">        res = -INF , mdf( <span class="number">1</span> , mxdep , rt[u] , dep[r] , w , w + dis[r] , <span class="number">0</span> ) , chkmax( ans , res - dis[u] );</span><br><span class="line">    &#125;</span><br><span class="line">    dfs( <span class="number">1</span> );</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Solve2 &#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">pii</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> fi; lol se;</span><br><span class="line">    pii( <span class="keyword">int</span> fi = <span class="number">0</span> , lol se = <span class="number">0</span> ):fi( fi ) , se( se ) &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec[N] , p;</span><br><span class="line">  <span class="built_in">vector</span>&lt;pii&gt; val[N];</span><br><span class="line">  <span class="keyword">int</span> S[N] , tp , rt;</span><br><span class="line">  <span class="function">lol <span class="title">Dist</span><span class="params">( pii a , pii b )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( !a.fi &amp;&amp; !b.fi ) <span class="keyword">return</span> -INF - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( !a.fi || !b.fi ) <span class="keyword">return</span> -INF;</span><br><span class="line">    <span class="keyword">return</span> a.se + b.se - dis[Tree::LCA( a.fi , b.fi )] + dis[rt];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    pii p[<span class="number">2</span>];</span><br><span class="line">    node() &#123; p[<span class="number">0</span>] = pii() , p[<span class="number">1</span>] = pii(); &#125;</span><br><span class="line">    node( pii a , pii b ) &#123;</span><br><span class="line">      p[<span class="number">0</span>] = a , p[<span class="number">1</span>] = b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">lol <span class="title">Dist</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="keyword">return</span> Solve2::Dist( p[<span class="number">0</span>] , p[<span class="number">1</span>] ); &#125;</span><br><span class="line">  &#125; wd[N];</span><br><span class="line">  lol res;</span><br><span class="line">  <span class="function">node <span class="title">merge</span><span class="params">( node a , node b )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> lol t; <span class="keyword">static</span> node ret;</span><br><span class="line">    res = -INF , ret = node();</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">2</span> ; ++i )</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; <span class="number">2</span> ; ++j )</span><br><span class="line">        <span class="keyword">if</span>( ( t = Dist( a.p[i] , b.p[j] ) ) &gt; res )</span><br><span class="line">          res = t , ret = node( a.p[i] , b.p[j] );</span><br><span class="line">    <span class="keyword">if</span>( a.Dist() &gt; ret.Dist() ) ret = a;</span><br><span class="line">    <span class="keyword">if</span>( b.Dist() &gt; ret.Dist() ) ret = b;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">work</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tot = p.size();</span><br><span class="line">    S[tp = <span class="number">1</span>] = p[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , x , y ; i &lt; tot ; ++i ) &#123;</span><br><span class="line">      x = p[i] , y = Tree::LCA( x , S[tp] );</span><br><span class="line">      <span class="keyword">while</span>( tp &gt; <span class="number">1</span> &amp;&amp; dep[y] &lt;= dep[S[tp - <span class="number">1</span>]] ) &#123;</span><br><span class="line">        res = -INF;</span><br><span class="line">        <span class="keyword">if</span>( S[tp - <span class="number">1</span>] != rt ) wd[S[tp - <span class="number">1</span>]] = merge( wd[S[tp - <span class="number">1</span>]] , wd[S[tp]] );</span><br><span class="line">       chkmax( ans , res + dis[rt] - dis[S[tp - <span class="number">1</span>]] );</span><br><span class="line">        --tp;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>( S[tp] != y ) &#123;</span><br><span class="line">        wd[y] = wd[S[tp]];</span><br><span class="line">        S[tp] = y;</span><br><span class="line">      &#125;</span><br><span class="line">      S[++tp] = x;</span><br><span class="line">      <span class="keyword">if</span>( x == rt ) <span class="keyword">break</span>;</span><br><span class="line">      wd[x] = node();</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">const</span> pii &amp; v : val[x] ) &#123;</span><br><span class="line">        res = -INF;</span><br><span class="line">        wd[x] = merge( wd[x] , node( v , pii() ) );</span><br><span class="line">        chkmax( ans , res + dis[rt] - dis[x] );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) vec[i].clear();</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , v , r ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">      u = dat[i].u , v = dat[i].v;</span><br><span class="line">      r = Tree::LCA( u , v );</span><br><span class="line">      vec[r].push_back( i );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) <span class="keyword">if</span>( vec[i].size() &gt; <span class="number">1</span> ) &#123;</span><br><span class="line">      p.clear() , rt = i , p.push_back( i ); <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; t : vec[i] ) &#123;</span><br><span class="line">        p.push_back( dat[t].u ) , p.push_back( dat[t].v );</span><br><span class="line">        val[dat[t].u].push_back( pii( dat[t].v , dist( dat[t].u , dat[t].v ) - dat[t].w ) );</span><br><span class="line">        val[dat[t].v].push_back( pii( dat[t].u , dist( dat[t].u , dat[t].v ) - dat[t].w ) );</span><br><span class="line">      &#125;</span><br><span class="line">      sort( p.begin() , p.end() , []( <span class="keyword">int</span> a , <span class="keyword">int</span> b ) &#123; <span class="keyword">return</span> dfn[a] &lt; dfn[b]; &#125; ); </span><br><span class="line">      p.erase( unique( p.begin() , p.end() ) , p.end() ); </span><br><span class="line">      p.push_back( i );</span><br><span class="line">      work();</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : p ) </span><br><span class="line">        val[v].clear();</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  read( n );</span><br><span class="line">  <span class="built_in">memset</span>( head + <span class="number">1</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * n ) , eidx = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>( dfn + <span class="number">1</span> , <span class="number">0</span> , <span class="keyword">sizeof</span>( <span class="keyword">int</span> ) * n ) , dfc = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> , u , v , w ; i &lt; n ; ++i ) &#123;</span><br><span class="line">    read( u ) , read( v ) , read( w );</span><br><span class="line">    p[v] = u; addedge( u , v , w );</span><br><span class="line">  &#125;</span><br><span class="line">  Tree::init() , ans = -INF;</span><br><span class="line">  read( m );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    read( dat[i].u ) , read( dat[i].v ) , read( dat[i].w );</span><br><span class="line">    <span class="keyword">if</span>( dat[i].u == dat[i].v ) --i , --m;</span><br><span class="line">  &#125;</span><br><span class="line">  Solve1::main();</span><br><span class="line">  Solve2::main();</span><br><span class="line">  <span class="keyword">if</span>( ans &lt; -INF / <span class="number">2</span> ) <span class="built_in">puts</span>(<span class="string">"F"</span>);</span><br><span class="line">  <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  freopen(<span class="string">"center.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">  freopen(<span class="string">"center.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> ; i &lt; N ; ++i ) Log[i] = Log[i &gt;&gt; <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> T; read( T );</span><br><span class="line">  <span class="keyword">while</span>( T-- ) solve();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="section-4">2019</h4>
<h5 id="noi2019-回家路线"><a href="https://loj.ac/problem/3156" target="_blank" rel="noopener">[NOI2019] 回家路线</a></h5>
<p>斜率优化 , 对于每个点建一个队列.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lol;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> _w; FILE * _f;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">file</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; _f = freopen(<span class="string">"route.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>); _f = freopen(<span class="string">"route.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , m , A , B , C;</span><br><span class="line"><span class="keyword">int</span> siz[N] , he[N] , ta[N];</span><br><span class="line">lol ans;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Trs</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> u , v , p , q;</span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; ( <span class="keyword">const</span> Trs &amp; rhs ) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> p &lt; rhs.p;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; dat[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pii</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> fi; lol se;</span><br><span class="line">  pii() &#123; se = fi = <span class="number">0</span>; &#125;</span><br><span class="line">  pii( <span class="keyword">int</span> fi , lol se ):fi( fi ) , se( se ) &#123;&#125;</span><br><span class="line">&#125; que[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> u; pii p;</span><br><span class="line">  node() &#123;&#125;</span><br><span class="line">  node( <span class="keyword">int</span> u , pii v ):u( u ) , p( v ) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;node&gt; ent[N];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; id[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">slope</span><span class="params">( pii a , pii b )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">double</span>( a.se - b.se ) / ( a.fi - b.fi );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">( <span class="keyword">int</span> u , pii p )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( he[u] &lt;= ta[u] ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( que[ta[u]].fi == p.fi ) &#123;</span><br><span class="line">      que[ta[u]].se = min( que[ta[u]].se , p.se );</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>( he[u] &lt; ta[u] &amp;&amp; slope( que[ta[u]] , que[ta[u] - <span class="number">1</span>] ) &gt; slope( que[ta[u] - <span class="number">1</span>] , p ) ) --ta[u];</span><br><span class="line">    que[++ta[u]] = p;</span><br><span class="line">  &#125; <span class="keyword">else</span> que[++ta[u]] = p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">lol <span class="title">sqr</span><span class="params">( lol x )</span> </span>&#123; <span class="keyword">return</span> x * x; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">trs</span><span class="params">( <span class="keyword">int</span> u , <span class="keyword">int</span> v , <span class="keyword">int</span> p , <span class="keyword">int</span> q )</span> </span>&#123;</span><br><span class="line">  lol k = <span class="number">2L</span>L * A * p;</span><br><span class="line">  <span class="keyword">if</span>( he[u] &gt; ta[u] ) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">while</span>( he[u] &lt; ta[u] &amp;&amp; slope( que[he[u]] , que[he[u] + <span class="number">1</span>] ) &lt; k ) ++he[u];</span><br><span class="line">  lol fi = A * sqr( p - que[he[u]].fi ) + B * ( p - que[he[u]].fi ) + C + que[he[u]].se - <span class="number">1L</span>L * A * sqr( que[he[u]].fi ) + <span class="number">1L</span>L * B * que[he[u]].fi;</span><br><span class="line">  <span class="keyword">if</span>( v == n ) &#123;</span><br><span class="line">    ans = min( ans , fi + q );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ent[q].push_back( node( v , pii( q , <span class="number">1L</span>L * A * q * q - <span class="number">1L</span>L * B * q + fi ) ) );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  file();</span><br><span class="line">  <span class="keyword">int</span> mxt = <span class="number">0</span>;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d%d"</span>,&amp;n,&amp;m,&amp;A,&amp;B,&amp;C);</span><br><span class="line">  ++siz[<span class="number">1</span>] , ans = <span class="number">0x3f3f3f3f3f3f3f3f</span>LL;</span><br><span class="line">  ent[<span class="number">0</span>].push_back( node( <span class="number">1</span> , pii( <span class="number">0</span> , <span class="number">0</span> ) ) );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    _w = <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>,&amp;dat[i].u,&amp;dat[i].v,&amp;dat[i].p,&amp;dat[i].q);</span><br><span class="line">    mxt = max( mxt , dat[i].q );</span><br><span class="line">    ++siz[dat[i].v] , id[dat[i].p].push_back( i );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> _cur = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) &#123;</span><br><span class="line">    he[i] = _cur;</span><br><span class="line">    ta[i] = _cur - <span class="number">1</span>;</span><br><span class="line">    _cur += siz[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= mxt ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">const</span> node &amp; v : ent[i] ) add( v.u , v.p );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : id[i] ) trs( dat[v].u , dat[v].v , dat[v].p , dat[v].q );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2019-机器人"><a href="https://loj.ac/problem/3157" target="_blank" rel="noopener">[NOI2019] 机器人</a></h5>
<p>首先考虑朴素的 <span class="math inline">\(\rm DP\)</span> , <span class="math inline">\(f_{i,j,x}\)</span> 表示 <span class="math inline">\([i,j]\)</span> 中的最大值为 <span class="math inline">\(x\)</span> 的方案数. 每次枚举最后一个等于 <span class="math inline">\(x\)</span> 的位置转移. 这样就是 <span class="math inline">\(O(n^3B)\)</span> , 实际合法状态数非常少 , 总复杂度大约是 <span class="math inline">\(O(n^2B)\)</span>. 接着考虑 <span class="math inline">\(A,B\)</span> 相同的情况. 此时对于 <span class="math inline">\(f_{i,i,x}\)</span> , 可知 <span class="math inline">\(f_{i,i,x} = x\)</span> . 这是一个关于 <span class="math inline">\(x\)</span> 的一次函数. 那么每次转移就是两个函数卷起来 , 于是 <span class="math inline">\(f_{i,j}\)</span> 是一个关于 <span class="math inline">\(x\)</span> 的 <span class="math inline">\(j-i+1\)</span> 次函数. 最后对于这个函数求一个关于 <span class="math inline">\(x\)</span> 的离散积分就好了. 离散积分对于普通多项式来说不好求. 考虑将这个多项式转化为下降幂多项式. 然后离散积分就可以 <span class="math inline">\(O(n)\)</span> 求出了. 不过对于下降幂多项式 , 卷积的时候需要做些转化.</p>
<p>对于 <span class="math inline">\(A,B\)</span> 不同的情况 , 这就是一个分段函数. 段数 <span class="math inline">\(O(n)\)</span> , 由于可以看作是分治的过程 , 实际复杂度是 <span class="math inline">\(O(n^3)\)</span>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">3e2</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">pls</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; a += b - mod; <span class="keyword">return</span> a + ( a &gt;&gt; <span class="number">31</span> &amp; mod ); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">mns</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; a -= b; <span class="keyword">return</span> a + ( a &gt;&gt; <span class="number">31</span> &amp; mod ); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">inc</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; a += b - mod; a += a &gt;&gt; <span class="number">31</span> &amp; mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dec</span><span class="params">( <span class="keyword">int</span> &amp; a , <span class="keyword">int</span> b )</span> </span>&#123; a -= b; a += a &gt;&gt; <span class="number">31</span> &amp; mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">fpow</span><span class="params">( <span class="keyword">int</span> b , <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> res = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span>( k ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( k &amp; <span class="number">1</span> ) res = <span class="number">1L</span>L * res * b % mod;</span><br><span class="line">    b = <span class="number">1L</span>L * b * b % mod; k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125; <span class="keyword">int</span> _w; FILE * _f;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">file</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; _f = freopen(<span class="string">"robot.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>); _f = freopen(<span class="string">"robot.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>); &#125;</span><br><span class="line"><span class="keyword">int</span> inv[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; poly;</span><br><span class="line">poly O;</span><br><span class="line">poly <span class="keyword">operator</span> * ( <span class="keyword">const</span> poly &amp; lhs , <span class="keyword">const</span> poly &amp; rhs ) &#123;</span><br><span class="line">  <span class="keyword">int</span> n = lhs.size() - <span class="number">1</span> , m = rhs.size() - <span class="number">1</span>; poly res , tmp;</span><br><span class="line">  res.resize( n + m + <span class="number">1</span> ); tmp = lhs;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= m ; ++i ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= n ; ++j ) inc( res[i + j] , <span class="number">1L</span>L * tmp[j] * rhs[i] % mod );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++j ) inc( tmp[j - <span class="number">1</span>] , <span class="number">1L</span>L * j * tmp[j] % mod );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">poly <span class="keyword">operator</span> + ( <span class="keyword">const</span> poly &amp; lhs , <span class="keyword">const</span> poly &amp; rhs ) &#123;</span><br><span class="line">  poly res;</span><br><span class="line">  res.resize( max( lhs.size() , rhs.size() ) );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> , t = lhs.size() ; i &lt; t ; ++i ) inc( res[i] , lhs[i] );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> , t = rhs.size() ; i &lt; t ; ++i ) inc( res[i] , rhs[i] );</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">poly <span class="title">inter</span><span class="params">( <span class="keyword">const</span> poly &amp; p )</span> </span>&#123;</span><br><span class="line">  poly res;</span><br><span class="line">  res.resize( p.size() + <span class="number">1</span> );</span><br><span class="line">  res[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = p.size() - <span class="number">1</span> ; ~i ; --i )</span><br><span class="line">    res[i + <span class="number">1</span>] = <span class="number">1L</span>L * inv[i + <span class="number">1</span>] * p[i] % mod;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">val</span><span class="params">( poly f , <span class="keyword">int</span> x )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> siz = f.size() , pd = <span class="number">1</span> , res = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; siz ; ++i ) &#123;</span><br><span class="line">    inc( res , <span class="number">1L</span>L * pd * f[i] % mod );</span><br><span class="line">    pd = <span class="number">1L</span>L * pd * mns( x , i ) % mod;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Func</span> &#123;</span></span><br><span class="line">  <span class="built_in">vector</span>&lt;poly&gt; f;</span><br><span class="line">  <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; p;</span><br><span class="line">  <span class="function">Func <span class="title">inter</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">    Func res;</span><br><span class="line">    <span class="keyword">int</span> siz = f.size();</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; siz ; ++i ) &#123;</span><br><span class="line">      res.f.push_back( ::inter( f[i] ) );</span><br><span class="line">      res.p.push_back( p[i] );</span><br><span class="line">      <span class="keyword">if</span>( i ) res.f[i][<span class="number">0</span>] = mns( val( res.f[i - <span class="number">1</span>] , p[i] ) , val( res.f[i] , p[i] ) );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">Func <span class="title">lim</span><span class="params">( <span class="keyword">int</span> L , <span class="keyword">int</span> R )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> siz = p.size();</span><br><span class="line">    Func res;</span><br><span class="line">    res.p.push_back( <span class="number">0</span> );</span><br><span class="line">    res.f.push_back( poly( <span class="number">1</span> , <span class="number">0</span> ) );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; siz ; ++i ) &#123;</span><br><span class="line">      <span class="keyword">if</span>( p[i] &gt; R ) <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">if</span>( i == siz - <span class="number">1</span> || p[i + <span class="number">1</span>] &gt; L ) &#123;</span><br><span class="line">        res.p.push_back( max( L , p[i] ) );</span><br><span class="line">        res.f.push_back( f[i] );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    res.f.push_back( poly( <span class="number">1</span> , <span class="number">0</span> ) );</span><br><span class="line">    res.p.push_back( R + <span class="number">1</span> );</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; f[N * N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> A[N] , B[N] , n , id[N][N] , idx;</span><br><span class="line"></span><br><span class="line">Func <span class="keyword">operator</span> + ( <span class="keyword">const</span> Func &amp; a , <span class="keyword">const</span> Func &amp; b ) &#123;</span><br><span class="line">  <span class="keyword">int</span> n = a.p.size() , m = b.p.size();</span><br><span class="line">  Func res;</span><br><span class="line">  <span class="keyword">int</span> cur1 = <span class="number">0</span> , cur2 = <span class="number">0</span> , r1 , r2;</span><br><span class="line">  <span class="keyword">while</span>( cur1 &lt; n &amp;&amp; cur2 &lt; m ) &#123;</span><br><span class="line">    r1 = cur1 == n - <span class="number">1</span> ? (<span class="keyword">int</span>)<span class="number">2e9</span> : a.p[cur1 + <span class="number">1</span>] - <span class="number">1</span>;</span><br><span class="line">    r2 = cur2 == m - <span class="number">1</span> ? (<span class="keyword">int</span>)<span class="number">2e9</span> : b.p[cur2 + <span class="number">1</span>] - <span class="number">1</span>;</span><br><span class="line">    res.p.push_back( max( a.p[cur1] , b.p[cur2] ) );</span><br><span class="line">    res.f.push_back( a.f[cur1] + b.f[cur2] );</span><br><span class="line">    <span class="keyword">if</span>( r1 == r2 ) &#123;</span><br><span class="line">      ++cur1 , ++cur2;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>( r1 &gt; r2 ) ++cur2;</span><br><span class="line">      <span class="keyword">else</span> ++cur1;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Func <span class="keyword">operator</span> * ( <span class="keyword">const</span> Func &amp; a , <span class="keyword">const</span> Func &amp; b ) &#123;</span><br><span class="line">  <span class="keyword">int</span> n = a.p.size() , m = b.p.size();</span><br><span class="line">  Func res;</span><br><span class="line">  <span class="keyword">int</span> cur1 = <span class="number">0</span> , cur2 = <span class="number">0</span> , r1 , r2;</span><br><span class="line">  <span class="keyword">while</span>( cur1 &lt; n &amp;&amp; cur2 &lt; m ) &#123;</span><br><span class="line">    r1 = cur1 == n - <span class="number">1</span> ? (<span class="keyword">int</span>)<span class="number">2e9</span> : a.p[cur1 + <span class="number">1</span>] - <span class="number">1</span>;</span><br><span class="line">    r2 = cur2 == m - <span class="number">1</span> ? (<span class="keyword">int</span>)<span class="number">2e9</span> : b.p[cur2 + <span class="number">1</span>] - <span class="number">1</span>;</span><br><span class="line">    res.p.push_back( max( a.p[cur1] , b.p[cur2] ) );</span><br><span class="line">    res.f.push_back( a.f[cur1] * b.f[cur2] );</span><br><span class="line">    <span class="keyword">if</span>( r1 == r2 ) ++cur1 , ++cur2;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( r1 &gt; r2 ) ++cur2;</span><br><span class="line">    <span class="keyword">else</span> ++cur1;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dp</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( id[l][r] ) <span class="keyword">return</span>;</span><br><span class="line">  id[l][r] = ++idx;</span><br><span class="line">  Func &amp; res = f[idx];</span><br><span class="line">  <span class="keyword">if</span>( l &gt; r ) &#123;</span><br><span class="line">    res.p.push_back( <span class="number">0</span> );</span><br><span class="line">    res.f.push_back( O );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  res.p.push_back( <span class="number">0</span> );</span><br><span class="line">  res.f.push_back( poly( <span class="number">1</span> , <span class="number">0</span> ) );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = l ; i &lt;= r ; ++i ) <span class="keyword">if</span>( <span class="built_in">abs</span>( ( i - l + <span class="number">1</span> ) - ( r - i + <span class="number">1</span> ) ) &lt;= <span class="number">2</span> ) &#123;</span><br><span class="line">    dp( l , i - <span class="number">1</span> );</span><br><span class="line">    dp( i + <span class="number">1</span> , r );</span><br><span class="line">    Func a = f[id[l][i - <span class="number">1</span>]];</span><br><span class="line">    Func b = f[id[i + <span class="number">1</span>][r]];</span><br><span class="line">    <span class="keyword">if</span>( l &lt;= i - <span class="number">1</span> ) a = a + a.inter();</span><br><span class="line">    <span class="keyword">if</span>( i + <span class="number">1</span> &lt;= r ) b = b.inter();</span><br><span class="line">    res = res + ( a * b ).lim( A[i] , B[i] );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  file();</span><br><span class="line">  O.resize( <span class="number">1</span> );</span><br><span class="line">  O[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  _w = <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++i ) _w = <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,A+i,B+i);</span><br><span class="line">  inv[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= <span class="number">2</span> * n ; ++i ) inv[i] = <span class="number">1L</span>L * ( mod - mod / i ) * inv[mod % i] % mod;</span><br><span class="line">  dp( <span class="number">1</span> , n ); </span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d"</span>,f[<span class="number">1</span>].inter().f.back()[<span class="number">0</span>] );</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2019-序列"><a href="https://loj.ac/problem/3158" target="_blank" rel="noopener">[NOI2019] 序列</a></h5>
<a href="/2020/04/29/Tutorial/%E6%A8%A1%E6%8B%9F%E8%B4%B9%E7%94%A8%E6%B5%81/" title="模拟费用流">模拟费用流</a>
<h5 id="noi2019-弹跳"><a href="https://loj.ac/problem/3159" target="_blank" rel="noopener">[NOI2019] 弹跳</a></h5>
<p>可以看出是树套树优化建图. 不过直接这样做是不对的. 考虑 <span class="math inline">\(\rm dijkstra\)</span> 的过程中每个点只会访问一次 , 于是每次找出一个点所有的出边后 , 直接删去这个点 , 这可以线段树套 <span class="math inline">\(\rm set\)</span> 解决. 这样复杂度就是 <span class="math inline">\(O(n\log ^2 n)\)</span> .</p>
<h5 id="noi2019-斗主地"><a href="https://loj.ac/problem/3160" target="_blank" rel="noopener">[NOI2019] 斗主地</a></h5>
<p>首先有一个暴力的 <span class="math inline">\(\rm DP\)</span> , <span class="math inline">\(f_{i,j}\)</span> 表示第 <span class="math inline">\(i\)</span> 轮后第 <span class="math inline">\(j\)</span> 个牌的期望分数. 将这个表打出来 , 发现一直都是一个一次函数或是二次函数. 于是可以只保留前 <span class="math inline">\(3\)</span> 项 , 每次插值转移.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> IN_LEN = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> buf[IN_LEN] , *s , *t;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Getchar</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; <span class="keyword">return</span> s == t &amp;&amp; ( t = ( s = buf ) + fread( buf , <span class="number">1</span> , IN_LEN , <span class="built_in">stdin</span> ) ) , s == t ? <span class="number">-1</span> : *s++; &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>( <span class="title">T</span> &amp; <span class="title">x</span> ) &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c , f; x = f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span> ) &#123; <span class="keyword">if</span>( c == <span class="string">'-'</span> ) f = <span class="number">1</span>; c = Getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span>( c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span> ) x = x * <span class="number">10</span> + c - <span class="number">48</span> , c = Getchar();</span><br><span class="line">    x = f ? -x : x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inv2 = ( mod + <span class="number">1</span> ) / <span class="number">2</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">pls</span><span class="params">( <span class="keyword">int</span> a , <span class="keyword">int</span> b )</span> </span>&#123; a += b - mod; <span class="keyword">return</span> a + ( a &gt;&gt; <span class="number">31</span> &amp; mod ); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">fpow</span><span class="params">( <span class="keyword">int</span> b , <span class="keyword">int</span> k )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> res = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span>( k ) &#123;</span><br><span class="line">    <span class="keyword">if</span>( k &amp; <span class="number">1</span> ) res = <span class="number">1L</span>L * res * b % mod;</span><br><span class="line">    b = <span class="number">1L</span>L * b * b % mod; k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125; FILE * _f;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">file</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; _f = freopen(<span class="string">"landlords.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>); _f = freopen(<span class="string">"landlords.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n , A , B , C , x1 , x2 , x3 , y1 , y2 , y3 , z1 , z2 , z3 , m , type , invn0 , invn1 , invn2 , r;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">F</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123; <span class="keyword">return</span> pls( C , ( <span class="number">1L</span>L * A * x % mod + B ) * x % mod ); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123;</span><br><span class="line">  file();</span><br><span class="line">  read( n ) , read( m ) , read( type );</span><br><span class="line">  invn0 = fpow( n , mod - <span class="number">2</span> );</span><br><span class="line">  invn1 = fpow( <span class="number">1L</span>L * n * ( n - <span class="number">1</span> ) % mod , mod - <span class="number">2</span> );</span><br><span class="line">  invn2 = fpow( <span class="number">1L</span>L * n * ( n - <span class="number">1</span> ) % mod * ( n - <span class="number">2</span> ) % mod , mod - <span class="number">2</span> );</span><br><span class="line">  <span class="keyword">if</span>( type == <span class="number">1</span> ) B = <span class="number">1</span>; <span class="keyword">else</span> A = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span>( m-- ) &#123;</span><br><span class="line">    read( r );</span><br><span class="line">    x1 = F( <span class="number">1</span> ) , x2 = F( <span class="number">2</span> ) , x3 = F( <span class="number">3</span> );</span><br><span class="line">    y1 = F( r + <span class="number">1</span> ) , y2 = F( r + <span class="number">2</span> ) , y3 = F( r + <span class="number">3</span> );</span><br><span class="line">    z1 = <span class="number">1L</span>L * invn0 * ( <span class="number">1L</span>L * r * x1 % mod + <span class="number">1L</span>L * ( n - r ) * y1 % mod ) % mod;</span><br><span class="line">    z2 = <span class="number">1L</span>L * invn1 * ( <span class="number">1L</span>L * r * ( <span class="number">1L</span>L * ( r - <span class="number">1</span> ) * x2 % mod + <span class="number">1L</span>L * ( n - r ) * y1 % mod ) % mod + </span><br><span class="line">                         <span class="number">1L</span>L * ( n - r ) * ( <span class="number">1L</span>L * r * x1 % mod + <span class="number">1L</span>L * ( n - r - <span class="number">1</span> ) * y2 % mod ) % mod ) % mod;</span><br><span class="line">    z3 = <span class="number">1L</span>L * invn2 * (</span><br><span class="line">         <span class="number">1L</span>L * r * ( r - <span class="number">1</span> ) % mod * ( <span class="number">1L</span>L * ( r - <span class="number">2</span> ) * x3 % mod + <span class="number">1L</span>L * ( n - r ) * y1 % mod ) % mod +</span><br><span class="line">         <span class="number">2L</span>L * r * ( n - r ) % mod * ( <span class="number">1L</span>L * ( r - <span class="number">1</span> ) * x2 % mod + <span class="number">1L</span>L * ( n - r - <span class="number">1</span> ) * y2 % mod ) % mod +</span><br><span class="line">         <span class="number">1L</span>L * ( n - r ) * ( n - r - <span class="number">1</span> ) % mod * ( <span class="number">1L</span>L * r * x1 % mod + <span class="number">1L</span>L * ( n - r - <span class="number">2</span> ) * y3 % mod ) % mod </span><br><span class="line">       ) % mod;</span><br><span class="line">    C = ( z3 - <span class="number">3L</span>L * ( z2 - z1 ) + mod + mod + mod ) % mod;</span><br><span class="line">    A = <span class="number">1L</span>L * ( z3 + z1 - <span class="number">2L</span>L * z2 + mod + mod ) * inv2 % mod;</span><br><span class="line">    B = ( <span class="number">1L</span>L * z1 - C - A + mod + mod ) % mod;</span><br><span class="line">  &#125;</span><br><span class="line">  read( m );</span><br><span class="line">  <span class="keyword">while</span>( m-- ) &#123;</span><br><span class="line">    read( n );</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,F(n));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="noi2019-i-君的探险"><a href="https://loj.ac/problem/3161" target="_blank" rel="noopener">[NOI2019] I 君的探险</a></h5>
<p>随机化 , 整体二分.</p>
<p>先考虑每个点的度数都是 <span class="math inline">\(1\)</span> 怎么做.</p>
<p>对于每个点 , <span class="math inline">\(0.5\)</span> 的概率进行操作. 最后得到不同色的点间一定没有边. 于是可以随机后分治.</p>
<p>当为一棵树且 <span class="math inline">\(p_i &lt; i\)</span> 的时候 , 可以整体二分 , 二分出父亲节点的编号.</p>
<p>对于一般情况 , 结合上述两种做法 , 随机操作 , 每次整体二分对于每个点找出一个点与其有边.</p>
<p>一次结束后删去孤立点. 期望复杂度 <span class="math inline">\(O(n\log n)\)</span> .</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"explore.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> _cur , nm , n , m , a[N] , b[N] , tmp[N] , rmp[N] , vis[N] , <span class="keyword">vis_t</span>;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[N]; </span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">qry</span><span class="params">( <span class="keyword">int</span> x )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> res = query( x );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">int</span> &amp; v : G[x] )</span><br><span class="line">    res ^= ( vis[v] == <span class="keyword">vis_t</span> &amp;&amp; rmp[v] &lt;= _cur );</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">( <span class="keyword">int</span> l , <span class="keyword">int</span> r , <span class="keyword">int</span> L , <span class="keyword">int</span> R )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( L &gt; R ) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span>( l == r ) &#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = L ; i &lt;= R ; ++i )</span><br><span class="line">      <span class="keyword">if</span>( b[i] != a[l] ) &#123;</span><br><span class="line">        report( a[l] , b[i] );</span><br><span class="line">        G[a[l]].push_back( b[i] );</span><br><span class="line">        G[b[i]].push_back( a[l] );</span><br><span class="line">        ++nm;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = ( l + r ) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span>( _cur &lt; mid )</span><br><span class="line">    modify( a[++_cur] );</span><br><span class="line">  <span class="keyword">while</span>( _cur &gt; mid ) </span><br><span class="line">    modify( a[_cur--] );</span><br><span class="line">  <span class="keyword">int</span> p = L , q = R;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = L ; i &lt;= R ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( rmp[b[i]] &lt;= mid || qry( b[i] ) )</span><br><span class="line">      tmp[p++] = b[i];</span><br><span class="line">    <span class="keyword">else</span> tmp[q--] = b[i];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = L ; i &lt;= R ; ++i ) b[i] = tmp[i];</span><br><span class="line">  solve( l , mid , L , p - <span class="number">1</span> );</span><br><span class="line">  solve( mid + <span class="number">1</span> , r , p , R );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _solve( <span class="keyword">int</span> l , <span class="keyword">int</span> r ) &#123;</span><br><span class="line">  <span class="keyword">if</span>( l + <span class="number">1</span> == r ) &#123;</span><br><span class="line">    report( a[l] , a[l + <span class="number">1</span>] );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>( r - l + <span class="number">1</span> &lt;= <span class="number">2</span> ) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = l ; i &lt;= r ; ++i ) </span><br><span class="line">    <span class="keyword">if</span>( rand() &amp; <span class="number">1</span> ) </span><br><span class="line">      modify( a[i] );</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = l ; i &lt;= r ; ++i )</span><br><span class="line">    b[a[i]] = query( a[i] );</span><br><span class="line">  <span class="keyword">int</span> p = l , q = r;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = l ; i &lt;= r ; ++i )</span><br><span class="line">    <span class="keyword">if</span>( b[a[i]] ) tmp[q--] = a[i];</span><br><span class="line">    <span class="keyword">else</span> tmp[p++] = a[i];</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = l ; i &lt;= r ; ++i ) a[i] = tmp[i];</span><br><span class="line">  _solve( l , p - <span class="number">1</span> );</span><br><span class="line">  _solve( p , r );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">explore</span><span class="params">( <span class="keyword">int</span> _n , <span class="keyword">int</span> _m )</span> </span>&#123;</span><br><span class="line">  srand( <span class="number">114514</span> + <span class="number">1919810</span> );</span><br><span class="line">  n = _n , m = _m;</span><br><span class="line">  <span class="keyword">if</span>( n &lt;= <span class="number">500</span> ) &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> sta[N];</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n - <span class="number">1</span> ; ++i ) &#123;</span><br><span class="line">      modify( i );</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt; n ; ++j ) &#123;</span><br><span class="line">        <span class="keyword">if</span>( query( j ) != sta[j] ) &#123;</span><br><span class="line">          report( i , j );</span><br><span class="line">          sta[j] ^= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++i ) a[i] = i , b[i] = i , rmp[i] = i;</span><br><span class="line">  <span class="keyword">if</span>( n % <span class="number">10</span> == <span class="number">8</span> ) &#123;</span><br><span class="line">    _solve( <span class="number">0</span> , n - <span class="number">1</span> );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  nm = <span class="number">0</span> , _cur = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">if</span>( n % <span class="number">10</span> == <span class="number">7</span> ) &#123;</span><br><span class="line">    solve( <span class="number">0</span> , n - <span class="number">1</span> , <span class="number">0</span> , n - <span class="number">1</span> );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    random_shuffle( a , a + n ); ++<span class="keyword">vis_t</span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++i ) b[i] = a[i] , rmp[a[i]] = i , vis[a[i]] = <span class="keyword">vis_t</span>;</span><br><span class="line">    solve( <span class="number">0</span> , n - <span class="number">1</span> , <span class="number">0</span> , n - <span class="number">1</span> );</span><br><span class="line">    <span class="keyword">while</span>( ~_cur ) modify( a[_cur--] );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++i ) </span><br><span class="line">      <span class="keyword">if</span>( check( a[i] ) )</span><br><span class="line">        swap( a[i] , a[--n] );</span><br><span class="line">  &#125; <span class="keyword">while</span>( nm &lt; m );</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/06/28/Solutions/%E8%81%94%E5%90%88%E7%9C%81%E9%80%89-2020-%E7%AE%80%E8%A6%81%E9%A2%98%E8%A7%A3/" rel="prev" title="[联合省选 2020] 简要题解">
      <i class="fa fa-chevron-left"></i> [联合省选 2020] 简要题解
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/07/08/Solutions/%E5%90%8E%E7%BC%80%E6%A0%91%E8%8A%82%E7%82%B9%E6%95%B0/" rel="next" title="后缀树节点数">
      后缀树节点数 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#section"><span class="nav-number">1.</span> <span class="nav-text">2015</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2015-程序自动分析"><span class="nav-number">1.1.</span> <span class="nav-text">[NOI2015] 程序自动分析</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2015-软件包管理器"><span class="nav-number">1.2.</span> <span class="nav-text">[NOI2015] 软件包管理器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2015-寿司晚宴"><span class="nav-number">1.3.</span> <span class="nav-text">[NOI2015] 寿司晚宴</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2015-荷马史诗"><span class="nav-number">1.4.</span> <span class="nav-text">[NOI2015] 荷马史诗</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2015-品酒大会"><span class="nav-number">1.5.</span> <span class="nav-text">[NOI2015] 品酒大会</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2015-小园丁与老司机"><span class="nav-number">1.6.</span> <span class="nav-text">[NOI2015] 小园丁与老司机</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#section-1"><span class="nav-number">2.</span> <span class="nav-text">2016</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2016-优秀的拆分"><span class="nav-number">2.1.</span> <span class="nav-text">[NOI2016] 优秀的拆分</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2016-网格"><span class="nav-number">2.2.</span> <span class="nav-text">[NOI2016] 网格</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2016-循环之美"><span class="nav-number">2.3.</span> <span class="nav-text">[NOI2016] 循环之美</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2016-区间"><span class="nav-number">2.4.</span> <span class="nav-text">[NOI2016] 区间</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2016-国王饮水记"><span class="nav-number">2.5.</span> <span class="nav-text">[NOI2016] 国王饮水记</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2016-旷野大计算"><span class="nav-number">2.6.</span> <span class="nav-text">[NOI2016] 旷野大计算</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#section-2"><span class="nav-number">3.</span> <span class="nav-text">2017</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2017-整数"><span class="nav-number">3.1.</span> <span class="nav-text">[NOI2017] 整数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2017-蚯蚓排队"><span class="nav-number">3.2.</span> <span class="nav-text">[NOI2017] 蚯蚓排队</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2017-泳池"><span class="nav-number">3.3.</span> <span class="nav-text">[NOI2017] 泳池</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2017-游戏"><span class="nav-number">3.4.</span> <span class="nav-text">[NOI2017] 游戏</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2017-蔬菜"><span class="nav-number">3.5.</span> <span class="nav-text">[NOI2017] 蔬菜</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#section-3"><span class="nav-number">4.</span> <span class="nav-text">2018</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2018-归程"><span class="nav-number">4.1.</span> <span class="nav-text">[NOI2018] 归程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2018-冒泡排序"><span class="nav-number">4.2.</span> <span class="nav-text">[NOI2018] 冒泡排序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2018-你的名字"><span class="nav-number">4.3.</span> <span class="nav-text">[NOI2018] 你的名字</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2018-屠龙勇士"><span class="nav-number">4.4.</span> <span class="nav-text">[NOI2018] 屠龙勇士</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2018-情报中心"><span class="nav-number">4.5.</span> <span class="nav-text">[NOI2018] 情报中心</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#section-4"><span class="nav-number">5.</span> <span class="nav-text">2019</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2019-回家路线"><span class="nav-number">5.1.</span> <span class="nav-text">[NOI2019] 回家路线</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2019-机器人"><span class="nav-number">5.2.</span> <span class="nav-text">[NOI2019] 机器人</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2019-序列"><span class="nav-number">5.3.</span> <span class="nav-text">[NOI2019] 序列</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2019-弹跳"><span class="nav-number">5.4.</span> <span class="nav-text">[NOI2019] 弹跳</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2019-斗主地"><span class="nav-number">5.5.</span> <span class="nav-text">[NOI2019] 斗主地</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#noi2019-i-君的探险"><span class="nav-number">5.6.</span> <span class="nav-text">[NOI2019] I 君的探险</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Guyan</p>
  <div class="site-description" itemprop="description">水平低啊</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">139</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Guyan</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
